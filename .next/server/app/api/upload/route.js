"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/upload/route";
exports.ids = ["app/api/upload/route"];
exports.modules = {

/***/ "ffmpeg-static":
/*!********************************!*\
  !*** external "ffmpeg-static" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("ffmpeg-static");

/***/ }),

/***/ "jszip":
/*!************************!*\
  !*** external "jszip" ***!
  \************************/
/***/ ((module) => {

module.exports = require("jszip");

/***/ }),

/***/ "mammoth":
/*!**************************!*\
  !*** external "mammoth" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mammoth");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "onnxruntime-node":
/*!***********************************!*\
  !*** external "onnxruntime-node" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("onnxruntime-node");

/***/ }),

/***/ "pdf-parse":
/*!****************************!*\
  !*** external "pdf-parse" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("pdf-parse");

/***/ }),

/***/ "sharp":
/*!************************!*\
  !*** external "sharp" ***!
  \************************/
/***/ ((module) => {

module.exports = require("sharp");

/***/ }),

/***/ "tesseract.js":
/*!*******************************!*\
  !*** external "tesseract.js" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("tesseract.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "node:child_process":
/*!*************************************!*\
  !*** external "node:child_process" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("node:child_process");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:fs/promises":
/*!***********************************!*\
  !*** external "node:fs/promises" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:fs/promises");

/***/ }),

/***/ "node:os":
/*!**************************!*\
  !*** external "node:os" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:os");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:util");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "perf_hooks":
/*!*****************************!*\
  !*** external "perf_hooks" ***!
  \*****************************/
/***/ ((module) => {

module.exports = require("perf_hooks");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fupload%2Froute&page=%2Fapi%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fupload%2Froute.ts&appDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fupload%2Froute&page=%2Fapi%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fupload%2Froute.ts&appDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_komar_Desktop_docs_chat_master_docs_chat_master_app_api_upload_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/upload/route.ts */ \"(rsc)/./app/api/upload/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/upload/route\",\n        pathname: \"/api/upload\",\n        filename: \"route\",\n        bundlePath: \"app/api/upload/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\komar\\\\Desktop\\\\docs-chat-master\\\\docs-chat-master\\\\app\\\\api\\\\upload\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_komar_Desktop_docs_chat_master_docs_chat_master_app_api_upload_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/upload/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ1cGxvYWQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnVwbG9hZCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnVwbG9hZCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNrb21hciU1Q0Rlc2t0b3AlNUNkb2NzLWNoYXQtbWFzdGVyJTVDZG9jcy1jaGF0LW1hc3RlciU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDa29tYXIlNUNEZXNrdG9wJTVDZG9jcy1jaGF0LW1hc3RlciU1Q2RvY3MtY2hhdC1tYXN0ZXImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3lDO0FBQ3RIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZG9jcy1jaGF0LW5leHQvP2VlMTMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxca29tYXJcXFxcRGVza3RvcFxcXFxkb2NzLWNoYXQtbWFzdGVyXFxcXGRvY3MtY2hhdC1tYXN0ZXJcXFxcYXBwXFxcXGFwaVxcXFx1cGxvYWRcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3VwbG9hZC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3VwbG9hZFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvdXBsb2FkL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxca29tYXJcXFxcRGVza3RvcFxcXFxkb2NzLWNoYXQtbWFzdGVyXFxcXGRvY3MtY2hhdC1tYXN0ZXJcXFxcYXBwXFxcXGFwaVxcXFx1cGxvYWRcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3VwbG9hZC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fupload%2Froute&page=%2Fapi%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fupload%2Froute.ts&appDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/_state.ts":
/*!***************************!*\
  !*** ./app/api/_state.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chunker: () => (/* binding */ chunker),\n/* harmony export */   mediaFiles: () => (/* binding */ mediaFiles),\n/* harmony export */   sessions: () => (/* binding */ sessions),\n/* harmony export */   store: () => (/* binding */ store)\n/* harmony export */ });\n/* harmony import */ var _lib_settings__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/settings */ \"(rsc)/./lib/settings.ts\");\n/* harmony import */ var _lib_textChunker__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/textChunker */ \"(rsc)/./lib/textChunker.ts\");\n/* harmony import */ var _lib_vectorStore__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/vectorStore */ \"(rsc)/./lib/vectorStore.ts\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\nconst chunker = new _lib_textChunker__WEBPACK_IMPORTED_MODULE_1__.TextChunker(_lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.MAX_CHUNK_SIZE, _lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.CHUNK_OVERLAP);\n// Initialize VectorStore with MongoDB (singleton pattern for Next.js)\nif (!global.__vectorStore) {\n    console.log(\"Initializing new VectorStore instance...\");\n    global.__vectorStore = new _lib_vectorStore__WEBPACK_IMPORTED_MODULE_2__.VectorStore(_lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.EMBEDDING_MODEL, _lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.MONGODB_URI, _lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.MONGODB_DB_NAME);\n}\nif (!global.__sessions) {\n    global.__sessions = new Map();\n}\nif (!global.__mediaFiles) {\n    global.__mediaFiles = new Map();\n}\nconst store = global.__vectorStore;\nconst sessions = global.__sessions;\nconst mediaFiles = global.__mediaFiles;\n// Create uploads directory if it doesn't exist\nconst uploadsDir = node_path__WEBPACK_IMPORTED_MODULE_3___default().join(process.cwd(), \"uploads\");\ntry {\n    if (!node_fs__WEBPACK_IMPORTED_MODULE_4___default().existsSync(uploadsDir)) {\n        node_fs__WEBPACK_IMPORTED_MODULE_4___default().mkdirSync(uploadsDir, {\n            recursive: true\n        });\n    }\n} catch  {}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL19zdGF0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUEwQztBQUNNO0FBQ0E7QUFDbkI7QUFDSjtBQVlsQixNQUFNSyxVQUFVLElBQUlKLHlEQUFXQSxDQUFDRCxtREFBUUEsQ0FBQ00sY0FBYyxFQUFFTixtREFBUUEsQ0FBQ08sYUFBYSxFQUFFO0FBU3hGLHNFQUFzRTtBQUN0RSxJQUFJLENBQUNDLE9BQU9DLGFBQWEsRUFBRTtJQUN6QkMsUUFBUUMsR0FBRyxDQUFDO0lBQ1pILE9BQU9DLGFBQWEsR0FBRyxJQUFJUCx5REFBV0EsQ0FDcENGLG1EQUFRQSxDQUFDWSxlQUFlLEVBQ3hCWixtREFBUUEsQ0FBQ2EsV0FBVyxFQUNwQmIsbURBQVFBLENBQUNjLGVBQWU7QUFFNUI7QUFFQSxJQUFJLENBQUNOLE9BQU9PLFVBQVUsRUFBRTtJQUN0QlAsT0FBT08sVUFBVSxHQUFHLElBQUlDO0FBQzFCO0FBRUEsSUFBSSxDQUFDUixPQUFPUyxZQUFZLEVBQUU7SUFDeEJULE9BQU9TLFlBQVksR0FBRyxJQUFJRDtBQUM1QjtBQUVPLE1BQU1FLFFBQVFWLE9BQU9DLGFBQWEsQ0FBQztBQUNuQyxNQUFNVSxXQUFXWCxPQUFPTyxVQUFVLENBQUM7QUFDbkMsTUFBTUssYUFBYVosT0FBT1MsWUFBWSxDQUFDO0FBRTlDLCtDQUErQztBQUMvQyxNQUFNSSxhQUFhbEIscURBQVMsQ0FBQ29CLFFBQVFDLEdBQUcsSUFBSTtBQUM1QyxJQUFJO0lBQ0YsSUFBSSxDQUFDcEIseURBQWEsQ0FBQ2lCLGFBQWE7UUFDOUJqQix3REFBWSxDQUFDaUIsWUFBWTtZQUFFTSxXQUFXO1FBQUs7SUFDN0M7QUFDRixFQUFFLE9BQU0sQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL2RvY3MtY2hhdC1uZXh0Ly4vYXBwL2FwaS9fc3RhdGUudHM/NGFjNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzZXR0aW5ncyB9IGZyb20gXCJAL2xpYi9zZXR0aW5nc1wiO1xyXG5pbXBvcnQgeyBUZXh0Q2h1bmtlciB9IGZyb20gXCJAL2xpYi90ZXh0Q2h1bmtlclwiO1xyXG5pbXBvcnQgeyBWZWN0b3JTdG9yZSB9IGZyb20gXCJAL2xpYi92ZWN0b3JTdG9yZVwiO1xyXG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XHJcbmltcG9ydCBmcyBmcm9tIFwibm9kZTpmc1wiO1xyXG5cclxuZXhwb3J0IHR5cGUgQ2hhdE1lc3NhZ2UgPSB7IHJvbGU6IFwidXNlclwiIHwgXCJhc3Npc3RhbnRcIjsgY29udGVudDogc3RyaW5nIH07XHJcblxyXG5leHBvcnQgdHlwZSBNZWRpYUZpbGUgPSB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBmaWxlUGF0aDogc3RyaW5nO1xyXG4gIG1pbWVUeXBlOiBzdHJpbmc7XHJcbiAgb3JpZ2luYWxOYW1lOiBzdHJpbmc7XHJcbiAgdHlwZTogXCJpbWFnZVwiIHwgXCJ2aWRlb1wiIHwgXCJhdWRpb1wiO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNodW5rZXIgPSBuZXcgVGV4dENodW5rZXIoc2V0dGluZ3MuTUFYX0NIVU5LX1NJWkUsIHNldHRpbmdzLkNIVU5LX09WRVJMQVApO1xyXG5cclxuLy8gVXNlIGdsb2JhbCB0byBlbnN1cmUgc2luZ2xldG9uIGFjcm9zcyBOZXh0LmpzIGhvdCByZWxvYWRzXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICB2YXIgX192ZWN0b3JTdG9yZTogVmVjdG9yU3RvcmUgfCB1bmRlZmluZWQ7XHJcbiAgdmFyIF9fc2Vzc2lvbnM6IE1hcDxzdHJpbmcsIENoYXRNZXNzYWdlW10+IHwgdW5kZWZpbmVkO1xyXG4gIHZhciBfX21lZGlhRmlsZXM6IE1hcDxzdHJpbmcsIE1lZGlhRmlsZT4gfCB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbi8vIEluaXRpYWxpemUgVmVjdG9yU3RvcmUgd2l0aCBNb25nb0RCIChzaW5nbGV0b24gcGF0dGVybiBmb3IgTmV4dC5qcylcclxuaWYgKCFnbG9iYWwuX192ZWN0b3JTdG9yZSkge1xyXG4gIGNvbnNvbGUubG9nKFwiSW5pdGlhbGl6aW5nIG5ldyBWZWN0b3JTdG9yZSBpbnN0YW5jZS4uLlwiKTtcclxuICBnbG9iYWwuX192ZWN0b3JTdG9yZSA9IG5ldyBWZWN0b3JTdG9yZShcclxuICAgIHNldHRpbmdzLkVNQkVERElOR19NT0RFTCxcclxuICAgIHNldHRpbmdzLk1PTkdPREJfVVJJLFxyXG4gICAgc2V0dGluZ3MuTU9OR09EQl9EQl9OQU1FXHJcbiAgKTtcclxufVxyXG5cclxuaWYgKCFnbG9iYWwuX19zZXNzaW9ucykge1xyXG4gIGdsb2JhbC5fX3Nlc3Npb25zID0gbmV3IE1hcDxzdHJpbmcsIENoYXRNZXNzYWdlW10+KCk7XHJcbn1cclxuXHJcbmlmICghZ2xvYmFsLl9fbWVkaWFGaWxlcykge1xyXG4gIGdsb2JhbC5fX21lZGlhRmlsZXMgPSBuZXcgTWFwPHN0cmluZywgTWVkaWFGaWxlPigpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3Qgc3RvcmUgPSBnbG9iYWwuX192ZWN0b3JTdG9yZTtcclxuZXhwb3J0IGNvbnN0IHNlc3Npb25zID0gZ2xvYmFsLl9fc2Vzc2lvbnM7XHJcbmV4cG9ydCBjb25zdCBtZWRpYUZpbGVzID0gZ2xvYmFsLl9fbWVkaWFGaWxlcztcclxuXHJcbi8vIENyZWF0ZSB1cGxvYWRzIGRpcmVjdG9yeSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbmNvbnN0IHVwbG9hZHNEaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgXCJ1cGxvYWRzXCIpO1xyXG50cnkge1xyXG4gIGlmICghZnMuZXhpc3RzU3luYyh1cGxvYWRzRGlyKSkge1xyXG4gICAgZnMubWtkaXJTeW5jKHVwbG9hZHNEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG4gIH1cclxufSBjYXRjaCB7fVxyXG5cclxuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiVGV4dENodW5rZXIiLCJWZWN0b3JTdG9yZSIsInBhdGgiLCJmcyIsImNodW5rZXIiLCJNQVhfQ0hVTktfU0laRSIsIkNIVU5LX09WRVJMQVAiLCJnbG9iYWwiLCJfX3ZlY3RvclN0b3JlIiwiY29uc29sZSIsImxvZyIsIkVNQkVERElOR19NT0RFTCIsIk1PTkdPREJfVVJJIiwiTU9OR09EQl9EQl9OQU1FIiwiX19zZXNzaW9ucyIsIk1hcCIsIl9fbWVkaWFGaWxlcyIsInN0b3JlIiwic2Vzc2lvbnMiLCJtZWRpYUZpbGVzIiwidXBsb2Fkc0RpciIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/_state.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/upload/route.ts":
/*!*********************************!*\
  !*** ./app/api/upload/route.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:fs/promises */ \"node:fs/promises\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_fs_promises__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var node_os__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! node:os */ \"node:os\");\n/* harmony import */ var node_os__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(node_os__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _lib_documentProcessor__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/documentProcessor */ \"(rsc)/./lib/documentProcessor.ts\");\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../_state */ \"(rsc)/./app/api/_state.ts\");\n/* harmony import */ var _lib_settings__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/settings */ \"(rsc)/./lib/settings.ts\");\n/* harmony import */ var _lib_gemini__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/lib/gemini */ \"(rsc)/./lib/gemini.ts\");\n\n\n\n\n\n\n\n\nconst runtime = \"nodejs\";\nasync function POST(req) {\n    console.log(\"=== UPLOAD REQUEST START ===\");\n    const form = await req.formData();\n    const file = form.get(\"file\");\n    if (!file) {\n        console.error(\"No file in upload request\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            detail: \"file is required\"\n        }, {\n            status: 400\n        });\n    }\n    console.log(`Upload request for file: ${file.name}, size: ${file.size} bytes`);\n    const ext = (file.name || \"\").toLowerCase().slice(file.name.lastIndexOf(\".\"));\n    const allowed = [\n        \".pdf\",\n        \".txt\",\n        \".text\",\n        \".bxt\",\n        \".md\",\n        \".markdown\",\n        \".docx\",\n        \".pptx\",\n        \".png\",\n        \".jpg\",\n        \".jpeg\",\n        \".mp3\",\n        \".mp4\",\n        \".wav\",\n        \".m4a\"\n    ];\n    if (!allowed.includes(ext)) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            detail: `Unsupported file type. Allowed: ${allowed.join(\", \")}`\n        }, {\n            status: 400\n        });\n    }\n    if (file.size / (1024 * 1024) > _lib_settings__WEBPACK_IMPORTED_MODULE_6__.settings.MAX_FILE_SIZE_MB) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            detail: `File too large. Maximum size: ${_lib_settings__WEBPACK_IMPORTED_MODULE_6__.settings.MAX_FILE_SIZE_MB}MB`\n        }, {\n            status: 400\n        });\n    }\n    const tmp = await writeTempFile(file);\n    const isImage = [\n        \".png\",\n        \".jpg\",\n        \".jpeg\"\n    ].includes(ext);\n    const isVideo = [\n        \".mp4\"\n    ].includes(ext);\n    const isAudio = [\n        \".mp3\",\n        \".wav\",\n        \".m4a\"\n    ].includes(ext);\n    try {\n        // For images and videos, store the file permanently and use Gemini Vision\n        if (isImage || isVideo) {\n            const uploadsDir = node_path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"uploads\");\n            try {\n                await node_fs_promises__WEBPACK_IMPORTED_MODULE_1___default().mkdir(uploadsDir, {\n                    recursive: true\n                });\n            } catch  {}\n            const mediaId = `${Date.now()}_${Math.random().toString(36).substring(7)}`;\n            const storedPath = node_path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadsDir, `${mediaId}${ext}`);\n            await node_fs_promises__WEBPACK_IMPORTED_MODULE_1___default().copyFile(tmp, storedPath);\n            const mimeType = (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_7__.getMimeType)(storedPath);\n            _state__WEBPACK_IMPORTED_MODULE_5__.mediaFiles.set(mediaId, {\n                id: mediaId,\n                filePath: storedPath,\n                mimeType,\n                originalName: file.name,\n                type: isImage ? \"image\" : \"video\"\n            });\n            // For videos, also extract audio transcript for text search\n            let text = \"\";\n            if (isVideo) {\n                try {\n                    text = await (0,_lib_documentProcessor__WEBPACK_IMPORTED_MODULE_4__.processDocument)(tmp);\n                } catch (e) {\n                    console.warn(\"Failed to extract audio from video:\", e);\n                }\n            // Note: Video frames will be extracted and sent to Gemini Vision during chat queries\n            }\n            // For images, we still do OCR as fallback for text search, but primary analysis will be via Vision\n            if (isImage && _lib_settings__WEBPACK_IMPORTED_MODULE_6__.settings.ENABLE_OCR) {\n                try {\n                    const ocrText = await (0,_lib_documentProcessor__WEBPACK_IMPORTED_MODULE_4__.processDocument)(tmp);\n                    if (ocrText && ocrText.trim()) {\n                        text = `[Image: ${file.name}]\\n${ocrText.trim()}`;\n                        console.log(`OCR extracted ${ocrText.length} characters from image ${file.name}`);\n                    }\n                } catch (e) {\n                    console.warn(\"OCR failed, will use Vision API only:\", e);\n                }\n            }\n            // Add text chunks if available (OCR text for images, audio transcript for videos)\n            // Main analysis will be via Vision API, but text chunks help with search\n            if (text && text.trim()) {\n                const chunks = _state__WEBPACK_IMPORTED_MODULE_5__.chunker.chunkBySentences(text.trim());\n                if (chunks.length > 0) {\n                    await _state__WEBPACK_IMPORTED_MODULE_5__.store.addDocuments(chunks);\n                    console.log(`Created ${chunks.length} text chunks from ${isImage ? \"image OCR\" : \"video audio\"}`);\n                }\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    filename: file.name,\n                    total_chunks: chunks.length,\n                    media_id: mediaId,\n                    message: `${isImage ? \"Image\" : \"Video\"} processed successfully. ${chunks.length > 0 ? `${chunks.length} text chunks created. ` : \"\"}Ready for visual analysis!`\n                });\n            } else {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    filename: file.name,\n                    total_chunks: 0,\n                    media_id: mediaId,\n                    message: `${isImage ? \"Image\" : \"Video\"} uploaded successfully. Ready for visual analysis!`\n                });\n            }\n        } else {\n            // For other file types (PDF, TXT, etc.), process normally\n            let text = \"\";\n            try {\n                text = await (0,_lib_documentProcessor__WEBPACK_IMPORTED_MODULE_4__.processDocument)(tmp);\n                console.log(`Extracted text length: ${text.length} characters from ${file.name}`);\n            } catch (error) {\n                console.error(`Error processing document ${file.name}:`, error);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    detail: `Error processing document: ${error.message || \"Failed to extract text\"}`\n                }, {\n                    status: 500\n                });\n            }\n            if (!text || !text.trim()) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    detail: \"No text could be extracted from the document. The file might be empty, corrupted, or in an unsupported format.\"\n                }, {\n                    status: 400\n                });\n            }\n            // Clean and chunk the text\n            const cleanedText = text.trim().replace(/\\s+/g, \" \");\n            const chunks = _state__WEBPACK_IMPORTED_MODULE_5__.chunker.chunkBySentences(cleanedText);\n            if (chunks.length === 0) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    detail: \"No valid chunks could be created from the document text.\"\n                }, {\n                    status: 400\n                });\n            }\n            console.log(`Created ${chunks.length} chunks from ${file.name}`);\n            await _state__WEBPACK_IMPORTED_MODULE_5__.store.addDocuments(chunks);\n            // Verify chunks were added\n            const statsAfter = _state__WEBPACK_IMPORTED_MODULE_5__.store.getStats();\n            console.log(`After adding chunks - Total chunks in store: ${statsAfter.total_chunks}, Index size: ${statsAfter.index_size}`);\n            if (statsAfter.total_chunks === 0) {\n                console.error(\"WARNING: Chunks were not added to store!\");\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    detail: \"Error: Chunks were created but not added to the store. Please try uploading again.\"\n                }, {\n                    status: 500\n                });\n            }\n            console.log(`=== UPLOAD SUCCESS === File: ${file.name}, Chunks in store: ${statsAfter.total_chunks}`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                filename: file.name,\n                total_chunks: statsAfter.total_chunks,\n                message: `Document processed successfully. ${chunks.length} chunks created and indexed. Total chunks in store: ${statsAfter.total_chunks}`\n            });\n        }\n    } catch (e) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            detail: `Error processing document: ${e.message || e}`\n        }, {\n            status: 500\n        });\n    } finally{\n        try {\n            await node_fs_promises__WEBPACK_IMPORTED_MODULE_1___default().unlink(tmp);\n        } catch  {}\n    }\n}\nasync function writeTempFile(file) {\n    const arrayBuffer = await file.arrayBuffer();\n    const buffer = Buffer.from(arrayBuffer);\n    const filePath = node_path__WEBPACK_IMPORTED_MODULE_2___default().join(node_os__WEBPACK_IMPORTED_MODULE_3___default().tmpdir(), `${Date.now()}_${file.name}`);\n    await node_fs_promises__WEBPACK_IMPORTED_MODULE_1___default().writeFile(filePath, buffer);\n    return filePath;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEdBQVE7UUFDZixPQUFPM0QscURBQVlBLENBQUNvQixJQUFJLENBQUM7WUFBRUMsUUFBUSxDQUFDLDJCQUEyQixFQUFFc0MsRUFBRVksT0FBTyxJQUFJWixFQUFFLENBQUM7UUFBQyxHQUFHO1lBQUVyQyxRQUFRO1FBQUk7SUFDckcsU0FBVTtRQUNSLElBQUk7WUFBRSxNQUFNckIsOERBQVMsQ0FBQ2dDO1FBQU0sRUFBRSxPQUFNLENBQUM7SUFDdkM7QUFDRjtBQUVBLGVBQWVDLGNBQWNqQixJQUFVO0lBQ3JDLE1BQU02RCxjQUFjLE1BQU03RCxLQUFLNkQsV0FBVztJQUMxQyxNQUFNQyxTQUFTQyxPQUFPQyxJQUFJLENBQUNIO0lBQzNCLE1BQU12QixXQUFXckQscURBQVMsQ0FBQ0MscURBQVMsSUFBSSxDQUFDLEVBQUV5QyxLQUFLQyxHQUFHLEdBQUcsQ0FBQyxFQUFFNUIsS0FBS00sSUFBSSxDQUFDLENBQUM7SUFDcEUsTUFBTXRCLGlFQUFZLENBQUNzRCxVQUFVd0I7SUFDN0IsT0FBT3hCO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kb2NzLWNoYXQtbmV4dC8uL2FwcC9hcGkvdXBsb2FkL3JvdXRlLnRzP2E4OGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCBmcyBmcm9tIFwibm9kZTpmcy9wcm9taXNlc1wiO1xyXG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XHJcbmltcG9ydCBvcyBmcm9tIFwibm9kZTpvc1wiO1xyXG5pbXBvcnQgeyBwcm9jZXNzRG9jdW1lbnQgfSBmcm9tIFwiQC9saWIvZG9jdW1lbnRQcm9jZXNzb3JcIjtcclxuaW1wb3J0IHsgY2h1bmtlciwgc3RvcmUsIG1lZGlhRmlsZXMgfSBmcm9tIFwiLi4vX3N0YXRlXCI7XHJcbmltcG9ydCB7IHNldHRpbmdzIH0gZnJvbSBcIkAvbGliL3NldHRpbmdzXCI7XHJcbmltcG9ydCB7IGdldE1pbWVUeXBlIH0gZnJvbSBcIkAvbGliL2dlbWluaVwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSBcIm5vZGVqc1wiO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBSZXF1ZXN0KSB7XHJcbiAgY29uc29sZS5sb2coXCI9PT0gVVBMT0FEIFJFUVVFU1QgU1RBUlQgPT09XCIpO1xyXG4gIGNvbnN0IGZvcm0gPSBhd2FpdCByZXEuZm9ybURhdGEoKTtcclxuICBjb25zdCBmaWxlID0gZm9ybS5nZXQoXCJmaWxlXCIpIGFzIEZpbGUgfCBudWxsO1xyXG4gIGlmICghZmlsZSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIk5vIGZpbGUgaW4gdXBsb2FkIHJlcXVlc3RcIik7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBkZXRhaWw6IFwiZmlsZSBpcyByZXF1aXJlZFwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgfVxyXG4gIFxyXG4gIGNvbnNvbGUubG9nKGBVcGxvYWQgcmVxdWVzdCBmb3IgZmlsZTogJHtmaWxlLm5hbWV9LCBzaXplOiAke2ZpbGUuc2l6ZX0gYnl0ZXNgKTtcclxuXHJcbiAgY29uc3QgZXh0ID0gKGZpbGUubmFtZSB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpLnNsaWNlKGZpbGUubmFtZS5sYXN0SW5kZXhPZihcIi5cIikpO1xyXG4gIGNvbnN0IGFsbG93ZWQgPSBbXCIucGRmXCIsIFwiLnR4dFwiLCBcIi50ZXh0XCIsIFwiLmJ4dFwiLCBcIi5tZFwiLCBcIi5tYXJrZG93blwiLCBcIi5kb2N4XCIsIFwiLnBwdHhcIiwgXCIucG5nXCIsIFwiLmpwZ1wiLCBcIi5qcGVnXCIsIFwiLm1wM1wiLCBcIi5tcDRcIiwgXCIud2F2XCIsIFwiLm00YVwiXTtcclxuICBpZiAoIWFsbG93ZWQuaW5jbHVkZXMoZXh0KSkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZGV0YWlsOiBgVW5zdXBwb3J0ZWQgZmlsZSB0eXBlLiBBbGxvd2VkOiAke2FsbG93ZWQuam9pbihcIiwgXCIpfWAgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICB9XHJcblxyXG4gIGlmIChmaWxlLnNpemUgLyAoMTAyNCAqIDEwMjQpID4gc2V0dGluZ3MuTUFYX0ZJTEVfU0laRV9NQikge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZGV0YWlsOiBgRmlsZSB0b28gbGFyZ2UuIE1heGltdW0gc2l6ZTogJHtzZXR0aW5ncy5NQVhfRklMRV9TSVpFX01CfU1CYCB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdG1wID0gYXdhaXQgd3JpdGVUZW1wRmlsZShmaWxlKTtcclxuICBjb25zdCBpc0ltYWdlID0gW1wiLnBuZ1wiLCBcIi5qcGdcIiwgXCIuanBlZ1wiXS5pbmNsdWRlcyhleHQpO1xyXG4gIGNvbnN0IGlzVmlkZW8gPSBbXCIubXA0XCJdLmluY2x1ZGVzKGV4dCk7XHJcbiAgY29uc3QgaXNBdWRpbyA9IFtcIi5tcDNcIiwgXCIud2F2XCIsIFwiLm00YVwiXS5pbmNsdWRlcyhleHQpO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICAvLyBGb3IgaW1hZ2VzIGFuZCB2aWRlb3MsIHN0b3JlIHRoZSBmaWxlIHBlcm1hbmVudGx5IGFuZCB1c2UgR2VtaW5pIFZpc2lvblxyXG4gICAgaWYgKGlzSW1hZ2UgfHwgaXNWaWRlbykge1xyXG4gICAgICBjb25zdCB1cGxvYWRzRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIFwidXBsb2Fkc1wiKTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBhd2FpdCBmcy5ta2Rpcih1cGxvYWRzRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcclxuICAgICAgfSBjYXRjaCB7fVxyXG4gICAgICBcclxuICAgICAgY29uc3QgbWVkaWFJZCA9IGAke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpfWA7XHJcbiAgICAgIGNvbnN0IHN0b3JlZFBhdGggPSBwYXRoLmpvaW4odXBsb2Fkc0RpciwgYCR7bWVkaWFJZH0ke2V4dH1gKTtcclxuICAgICAgYXdhaXQgZnMuY29weUZpbGUodG1wLCBzdG9yZWRQYXRoKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IG1pbWVUeXBlID0gZ2V0TWltZVR5cGUoc3RvcmVkUGF0aCk7XHJcbiAgICAgIG1lZGlhRmlsZXMuc2V0KG1lZGlhSWQsIHtcclxuICAgICAgICBpZDogbWVkaWFJZCxcclxuICAgICAgICBmaWxlUGF0aDogc3RvcmVkUGF0aCxcclxuICAgICAgICBtaW1lVHlwZSxcclxuICAgICAgICBvcmlnaW5hbE5hbWU6IGZpbGUubmFtZSxcclxuICAgICAgICB0eXBlOiBpc0ltYWdlID8gXCJpbWFnZVwiIDogXCJ2aWRlb1wiXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gRm9yIHZpZGVvcywgYWxzbyBleHRyYWN0IGF1ZGlvIHRyYW5zY3JpcHQgZm9yIHRleHQgc2VhcmNoXHJcbiAgICAgIGxldCB0ZXh0ID0gXCJcIjtcclxuICAgICAgaWYgKGlzVmlkZW8pIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgdGV4dCA9IGF3YWl0IHByb2Nlc3NEb2N1bWVudCh0bXApO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBleHRyYWN0IGF1ZGlvIGZyb20gdmlkZW86XCIsIGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBOb3RlOiBWaWRlbyBmcmFtZXMgd2lsbCBiZSBleHRyYWN0ZWQgYW5kIHNlbnQgdG8gR2VtaW5pIFZpc2lvbiBkdXJpbmcgY2hhdCBxdWVyaWVzXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIEZvciBpbWFnZXMsIHdlIHN0aWxsIGRvIE9DUiBhcyBmYWxsYmFjayBmb3IgdGV4dCBzZWFyY2gsIGJ1dCBwcmltYXJ5IGFuYWx5c2lzIHdpbGwgYmUgdmlhIFZpc2lvblxyXG4gICAgICBpZiAoaXNJbWFnZSAmJiBzZXR0aW5ncy5FTkFCTEVfT0NSKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IG9jclRleHQgPSBhd2FpdCBwcm9jZXNzRG9jdW1lbnQodG1wKTtcclxuICAgICAgICAgIGlmIChvY3JUZXh0ICYmIG9jclRleHQudHJpbSgpKSB7XHJcbiAgICAgICAgICAgIHRleHQgPSBgW0ltYWdlOiAke2ZpbGUubmFtZX1dXFxuJHtvY3JUZXh0LnRyaW0oKX1gO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgT0NSIGV4dHJhY3RlZCAke29jclRleHQubGVuZ3RofSBjaGFyYWN0ZXJzIGZyb20gaW1hZ2UgJHtmaWxlLm5hbWV9YCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgY29uc29sZS53YXJuKFwiT0NSIGZhaWxlZCwgd2lsbCB1c2UgVmlzaW9uIEFQSSBvbmx5OlwiLCBlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIEFkZCB0ZXh0IGNodW5rcyBpZiBhdmFpbGFibGUgKE9DUiB0ZXh0IGZvciBpbWFnZXMsIGF1ZGlvIHRyYW5zY3JpcHQgZm9yIHZpZGVvcylcclxuICAgICAgLy8gTWFpbiBhbmFseXNpcyB3aWxsIGJlIHZpYSBWaXNpb24gQVBJLCBidXQgdGV4dCBjaHVua3MgaGVscCB3aXRoIHNlYXJjaFxyXG4gICAgICBpZiAodGV4dCAmJiB0ZXh0LnRyaW0oKSkge1xyXG4gICAgICAgIGNvbnN0IGNodW5rcyA9IGNodW5rZXIuY2h1bmtCeVNlbnRlbmNlcyh0ZXh0LnRyaW0oKSk7XHJcbiAgICAgICAgaWYgKGNodW5rcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBhd2FpdCBzdG9yZS5hZGREb2N1bWVudHMoY2h1bmtzKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBDcmVhdGVkICR7Y2h1bmtzLmxlbmd0aH0gdGV4dCBjaHVua3MgZnJvbSAke2lzSW1hZ2UgPyBcImltYWdlIE9DUlwiIDogXCJ2aWRlbyBhdWRpb1wifWApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcclxuICAgICAgICAgIGZpbGVuYW1lOiBmaWxlLm5hbWUsIFxyXG4gICAgICAgICAgdG90YWxfY2h1bmtzOiBjaHVua3MubGVuZ3RoLCBcclxuICAgICAgICAgIG1lZGlhX2lkOiBtZWRpYUlkLFxyXG4gICAgICAgICAgbWVzc2FnZTogYCR7aXNJbWFnZSA/IFwiSW1hZ2VcIiA6IFwiVmlkZW9cIn0gcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxseS4gJHtjaHVua3MubGVuZ3RoID4gMCA/IGAke2NodW5rcy5sZW5ndGh9IHRleHQgY2h1bmtzIGNyZWF0ZWQuIGAgOiBcIlwifVJlYWR5IGZvciB2aXN1YWwgYW5hbHlzaXMhYCBcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcclxuICAgICAgICAgIGZpbGVuYW1lOiBmaWxlLm5hbWUsIFxyXG4gICAgICAgICAgdG90YWxfY2h1bmtzOiAwLFxyXG4gICAgICAgICAgbWVkaWFfaWQ6IG1lZGlhSWQsXHJcbiAgICAgICAgICBtZXNzYWdlOiBgJHtpc0ltYWdlID8gXCJJbWFnZVwiIDogXCJWaWRlb1wifSB1cGxvYWRlZCBzdWNjZXNzZnVsbHkuIFJlYWR5IGZvciB2aXN1YWwgYW5hbHlzaXMhYCBcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gRm9yIG90aGVyIGZpbGUgdHlwZXMgKFBERiwgVFhULCBldGMuKSwgcHJvY2VzcyBub3JtYWxseVxyXG4gICAgICBsZXQgdGV4dCA9IFwiXCI7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgdGV4dCA9IGF3YWl0IHByb2Nlc3NEb2N1bWVudCh0bXApO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBFeHRyYWN0ZWQgdGV4dCBsZW5ndGg6ICR7dGV4dC5sZW5ndGh9IGNoYXJhY3RlcnMgZnJvbSAke2ZpbGUubmFtZX1gKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHByb2Nlc3NpbmcgZG9jdW1lbnQgJHtmaWxlLm5hbWV9OmAsIGVycm9yKTtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcclxuICAgICAgICAgIGRldGFpbDogYEVycm9yIHByb2Nlc3NpbmcgZG9jdW1lbnQ6ICR7ZXJyb3IubWVzc2FnZSB8fCBcIkZhaWxlZCB0byBleHRyYWN0IHRleHRcIn1gIFxyXG4gICAgICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmICghdGV4dCB8fCAhdGV4dC50cmltKCkpIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcclxuICAgICAgICAgIGRldGFpbDogXCJObyB0ZXh0IGNvdWxkIGJlIGV4dHJhY3RlZCBmcm9tIHRoZSBkb2N1bWVudC4gVGhlIGZpbGUgbWlnaHQgYmUgZW1wdHksIGNvcnJ1cHRlZCwgb3IgaW4gYW4gdW5zdXBwb3J0ZWQgZm9ybWF0LlwiIFxyXG4gICAgICAgIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIENsZWFuIGFuZCBjaHVuayB0aGUgdGV4dFxyXG4gICAgICBjb25zdCBjbGVhbmVkVGV4dCA9IHRleHQudHJpbSgpLnJlcGxhY2UoL1xccysvZywgXCIgXCIpO1xyXG4gICAgICBjb25zdCBjaHVua3MgPSBjaHVua2VyLmNodW5rQnlTZW50ZW5jZXMoY2xlYW5lZFRleHQpO1xyXG4gICAgICBcclxuICAgICAgaWYgKGNodW5rcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcclxuICAgICAgICAgIGRldGFpbDogXCJObyB2YWxpZCBjaHVua3MgY291bGQgYmUgY3JlYXRlZCBmcm9tIHRoZSBkb2N1bWVudCB0ZXh0LlwiIFxyXG4gICAgICAgIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGBDcmVhdGVkICR7Y2h1bmtzLmxlbmd0aH0gY2h1bmtzIGZyb20gJHtmaWxlLm5hbWV9YCk7XHJcbiAgICAgIGF3YWl0IHN0b3JlLmFkZERvY3VtZW50cyhjaHVua3MpO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZ5IGNodW5rcyB3ZXJlIGFkZGVkXHJcbiAgICAgIGNvbnN0IHN0YXRzQWZ0ZXIgPSBzdG9yZS5nZXRTdGF0cygpO1xyXG4gICAgICBjb25zb2xlLmxvZyhgQWZ0ZXIgYWRkaW5nIGNodW5rcyAtIFRvdGFsIGNodW5rcyBpbiBzdG9yZTogJHtzdGF0c0FmdGVyLnRvdGFsX2NodW5rc30sIEluZGV4IHNpemU6ICR7c3RhdHNBZnRlci5pbmRleF9zaXplfWApO1xyXG4gICAgICBcclxuICAgICAgaWYgKHN0YXRzQWZ0ZXIudG90YWxfY2h1bmtzID09PSAwKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIldBUk5JTkc6IENodW5rcyB3ZXJlIG5vdCBhZGRlZCB0byBzdG9yZSFcIik7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXHJcbiAgICAgICAgICBkZXRhaWw6IFwiRXJyb3I6IENodW5rcyB3ZXJlIGNyZWF0ZWQgYnV0IG5vdCBhZGRlZCB0byB0aGUgc3RvcmUuIFBsZWFzZSB0cnkgdXBsb2FkaW5nIGFnYWluLlwiIFxyXG4gICAgICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGA9PT0gVVBMT0FEIFNVQ0NFU1MgPT09IEZpbGU6ICR7ZmlsZS5uYW1lfSwgQ2h1bmtzIGluIHN0b3JlOiAke3N0YXRzQWZ0ZXIudG90YWxfY2h1bmtzfWApO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXHJcbiAgICAgICAgZmlsZW5hbWU6IGZpbGUubmFtZSwgXHJcbiAgICAgICAgdG90YWxfY2h1bmtzOiBzdGF0c0FmdGVyLnRvdGFsX2NodW5rcywgXHJcbiAgICAgICAgbWVzc2FnZTogYERvY3VtZW50IHByb2Nlc3NlZCBzdWNjZXNzZnVsbHkuICR7Y2h1bmtzLmxlbmd0aH0gY2h1bmtzIGNyZWF0ZWQgYW5kIGluZGV4ZWQuIFRvdGFsIGNodW5rcyBpbiBzdG9yZTogJHtzdGF0c0FmdGVyLnRvdGFsX2NodW5rc31gIFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGRldGFpbDogYEVycm9yIHByb2Nlc3NpbmcgZG9jdW1lbnQ6ICR7ZS5tZXNzYWdlIHx8IGV9YCB9LCB7IHN0YXR1czogNTAwIH0pO1xyXG4gIH0gZmluYWxseSB7XHJcbiAgICB0cnkgeyBhd2FpdCBmcy51bmxpbmsodG1wKTsgfSBjYXRjaCB7fVxyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gd3JpdGVUZW1wRmlsZShmaWxlOiBGaWxlKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTtcclxuICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcik7XHJcbiAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4ob3MudG1wZGlyKCksIGAke0RhdGUubm93KCl9XyR7ZmlsZS5uYW1lfWApO1xyXG4gIGF3YWl0IGZzLndyaXRlRmlsZShmaWxlUGF0aCwgYnVmZmVyKTtcclxuICByZXR1cm4gZmlsZVBhdGg7XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJmcyIsInBhdGgiLCJvcyIsInByb2Nlc3NEb2N1bWVudCIsImNodW5rZXIiLCJzdG9yZSIsIm1lZGlhRmlsZXMiLCJzZXR0aW5ncyIsImdldE1pbWVUeXBlIiwicnVudGltZSIsIlBPU1QiLCJyZXEiLCJjb25zb2xlIiwibG9nIiwiZm9ybSIsImZvcm1EYXRhIiwiZmlsZSIsImdldCIsImVycm9yIiwianNvbiIsImRldGFpbCIsInN0YXR1cyIsIm5hbWUiLCJzaXplIiwiZXh0IiwidG9Mb3dlckNhc2UiLCJzbGljZSIsImxhc3RJbmRleE9mIiwiYWxsb3dlZCIsImluY2x1ZGVzIiwiam9pbiIsIk1BWF9GSUxFX1NJWkVfTUIiLCJ0bXAiLCJ3cml0ZVRlbXBGaWxlIiwiaXNJbWFnZSIsImlzVmlkZW8iLCJpc0F1ZGlvIiwidXBsb2Fkc0RpciIsInByb2Nlc3MiLCJjd2QiLCJta2RpciIsInJlY3Vyc2l2ZSIsIm1lZGlhSWQiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwic3RvcmVkUGF0aCIsImNvcHlGaWxlIiwibWltZVR5cGUiLCJzZXQiLCJpZCIsImZpbGVQYXRoIiwib3JpZ2luYWxOYW1lIiwidHlwZSIsInRleHQiLCJlIiwid2FybiIsIkVOQUJMRV9PQ1IiLCJvY3JUZXh0IiwidHJpbSIsImxlbmd0aCIsImNodW5rcyIsImNodW5rQnlTZW50ZW5jZXMiLCJhZGREb2N1bWVudHMiLCJmaWxlbmFtZSIsInRvdGFsX2NodW5rcyIsIm1lZGlhX2lkIiwibWVzc2FnZSIsImNsZWFuZWRUZXh0IiwicmVwbGFjZSIsInN0YXRzQWZ0ZXIiLCJnZXRTdGF0cyIsImluZGV4X3NpemUiLCJ1bmxpbmsiLCJhcnJheUJ1ZmZlciIsImJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJ0bXBkaXIiLCJ3cml0ZUZpbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/upload/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/documentProcessor.ts":
/*!**********************************!*\
  !*** ./lib/documentProcessor.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cleanText: () => (/* binding */ cleanText),\n/* harmony export */   extractTextFromPdf: () => (/* binding */ extractTextFromPdf),\n/* harmony export */   extractTextFromTxt: () => (/* binding */ extractTextFromTxt),\n/* harmony export */   extractVideoFrames: () => (/* binding */ extractVideoFrames),\n/* harmony export */   processDocument: () => (/* binding */ processDocument)\n/* harmony export */ });\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:fs/promises */ \"node:fs/promises\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_fs_promises__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pdf-parse */ \"pdf-parse\");\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(pdf_parse__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var mammoth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mammoth */ \"mammoth\");\n/* harmony import */ var mammoth__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mammoth__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var remove_markdown__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! remove-markdown */ \"(rsc)/./node_modules/remove-markdown/index.js\");\n/* harmony import */ var remove_markdown__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(remove_markdown__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! jszip */ \"jszip\");\n/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(jszip__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var tesseract_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! tesseract.js */ \"tesseract.js\");\n/* harmony import */ var tesseract_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(tesseract_js__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./settings */ \"(rsc)/./lib/settings.ts\");\n/* harmony import */ var ffmpeg_static__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ffmpeg-static */ \"ffmpeg-static\");\n/* harmony import */ var ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(ffmpeg_static__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! node:child_process */ \"node:child_process\");\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(node_child_process__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! node:util */ \"node:util\");\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(node_util__WEBPACK_IMPORTED_MODULE_9__);\n/* harmony import */ var node_os__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! node:os */ \"node:os\");\n/* harmony import */ var node_os__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(node_os__WEBPACK_IMPORTED_MODULE_10__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var _xenova_transformers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @xenova/transformers */ \"(rsc)/./node_modules/@xenova/transformers/src/transformers.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst execFile = (0,node_util__WEBPACK_IMPORTED_MODULE_9__.promisify)(node_child_process__WEBPACK_IMPORTED_MODULE_8__.execFile);\nasync function extractTextFromPdf(filePath) {\n    try {\n        const data = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath);\n        const res = await pdf_parse__WEBPACK_IMPORTED_MODULE_1___default()(data, {\n            // Options for better text extraction\n            max: 0\n        });\n        let extractedText = res.text || \"\";\n        // If no text found, try to extract from info or metadata\n        if (!extractedText || extractedText.trim().length === 0) {\n            console.warn(\"No text extracted from PDF, might be scanned/image-based PDF\");\n        // Could try OCR here if needed, but for now just return empty\n        }\n        return extractedText;\n    } catch (e) {\n        console.error(`PDF extraction error for ${filePath}:`, e);\n        throw new Error(`Error extracting text from PDF: ${e.message || e}`);\n    }\n}\nasync function extractTextFromTxt(filePath) {\n    try {\n        const content = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath, {\n            encoding: \"utf-8\"\n        });\n        return content;\n    } catch (e) {\n        const content = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath, {\n            encoding: \"latin1\"\n        });\n        return content;\n    }\n}\nfunction cleanText(text) {\n    if (!text) return \"\";\n    // Remove excessive whitespace, normalize line breaks, and trim\n    return text.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\").replace(/\\n{3,}/g, \"\\n\\n\").split(/\\s+/).join(\" \").trim();\n}\nasync function processDocument(filePath) {\n    const lower = filePath.toLowerCase();\n    let text = \"\";\n    if (lower.endsWith(\".pdf\")) {\n        text = await extractTextFromPdf(filePath);\n    } else if (lower.endsWith(\".txt\") || lower.endsWith(\".text\") || lower.endsWith(\".bxt\")) {\n        text = await extractTextFromTxt(filePath);\n    } else if (lower.endsWith(\".md\") || lower.endsWith(\".markdown\")) {\n        const raw = await extractTextFromTxt(filePath);\n        text = remove_markdown__WEBPACK_IMPORTED_MODULE_3___default()(raw);\n    } else if (lower.endsWith(\".docx\")) {\n        try {\n            const data = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath);\n            const result = await mammoth__WEBPACK_IMPORTED_MODULE_2___default().extractRawText({\n                buffer: data\n            });\n            text = result.value || \"\";\n        } catch (e) {\n            throw new Error(`Error extracting text from DOCX: ${e.message || e}`);\n        }\n    } else if (lower.endsWith(\".pptx\")) {\n        try {\n            const data = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath);\n            const zip = await jszip__WEBPACK_IMPORTED_MODULE_4___default().loadAsync(data);\n            const slideFiles = Object.keys(zip.files).filter((p)=>p.startsWith(\"ppt/slides/slide\") && p.endsWith(\".xml\"));\n            const contents = await Promise.all(slideFiles.map(async (p)=>{\n                const file = zip.file(p);\n                if (!file) return \"\";\n                const xml = await file.async(\"text\");\n                return xml.replace(/<[^>]+>/g, \" \").replace(/&amp;/g, \"&\").replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\").replace(/&quot;/g, '\"').replace(/&#39;/g, \"'\");\n            }));\n            text = contents.join(\"\\n\");\n        } catch (e) {\n            throw new Error(`Error extracting text from PPTX: ${e.message || e}`);\n        }\n    } else {\n        if (lower.endsWith(\".png\") || lower.endsWith(\".jpg\") || lower.endsWith(\".jpeg\")) {\n            if (!_settings__WEBPACK_IMPORTED_MODULE_6__.settings.ENABLE_OCR) {\n                throw new Error(\"OCR is disabled by settings.\");\n            }\n            try {\n                const result = await tesseract_js__WEBPACK_IMPORTED_MODULE_5___default().recognize(filePath, \"eng\");\n                text = result.data.text || \"\";\n            } catch (e) {\n                throw new Error(`Error extracting text from image: ${e.message || e}`);\n            }\n        } else if (lower.endsWith(\".mp3\") || lower.endsWith(\".mp4\") || lower.endsWith(\".wav\") || lower.endsWith(\".m4a\")) {\n            const wavPath = await ensureWavMono16k(filePath);\n            const asr = await (0,_xenova_transformers__WEBPACK_IMPORTED_MODULE_12__.pipeline)(\"automatic-speech-recognition\", \"Xenova/whisper-tiny.en\");\n            const result = await asr(wavPath, {\n                chunk_length_s: 30\n            });\n            text = result?.text || \"\";\n        } else {\n            throw new Error(`Unsupported file type: ${filePath}`);\n        }\n    }\n    return cleanText(text);\n}\nasync function ensureWavMono16k(inputPath) {\n    if (!(ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default())) throw new Error(\"ffmpeg not available\");\n    const out = node_path__WEBPACK_IMPORTED_MODULE_11___default().join(node_os__WEBPACK_IMPORTED_MODULE_10___default().tmpdir(), `${Date.now()}_audio.wav`);\n    await execFile((ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default()), [\n        \"-y\",\n        \"-i\",\n        inputPath,\n        \"-ac\",\n        \"1\",\n        \"-ar\",\n        \"16000\",\n        \"-f\",\n        \"wav\",\n        out\n    ]);\n    return out;\n}\nasync function extractVideoFrames(videoPath, maxFrames = 5) {\n    if (!(ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default())) throw new Error(\"ffmpeg not available\");\n    const framePaths = [];\n    const baseTimestamp = Date.now();\n    // Extract frames at intervals (start, middle, end)\n    // Extract frames at: 0%, 25%, 50%, 75%, 100% of video (or maxFrames evenly spaced)\n    for(let i = 0; i < maxFrames; i++){\n        const framePath = node_path__WEBPACK_IMPORTED_MODULE_11___default().join(node_os__WEBPACK_IMPORTED_MODULE_10___default().tmpdir(), `${baseTimestamp}_frame_${i}.jpg`);\n        try {\n            // Use percentage-based extraction for better coverage\n            // -ss seeks to timestamp, then extract one frame\n            // We'll extract frames at regular intervals (every 10 seconds or evenly distributed)\n            const timestamp = i * 10; // Extract every 10 seconds\n            await execFile((ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default()), [\n                \"-y\",\n                \"-ss\",\n                timestamp.toString(),\n                \"-i\",\n                videoPath,\n                \"-vframes\",\n                \"1\",\n                \"-q:v\",\n                \"2\",\n                \"-vf\",\n                \"scale=800:-1\",\n                framePath\n            ], {\n                timeout: 15000\n            });\n            // Check if frame file was created and has content\n            try {\n                const stats = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().stat(framePath);\n                if (stats.size > 0) {\n                    framePaths.push(framePath);\n                }\n            } catch  {\n            // Frame not created or empty, skip\n            }\n        } catch (e) {\n            console.warn(`Failed to extract frame ${i} at ${i * 10}s:`, e);\n        // Continue with next frame\n        }\n    }\n    return framePaths;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFFbUUsY0FBYyxPQUFPLEVBQUVDLEVBQUUsSUFBSSxDQUFDO1FBRTFFLElBQUk7WUFDRixzREFBc0Q7WUFDdEQsaURBQWlEO1lBQ2pELHFGQUFxRjtZQUNyRixNQUFNRSxZQUFZRixJQUFJLElBQUksMkJBQTJCO1lBRXJELE1BQU12RSxTQUFTRCxzREFBVUEsRUFBWTtnQkFDbkM7Z0JBQ0E7Z0JBQU8wRSxVQUFVQyxRQUFRO2dCQUN6QjtnQkFBTVA7Z0JBQ047Z0JBQVk7Z0JBQ1o7Z0JBQVE7Z0JBQ1I7Z0JBQU87Z0JBQ1BLO2FBQ0QsRUFBRTtnQkFBRUcsU0FBUztZQUFNO1lBRXBCLGtEQUFrRDtZQUNsRCxJQUFJO2dCQUNGLE1BQU1DLFFBQVEsTUFBTXBGLDREQUFPLENBQUNnRjtnQkFDNUIsSUFBSUksTUFBTUUsSUFBSSxHQUFHLEdBQUc7b0JBQ2xCVCxXQUFXVSxJQUFJLENBQUNQO2dCQUNsQjtZQUNGLEVBQUUsT0FBTTtZQUNOLG1DQUFtQztZQUNyQztRQUNGLEVBQUUsT0FBT3JELEdBQUc7WUFDVkYsUUFBUUMsSUFBSSxDQUFDLENBQUMsd0JBQXdCLEVBQUVxRCxFQUFFLElBQUksRUFBRUEsSUFBSSxHQUFHLEVBQUUsQ0FBQyxFQUFFcEQ7UUFDNUQsMkJBQTJCO1FBQzdCO0lBQ0Y7SUFFQSxPQUFPa0Q7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL2RvY3MtY2hhdC1uZXh0Ly4vbGliL2RvY3VtZW50UHJvY2Vzc29yLnRzP2U0MjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gXCJub2RlOmZzL3Byb21pc2VzXCI7XHJcbmltcG9ydCBwZGYgZnJvbSBcInBkZi1wYXJzZVwiO1xyXG5pbXBvcnQgbWFtbW90aCBmcm9tIFwibWFtbW90aFwiO1xyXG5pbXBvcnQgcmVtb3ZlTWFya2Rvd24gZnJvbSBcInJlbW92ZS1tYXJrZG93blwiO1xyXG5pbXBvcnQgSlNaaXAgZnJvbSBcImpzemlwXCI7XHJcbmltcG9ydCBUZXNzZXJhY3QgZnJvbSBcInRlc3NlcmFjdC5qc1wiO1xyXG5pbXBvcnQgeyBzZXR0aW5ncyB9IGZyb20gXCIuL3NldHRpbmdzXCI7XHJcbmltcG9ydCBmZm1wZWdQYXRoIGZyb20gXCJmZm1wZWctc3RhdGljXCI7XHJcbmltcG9ydCB7IGV4ZWNGaWxlIGFzIGV4ZWNGaWxlQ2IgfSBmcm9tIFwibm9kZTpjaGlsZF9wcm9jZXNzXCI7XHJcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gXCJub2RlOnV0aWxcIjtcclxuaW1wb3J0IG9zIGZyb20gXCJub2RlOm9zXCI7XHJcbmltcG9ydCBwYXRoIGZyb20gXCJub2RlOnBhdGhcIjtcclxuaW1wb3J0IHsgcGlwZWxpbmUgYXMgaGZQaXBlbGluZSB9IGZyb20gXCJAeGVub3ZhL3RyYW5zZm9ybWVyc1wiO1xyXG5cclxuY29uc3QgZXhlY0ZpbGUgPSBwcm9taXNpZnkoZXhlY0ZpbGVDYik7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXh0cmFjdFRleHRGcm9tUGRmKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZnMucmVhZEZpbGUoZmlsZVBhdGgpO1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcGRmKGRhdGEsIHtcclxuICAgICAgLy8gT3B0aW9ucyBmb3IgYmV0dGVyIHRleHQgZXh0cmFjdGlvblxyXG4gICAgICBtYXg6IDAsIC8vIFBhcnNlIGFsbCBwYWdlc1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGxldCBleHRyYWN0ZWRUZXh0ID0gcmVzLnRleHQgfHwgXCJcIjtcclxuICAgIFxyXG4gICAgLy8gSWYgbm8gdGV4dCBmb3VuZCwgdHJ5IHRvIGV4dHJhY3QgZnJvbSBpbmZvIG9yIG1ldGFkYXRhXHJcbiAgICBpZiAoIWV4dHJhY3RlZFRleHQgfHwgZXh0cmFjdGVkVGV4dC50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcIk5vIHRleHQgZXh0cmFjdGVkIGZyb20gUERGLCBtaWdodCBiZSBzY2FubmVkL2ltYWdlLWJhc2VkIFBERlwiKTtcclxuICAgICAgLy8gQ291bGQgdHJ5IE9DUiBoZXJlIGlmIG5lZWRlZCwgYnV0IGZvciBub3cganVzdCByZXR1cm4gZW1wdHlcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGV4dHJhY3RlZFRleHQ7XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKGBQREYgZXh0cmFjdGlvbiBlcnJvciBmb3IgJHtmaWxlUGF0aH06YCwgZSk7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGV4dHJhY3RpbmcgdGV4dCBmcm9tIFBERjogJHtlLm1lc3NhZ2UgfHwgZX1gKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHRyYWN0VGV4dEZyb21UeHQoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCBmcy5yZWFkRmlsZShmaWxlUGF0aCwgeyBlbmNvZGluZzogXCJ1dGYtOFwiIH0pO1xyXG4gICAgcmV0dXJuIGNvbnRlbnQ7XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgZnMucmVhZEZpbGUoZmlsZVBhdGgsIHsgZW5jb2Rpbmc6IFwibGF0aW4xXCIgfSk7XHJcbiAgICByZXR1cm4gY29udGVudDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGVhblRleHQodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcclxuICBpZiAoIXRleHQpIHJldHVybiBcIlwiO1xyXG4gIC8vIFJlbW92ZSBleGNlc3NpdmUgd2hpdGVzcGFjZSwgbm9ybWFsaXplIGxpbmUgYnJlYWtzLCBhbmQgdHJpbVxyXG4gIHJldHVybiB0ZXh0XHJcbiAgICAucmVwbGFjZSgvXFxyXFxuL2csIFwiXFxuXCIpXHJcbiAgICAucmVwbGFjZSgvXFxyL2csIFwiXFxuXCIpXHJcbiAgICAucmVwbGFjZSgvXFxuezMsfS9nLCBcIlxcblxcblwiKVxyXG4gICAgLnNwbGl0KC9cXHMrLylcclxuICAgIC5qb2luKFwiIFwiKVxyXG4gICAgLnRyaW0oKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NEb2N1bWVudChmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICBjb25zdCBsb3dlciA9IGZpbGVQYXRoLnRvTG93ZXJDYXNlKCk7XHJcbiAgbGV0IHRleHQgPSBcIlwiO1xyXG4gIGlmIChsb3dlci5lbmRzV2l0aCgnLnBkZicpKSB7XHJcbiAgICB0ZXh0ID0gYXdhaXQgZXh0cmFjdFRleHRGcm9tUGRmKGZpbGVQYXRoKTtcclxuICB9IGVsc2UgaWYgKGxvd2VyLmVuZHNXaXRoKCcudHh0JykgfHwgbG93ZXIuZW5kc1dpdGgoJy50ZXh0JykgfHwgbG93ZXIuZW5kc1dpdGgoJy5ieHQnKSkge1xyXG4gICAgdGV4dCA9IGF3YWl0IGV4dHJhY3RUZXh0RnJvbVR4dChmaWxlUGF0aCk7XHJcbiAgfSBlbHNlIGlmIChsb3dlci5lbmRzV2l0aCgnLm1kJykgfHwgbG93ZXIuZW5kc1dpdGgoJy5tYXJrZG93bicpKSB7XHJcbiAgICBjb25zdCByYXcgPSBhd2FpdCBleHRyYWN0VGV4dEZyb21UeHQoZmlsZVBhdGgpO1xyXG4gICAgdGV4dCA9IHJlbW92ZU1hcmtkb3duKHJhdyk7XHJcbiAgfSBlbHNlIGlmIChsb3dlci5lbmRzV2l0aCgnLmRvY3gnKSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKGZpbGVQYXRoKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbWFtbW90aC5leHRyYWN0UmF3VGV4dCh7IGJ1ZmZlcjogZGF0YSB9KTtcclxuICAgICAgdGV4dCA9IHJlc3VsdC52YWx1ZSB8fCBcIlwiO1xyXG4gICAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgZXh0cmFjdGluZyB0ZXh0IGZyb20gRE9DWDogJHtlLm1lc3NhZ2UgfHwgZX1gKTtcclxuICAgIH1cclxuICB9IGVsc2UgaWYgKGxvd2VyLmVuZHNXaXRoKCcucHB0eCcpKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgZnMucmVhZEZpbGUoZmlsZVBhdGgpO1xyXG4gICAgICBjb25zdCB6aXAgPSBhd2FpdCBKU1ppcC5sb2FkQXN5bmMoZGF0YSk7XHJcbiAgICAgIGNvbnN0IHNsaWRlRmlsZXMgPSBPYmplY3Qua2V5cyh6aXAuZmlsZXMpLmZpbHRlcigocCkgPT4gcC5zdGFydHNXaXRoKCdwcHQvc2xpZGVzL3NsaWRlJykgJiYgcC5lbmRzV2l0aCgnLnhtbCcpKTtcclxuICAgICAgY29uc3QgY29udGVudHMgPSBhd2FpdCBQcm9taXNlLmFsbChzbGlkZUZpbGVzLm1hcChhc3luYyAocCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZpbGUgPSB6aXAuZmlsZShwKTtcclxuICAgICAgICBpZiAoIWZpbGUpIHJldHVybiBcIlwiO1xyXG4gICAgICAgIGNvbnN0IHhtbCA9IGF3YWl0IGZpbGUuYXN5bmMoJ3RleHQnKTtcclxuICAgICAgICByZXR1cm4geG1sLnJlcGxhY2UoLzxbXj5dKz4vZywgJyAnKS5yZXBsYWNlKC8mYW1wOy9nLCAnJicpLnJlcGxhY2UoLyZsdDsvZywgJzwnKS5yZXBsYWNlKC8mZ3Q7L2csICc+JykucmVwbGFjZSgvJnF1b3Q7L2csICdcIicpLnJlcGxhY2UoLyYjMzk7L2csIFwiJ1wiKTtcclxuICAgICAgfSkpO1xyXG4gICAgICB0ZXh0ID0gY29udGVudHMuam9pbignXFxuJyk7XHJcbiAgICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBleHRyYWN0aW5nIHRleHQgZnJvbSBQUFRYOiAke2UubWVzc2FnZSB8fCBlfWApO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBpZiAobG93ZXIuZW5kc1dpdGgoJy5wbmcnKSB8fCBsb3dlci5lbmRzV2l0aCgnLmpwZycpIHx8IGxvd2VyLmVuZHNXaXRoKCcuanBlZycpKSB7XHJcbiAgICAgIGlmICghc2V0dGluZ3MuRU5BQkxFX09DUikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk9DUiBpcyBkaXNhYmxlZCBieSBzZXR0aW5ncy5cIik7XHJcbiAgICAgIH1cclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBUZXNzZXJhY3QucmVjb2duaXplKGZpbGVQYXRoLCAnZW5nJyk7XHJcbiAgICAgICAgdGV4dCA9IHJlc3VsdC5kYXRhLnRleHQgfHwgXCJcIjtcclxuICAgICAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBleHRyYWN0aW5nIHRleHQgZnJvbSBpbWFnZTogJHtlLm1lc3NhZ2UgfHwgZX1gKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChsb3dlci5lbmRzV2l0aCgnLm1wMycpIHx8IGxvd2VyLmVuZHNXaXRoKCcubXA0JykgfHwgbG93ZXIuZW5kc1dpdGgoJy53YXYnKSB8fCBsb3dlci5lbmRzV2l0aCgnLm00YScpKSB7XHJcbiAgICAgIGNvbnN0IHdhdlBhdGggPSBhd2FpdCBlbnN1cmVXYXZNb25vMTZrKGZpbGVQYXRoKTtcclxuICAgICAgY29uc3QgYXNyID0gYXdhaXQgaGZQaXBlbGluZSgnYXV0b21hdGljLXNwZWVjaC1yZWNvZ25pdGlvbicsICdYZW5vdmEvd2hpc3Blci10aW55LmVuJyk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdDogYW55ID0gYXdhaXQgYXNyKHdhdlBhdGgsIHsgY2h1bmtfbGVuZ3RoX3M6IDMwIH0pO1xyXG4gICAgICB0ZXh0ID0gcmVzdWx0Py50ZXh0IHx8ICcnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgZmlsZSB0eXBlOiAke2ZpbGVQYXRofWApO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gY2xlYW5UZXh0KHRleHQpO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBlbnN1cmVXYXZNb25vMTZrKGlucHV0UGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICBpZiAoIWZmbXBlZ1BhdGgpIHRocm93IG5ldyBFcnJvcignZmZtcGVnIG5vdCBhdmFpbGFibGUnKTtcclxuICBjb25zdCBvdXQgPSBwYXRoLmpvaW4ob3MudG1wZGlyKCksIGAke0RhdGUubm93KCl9X2F1ZGlvLndhdmApO1xyXG4gIGF3YWl0IGV4ZWNGaWxlKGZmbXBlZ1BhdGggYXMgc3RyaW5nLCBbXHJcbiAgICAnLXknLFxyXG4gICAgJy1pJywgaW5wdXRQYXRoLFxyXG4gICAgJy1hYycsICcxJyxcclxuICAgICctYXInLCAnMTYwMDAnLFxyXG4gICAgJy1mJywgJ3dhdicsXHJcbiAgICBvdXQsXHJcbiAgXSk7XHJcbiAgcmV0dXJuIG91dDtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RWaWRlb0ZyYW1lcyh2aWRlb1BhdGg6IHN0cmluZywgbWF4RnJhbWVzOiBudW1iZXIgPSA1KTogUHJvbWlzZTxzdHJpbmdbXT4ge1xyXG4gIGlmICghZmZtcGVnUGF0aCkgdGhyb3cgbmV3IEVycm9yKCdmZm1wZWcgbm90IGF2YWlsYWJsZScpO1xyXG4gIFxyXG4gIGNvbnN0IGZyYW1lUGF0aHM6IHN0cmluZ1tdID0gW107XHJcbiAgY29uc3QgYmFzZVRpbWVzdGFtcCA9IERhdGUubm93KCk7XHJcbiAgXHJcbiAgLy8gRXh0cmFjdCBmcmFtZXMgYXQgaW50ZXJ2YWxzIChzdGFydCwgbWlkZGxlLCBlbmQpXHJcbiAgLy8gRXh0cmFjdCBmcmFtZXMgYXQ6IDAlLCAyNSUsIDUwJSwgNzUlLCAxMDAlIG9mIHZpZGVvIChvciBtYXhGcmFtZXMgZXZlbmx5IHNwYWNlZClcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IG1heEZyYW1lczsgaSsrKSB7XHJcbiAgICBjb25zdCBmcmFtZVBhdGggPSBwYXRoLmpvaW4ob3MudG1wZGlyKCksIGAke2Jhc2VUaW1lc3RhbXB9X2ZyYW1lXyR7aX0uanBnYCk7XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFVzZSBwZXJjZW50YWdlLWJhc2VkIGV4dHJhY3Rpb24gZm9yIGJldHRlciBjb3ZlcmFnZVxyXG4gICAgICAvLyAtc3Mgc2Vla3MgdG8gdGltZXN0YW1wLCB0aGVuIGV4dHJhY3Qgb25lIGZyYW1lXHJcbiAgICAgIC8vIFdlJ2xsIGV4dHJhY3QgZnJhbWVzIGF0IHJlZ3VsYXIgaW50ZXJ2YWxzIChldmVyeSAxMCBzZWNvbmRzIG9yIGV2ZW5seSBkaXN0cmlidXRlZClcclxuICAgICAgY29uc3QgdGltZXN0YW1wID0gaSAqIDEwOyAvLyBFeHRyYWN0IGV2ZXJ5IDEwIHNlY29uZHNcclxuICAgICAgXHJcbiAgICAgIGF3YWl0IGV4ZWNGaWxlKGZmbXBlZ1BhdGggYXMgc3RyaW5nLCBbXHJcbiAgICAgICAgJy15JyxcclxuICAgICAgICAnLXNzJywgdGltZXN0YW1wLnRvU3RyaW5nKCksXHJcbiAgICAgICAgJy1pJywgdmlkZW9QYXRoLFxyXG4gICAgICAgICctdmZyYW1lcycsICcxJyxcclxuICAgICAgICAnLXE6dicsICcyJywgLy8gSGlnaCBxdWFsaXR5XHJcbiAgICAgICAgJy12ZicsICdzY2FsZT04MDA6LTEnLCAvLyBSZXNpemUgZm9yIGVmZmljaWVuY3lcclxuICAgICAgICBmcmFtZVBhdGgsXHJcbiAgICAgIF0sIHsgdGltZW91dDogMTUwMDAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiBmcmFtZSBmaWxlIHdhcyBjcmVhdGVkIGFuZCBoYXMgY29udGVudFxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgZnMuc3RhdChmcmFtZVBhdGgpO1xyXG4gICAgICAgIGlmIChzdGF0cy5zaXplID4gMCkge1xyXG4gICAgICAgICAgZnJhbWVQYXRocy5wdXNoKGZyYW1lUGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIHtcclxuICAgICAgICAvLyBGcmFtZSBub3QgY3JlYXRlZCBvciBlbXB0eSwgc2tpcFxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIGV4dHJhY3QgZnJhbWUgJHtpfSBhdCAke2kgKiAxMH1zOmAsIGUpO1xyXG4gICAgICAvLyBDb250aW51ZSB3aXRoIG5leHQgZnJhbWVcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIGZyYW1lUGF0aHM7XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJmcyIsInBkZiIsIm1hbW1vdGgiLCJyZW1vdmVNYXJrZG93biIsIkpTWmlwIiwiVGVzc2VyYWN0Iiwic2V0dGluZ3MiLCJmZm1wZWdQYXRoIiwiZXhlY0ZpbGUiLCJleGVjRmlsZUNiIiwicHJvbWlzaWZ5Iiwib3MiLCJwYXRoIiwicGlwZWxpbmUiLCJoZlBpcGVsaW5lIiwiZXh0cmFjdFRleHRGcm9tUGRmIiwiZmlsZVBhdGgiLCJkYXRhIiwicmVhZEZpbGUiLCJyZXMiLCJtYXgiLCJleHRyYWN0ZWRUZXh0IiwidGV4dCIsInRyaW0iLCJsZW5ndGgiLCJjb25zb2xlIiwid2FybiIsImUiLCJlcnJvciIsIkVycm9yIiwibWVzc2FnZSIsImV4dHJhY3RUZXh0RnJvbVR4dCIsImNvbnRlbnQiLCJlbmNvZGluZyIsImNsZWFuVGV4dCIsInJlcGxhY2UiLCJzcGxpdCIsImpvaW4iLCJwcm9jZXNzRG9jdW1lbnQiLCJsb3dlciIsInRvTG93ZXJDYXNlIiwiZW5kc1dpdGgiLCJyYXciLCJyZXN1bHQiLCJleHRyYWN0UmF3VGV4dCIsImJ1ZmZlciIsInZhbHVlIiwiemlwIiwibG9hZEFzeW5jIiwic2xpZGVGaWxlcyIsIk9iamVjdCIsImtleXMiLCJmaWxlcyIsImZpbHRlciIsInAiLCJzdGFydHNXaXRoIiwiY29udGVudHMiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiZmlsZSIsInhtbCIsImFzeW5jIiwiRU5BQkxFX09DUiIsInJlY29nbml6ZSIsIndhdlBhdGgiLCJlbnN1cmVXYXZNb25vMTZrIiwiYXNyIiwiY2h1bmtfbGVuZ3RoX3MiLCJpbnB1dFBhdGgiLCJvdXQiLCJ0bXBkaXIiLCJEYXRlIiwibm93IiwiZXh0cmFjdFZpZGVvRnJhbWVzIiwidmlkZW9QYXRoIiwibWF4RnJhbWVzIiwiZnJhbWVQYXRocyIsImJhc2VUaW1lc3RhbXAiLCJpIiwiZnJhbWVQYXRoIiwidGltZXN0YW1wIiwidG9TdHJpbmciLCJ0aW1lb3V0Iiwic3RhdHMiLCJzdGF0Iiwic2l6ZSIsInB1c2giXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/documentProcessor.ts\n");

/***/ }),

/***/ "(rsc)/./lib/gemini.ts":
/*!***********************!*\
  !*** ./lib/gemini.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   buildRagPrompt: () => (/* binding */ buildRagPrompt),\n/* harmony export */   generateWithGemini: () => (/* binding */ generateWithGemini),\n/* harmony export */   getMimeType: () => (/* binding */ getMimeType)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./settings */ \"(rsc)/./lib/settings.ts\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:fs/promises */ \"node:fs/promises\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_fs_promises__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nfunction buildRagPrompt(query, relevant, history) {\n    const contexts = relevant.map((c, i)=>`[Context ${i + 1}]:\\n${c.text || \"\"}\\n`).join(\"\\n\");\n    const hist = (history || []).slice(-5).map((m)=>`${capitalize(m.role)}: ${m.content}`).join(\"\\n\");\n    return `${_settings__WEBPACK_IMPORTED_MODULE_1__.SYSTEM_PROMPT}\r\n\r\nDOCUMENT CONTEXT:\r\n${contexts}\r\n\r\n${hist ? `CONVERSATION HISTORY:\\n${hist}\\n\\n` : \"\"}USER QUESTION:\r\n${query}\r\n\r\nANSWER:`;\n}\nasync function generateWithGemini(prompt, mediaFiles) {\n    if (!_settings__WEBPACK_IMPORTED_MODULE_1__.settings.GEMINI_API_KEY) {\n        throw new Error(\"GEMINI_API_KEY not set\");\n    }\n    const genai = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(_settings__WEBPACK_IMPORTED_MODULE_1__.settings.GEMINI_API_KEY);\n    const model = genai.getGenerativeModel({\n        model: _settings__WEBPACK_IMPORTED_MODULE_1__.settings.GEMINI_MODEL\n    });\n    // Build parts array: text + media files\n    const parts = [\n        {\n            text: prompt\n        }\n    ];\n    // Add media files (images/videos) to the prompt\n    if (mediaFiles && mediaFiles.length > 0) {\n        for (const media of mediaFiles){\n            try {\n                const fileData = await node_fs_promises__WEBPACK_IMPORTED_MODULE_2___default().readFile(media.filePath);\n                const base64Data = fileData.toString(\"base64\");\n                parts.push({\n                    inline_data: {\n                        mime_type: media.mimeType,\n                        data: base64Data\n                    }\n                });\n            } catch (e) {\n                console.warn(`Failed to read media file ${media.filePath}:`, e);\n            }\n        }\n    }\n    const result = await model.generateContent({\n        contents: [\n            {\n                role: \"user\",\n                parts\n            }\n        ]\n    });\n    const text = result.response.text();\n    return text;\n}\nfunction capitalize(s) {\n    return s ? s[0].toUpperCase() + s.slice(1) : s;\n}\nfunction getMimeType(filePath) {\n    const lower = filePath.toLowerCase();\n    if (lower.endsWith(\".png\")) return \"image/png\";\n    if (lower.endsWith(\".jpg\") || lower.endsWith(\".jpeg\")) return \"image/jpeg\";\n    if (lower.endsWith(\".gif\")) return \"image/gif\";\n    if (lower.endsWith(\".webp\")) return \"image/webp\";\n    if (lower.endsWith(\".mp4\")) return \"video/mp4\";\n    if (lower.endsWith(\".webm\")) return \"video/webm\";\n    if (lower.endsWith(\".mov\")) return \"video/quicktime\";\n    return \"application/octet-stream\";\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3BDLElBQUlGLE1BQU1FLFFBQVEsQ0FBQyxTQUFTLE9BQU87SUFDbkMsT0FBTztBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZG9jcy1jaGF0LW5leHQvLi9saWIvZ2VtaW5pLnRzP2I2MzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR29vZ2xlR2VuZXJhdGl2ZUFJIH0gZnJvbSBcIkBnb29nbGUvZ2VuZXJhdGl2ZS1haVwiO1xyXG5pbXBvcnQgeyBTWVNURU1fUFJPTVBULCBzZXR0aW5ncyB9IGZyb20gXCIuL3NldHRpbmdzXCI7XHJcbmltcG9ydCBmcyBmcm9tIFwibm9kZTpmcy9wcm9taXNlc1wiO1xyXG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRSYWdQcm9tcHQocXVlcnk6IHN0cmluZywgcmVsZXZhbnQ6IHsgdGV4dD86IHN0cmluZyB9W10sIGhpc3Rvcnk/OiB7IHJvbGU6IHN0cmluZzsgY29udGVudDogc3RyaW5nIH1bXSkge1xyXG4gIGNvbnN0IGNvbnRleHRzID0gcmVsZXZhbnQubWFwKChjLCBpKSA9PiBgW0NvbnRleHQgJHtpICsgMX1dOlxcbiR7Yy50ZXh0IHx8IFwiXCJ9XFxuYCkuam9pbihcIlxcblwiKTtcclxuICBjb25zdCBoaXN0ID0gKGhpc3RvcnkgfHwgW10pLnNsaWNlKC01KS5tYXAobSA9PiBgJHtjYXBpdGFsaXplKG0ucm9sZSl9OiAke20uY29udGVudH1gKS5qb2luKFwiXFxuXCIpO1xyXG4gIHJldHVybiBgJHtTWVNURU1fUFJPTVBUfVxyXG5cclxuRE9DVU1FTlQgQ09OVEVYVDpcclxuJHtjb250ZXh0c31cclxuXHJcbiR7aGlzdCA/IGBDT05WRVJTQVRJT04gSElTVE9SWTpcXG4ke2hpc3R9XFxuXFxuYCA6IFwiXCJ9VVNFUiBRVUVTVElPTjpcclxuJHtxdWVyeX1cclxuXHJcbkFOU1dFUjpgO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVXaXRoR2VtaW5pKFxyXG4gIHByb21wdDogc3RyaW5nLCBcclxuICBtZWRpYUZpbGVzPzogeyBmaWxlUGF0aDogc3RyaW5nOyBtaW1lVHlwZTogc3RyaW5nIH1bXVxyXG4pOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gIGlmICghc2V0dGluZ3MuR0VNSU5JX0FQSV9LRVkpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkdFTUlOSV9BUElfS0VZIG5vdCBzZXRcIik7XHJcbiAgfVxyXG4gIGNvbnN0IGdlbmFpID0gbmV3IEdvb2dsZUdlbmVyYXRpdmVBSShzZXR0aW5ncy5HRU1JTklfQVBJX0tFWSk7XHJcbiAgY29uc3QgbW9kZWwgPSBnZW5haS5nZXRHZW5lcmF0aXZlTW9kZWwoeyBtb2RlbDogc2V0dGluZ3MuR0VNSU5JX01PREVMIH0pO1xyXG4gIFxyXG4gIC8vIEJ1aWxkIHBhcnRzIGFycmF5OiB0ZXh0ICsgbWVkaWEgZmlsZXNcclxuICBjb25zdCBwYXJ0czogYW55W10gPSBbeyB0ZXh0OiBwcm9tcHQgfV07XHJcbiAgXHJcbiAgLy8gQWRkIG1lZGlhIGZpbGVzIChpbWFnZXMvdmlkZW9zKSB0byB0aGUgcHJvbXB0XHJcbiAgaWYgKG1lZGlhRmlsZXMgJiYgbWVkaWFGaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICBmb3IgKGNvbnN0IG1lZGlhIG9mIG1lZGlhRmlsZXMpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBmaWxlRGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKG1lZGlhLmZpbGVQYXRoKTtcclxuICAgICAgICBjb25zdCBiYXNlNjREYXRhID0gZmlsZURhdGEudG9TdHJpbmcoJ2Jhc2U2NCcpO1xyXG4gICAgICAgIHBhcnRzLnB1c2goe1xyXG4gICAgICAgICAgaW5saW5lX2RhdGE6IHtcclxuICAgICAgICAgICAgbWltZV90eXBlOiBtZWRpYS5taW1lVHlwZSxcclxuICAgICAgICAgICAgZGF0YTogYmFzZTY0RGF0YVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gcmVhZCBtZWRpYSBmaWxlICR7bWVkaWEuZmlsZVBhdGh9OmAsIGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vZGVsLmdlbmVyYXRlQ29udGVudCh7IFxyXG4gICAgY29udGVudHM6IFt7IHJvbGU6IFwidXNlclwiLCBwYXJ0cyB9XSBcclxuICB9KTtcclxuICBjb25zdCB0ZXh0ID0gcmVzdWx0LnJlc3BvbnNlLnRleHQoKTtcclxuICByZXR1cm4gdGV4dDtcclxufVxyXG5cclxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzOiBzdHJpbmcpIHtcclxuICByZXR1cm4gcyA/IHNbMF0udG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSkgOiBzO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWltZVR5cGUoZmlsZVBhdGg6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgbG93ZXIgPSBmaWxlUGF0aC50b0xvd2VyQ2FzZSgpO1xyXG4gIGlmIChsb3dlci5lbmRzV2l0aCgnLnBuZycpKSByZXR1cm4gJ2ltYWdlL3BuZyc7XHJcbiAgaWYgKGxvd2VyLmVuZHNXaXRoKCcuanBnJykgfHwgbG93ZXIuZW5kc1dpdGgoJy5qcGVnJykpIHJldHVybiAnaW1hZ2UvanBlZyc7XHJcbiAgaWYgKGxvd2VyLmVuZHNXaXRoKCcuZ2lmJykpIHJldHVybiAnaW1hZ2UvZ2lmJztcclxuICBpZiAobG93ZXIuZW5kc1dpdGgoJy53ZWJwJykpIHJldHVybiAnaW1hZ2Uvd2VicCc7XHJcbiAgaWYgKGxvd2VyLmVuZHNXaXRoKCcubXA0JykpIHJldHVybiAndmlkZW8vbXA0JztcclxuICBpZiAobG93ZXIuZW5kc1dpdGgoJy53ZWJtJykpIHJldHVybiAndmlkZW8vd2VibSc7XHJcbiAgaWYgKGxvd2VyLmVuZHNXaXRoKCcubW92JykpIHJldHVybiAndmlkZW8vcXVpY2t0aW1lJztcclxuICByZXR1cm4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJHb29nbGVHZW5lcmF0aXZlQUkiLCJTWVNURU1fUFJPTVBUIiwic2V0dGluZ3MiLCJmcyIsImJ1aWxkUmFnUHJvbXB0IiwicXVlcnkiLCJyZWxldmFudCIsImhpc3RvcnkiLCJjb250ZXh0cyIsIm1hcCIsImMiLCJpIiwidGV4dCIsImpvaW4iLCJoaXN0Iiwic2xpY2UiLCJtIiwiY2FwaXRhbGl6ZSIsInJvbGUiLCJjb250ZW50IiwiZ2VuZXJhdGVXaXRoR2VtaW5pIiwicHJvbXB0IiwibWVkaWFGaWxlcyIsIkdFTUlOSV9BUElfS0VZIiwiRXJyb3IiLCJnZW5haSIsIm1vZGVsIiwiZ2V0R2VuZXJhdGl2ZU1vZGVsIiwiR0VNSU5JX01PREVMIiwicGFydHMiLCJsZW5ndGgiLCJtZWRpYSIsImZpbGVEYXRhIiwicmVhZEZpbGUiLCJmaWxlUGF0aCIsImJhc2U2NERhdGEiLCJ0b1N0cmluZyIsInB1c2giLCJpbmxpbmVfZGF0YSIsIm1pbWVfdHlwZSIsIm1pbWVUeXBlIiwiZGF0YSIsImUiLCJjb25zb2xlIiwid2FybiIsInJlc3VsdCIsImdlbmVyYXRlQ29udGVudCIsImNvbnRlbnRzIiwicmVzcG9uc2UiLCJzIiwidG9VcHBlckNhc2UiLCJnZXRNaW1lVHlwZSIsImxvd2VyIiwidG9Mb3dlckNhc2UiLCJlbmRzV2l0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/gemini.ts\n");

/***/ }),

/***/ "(rsc)/./lib/settings.ts":
/*!*************************!*\
  !*** ./lib/settings.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SYSTEM_PROMPT: () => (/* binding */ SYSTEM_PROMPT),\n/* harmony export */   settings: () => (/* binding */ settings)\n/* harmony export */ });\nconst settings = {\n    GEMINI_API_KEY: process.env.GEMINI_API_KEY || \"\",\n    MAX_CHUNK_SIZE: Number(process.env.MAX_CHUNK_SIZE || 1000),\n    CHUNK_OVERLAP: Number(process.env.CHUNK_OVERLAP || 200),\n    MAX_FILE_SIZE_MB: Number(process.env.MAX_FILE_SIZE_MB || 50),\n    EMBEDDING_MODEL: process.env.EMBEDDING_MODEL || \"Xenova/all-MiniLM-L6-v2\",\n    GEMINI_MODEL: process.env.GEMINI_MODEL || \"gemini-2.0-flash-exp\",\n    TEMPERATURE: Number(process.env.TEMPERATURE || 0.7),\n    MAX_OUTPUT_TOKENS: Number(process.env.MAX_OUTPUT_TOKENS || 2048),\n    ENABLE_OCR: String(process.env.ENABLE_OCR || \"true\") === \"true\",\n    ENABLE_YOUTUBE: String(process.env.ENABLE_YOUTUBE || \"true\") === \"true\",\n    MONGODB_URI: process.env.MONGODB_URI || \"mongodb://localhost:27017\",\n    MONGODB_DB_NAME: process.env.MONGODB_DB_NAME || \"docs-chat\"\n};\nconst SYSTEM_PROMPT = `You are a helpful assistant that answers questions based on the provided document context and any images provided.\r\nWhen answering:\r\n1. Use the document context provided to answer the question as accurately as possible\r\n2. If images are provided, analyze them carefully and describe what you see\r\n3. If the information is partially available in the context, provide what you can find and mention what might be missing\r\n4. If the answer cannot be found in the provided context or images, clearly state that the specific information is not available\r\n5. Be helpful and provide relevant information even if it's not an exact match to the question\r\n6. Always cite which part of the document or image you're referencing when possible`;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2V0dGluZ3MudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFlTyxNQUFNQSxXQUFxQjtJQUNoQ0MsZ0JBQWdCQyxRQUFRQyxHQUFHLENBQUNGLGNBQWMsSUFBSTtJQUM5Q0csZ0JBQWdCQyxPQUFPSCxRQUFRQyxHQUFHLENBQUNDLGNBQWMsSUFBSTtJQUNyREUsZUFBZUQsT0FBT0gsUUFBUUMsR0FBRyxDQUFDRyxhQUFhLElBQUk7SUFDbkRDLGtCQUFrQkYsT0FBT0gsUUFBUUMsR0FBRyxDQUFDSSxnQkFBZ0IsSUFBSTtJQUN6REMsaUJBQWlCTixRQUFRQyxHQUFHLENBQUNLLGVBQWUsSUFBSTtJQUNoREMsY0FBY1AsUUFBUUMsR0FBRyxDQUFDTSxZQUFZLElBQUk7SUFDMUNDLGFBQWFMLE9BQU9ILFFBQVFDLEdBQUcsQ0FBQ08sV0FBVyxJQUFJO0lBQy9DQyxtQkFBbUJOLE9BQU9ILFFBQVFDLEdBQUcsQ0FBQ1EsaUJBQWlCLElBQUk7SUFDM0RDLFlBQVlDLE9BQU9YLFFBQVFDLEdBQUcsQ0FBQ1MsVUFBVSxJQUFJLFlBQVk7SUFDekRFLGdCQUFnQkQsT0FBT1gsUUFBUUMsR0FBRyxDQUFDVyxjQUFjLElBQUksWUFBWTtJQUNqRUMsYUFBYWIsUUFBUUMsR0FBRyxDQUFDWSxXQUFXLElBQUk7SUFDeENDLGlCQUFpQmQsUUFBUUMsR0FBRyxDQUFDYSxlQUFlLElBQUk7QUFDbEQsRUFBRTtBQUVLLE1BQU1DLGdCQUFnQixDQUFDOzs7Ozs7O21GQU9xRCxDQUFDLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kb2NzLWNoYXQtbmV4dC8uL2xpYi9zZXR0aW5ncy50cz8xZDcyIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB0eXBlIFNldHRpbmdzID0ge1xyXG4gIEdFTUlOSV9BUElfS0VZOiBzdHJpbmc7XHJcbiAgTUFYX0NIVU5LX1NJWkU6IG51bWJlcjtcclxuICBDSFVOS19PVkVSTEFQOiBudW1iZXI7XHJcbiAgTUFYX0ZJTEVfU0laRV9NQjogbnVtYmVyO1xyXG4gIEVNQkVERElOR19NT0RFTDogc3RyaW5nO1xyXG4gIEdFTUlOSV9NT0RFTDogc3RyaW5nO1xyXG4gIFRFTVBFUkFUVVJFOiBudW1iZXI7XHJcbiAgTUFYX09VVFBVVF9UT0tFTlM6IG51bWJlcjtcclxuICBFTkFCTEVfT0NSOiBib29sZWFuO1xyXG4gIEVOQUJMRV9ZT1VUVUJFOiBib29sZWFuO1xyXG4gIE1PTkdPREJfVVJJOiBzdHJpbmc7XHJcbiAgTU9OR09EQl9EQl9OQU1FOiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc2V0dGluZ3M6IFNldHRpbmdzID0ge1xyXG4gIEdFTUlOSV9BUElfS0VZOiBwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWSB8fCBcIlwiLFxyXG4gIE1BWF9DSFVOS19TSVpFOiBOdW1iZXIocHJvY2Vzcy5lbnYuTUFYX0NIVU5LX1NJWkUgfHwgMTAwMCksXHJcbiAgQ0hVTktfT1ZFUkxBUDogTnVtYmVyKHByb2Nlc3MuZW52LkNIVU5LX09WRVJMQVAgfHwgMjAwKSxcclxuICBNQVhfRklMRV9TSVpFX01COiBOdW1iZXIocHJvY2Vzcy5lbnYuTUFYX0ZJTEVfU0laRV9NQiB8fCA1MCksXHJcbiAgRU1CRURESU5HX01PREVMOiBwcm9jZXNzLmVudi5FTUJFRERJTkdfTU9ERUwgfHwgXCJYZW5vdmEvYWxsLU1pbmlMTS1MNi12MlwiLFxyXG4gIEdFTUlOSV9NT0RFTDogcHJvY2Vzcy5lbnYuR0VNSU5JX01PREVMIHx8IFwiZ2VtaW5pLTIuMC1mbGFzaC1leHBcIixcclxuICBURU1QRVJBVFVSRTogTnVtYmVyKHByb2Nlc3MuZW52LlRFTVBFUkFUVVJFIHx8IDAuNyksXHJcbiAgTUFYX09VVFBVVF9UT0tFTlM6IE51bWJlcihwcm9jZXNzLmVudi5NQVhfT1VUUFVUX1RPS0VOUyB8fCAyMDQ4KSxcclxuICBFTkFCTEVfT0NSOiBTdHJpbmcocHJvY2Vzcy5lbnYuRU5BQkxFX09DUiB8fCBcInRydWVcIikgPT09IFwidHJ1ZVwiLFxyXG4gIEVOQUJMRV9ZT1VUVUJFOiBTdHJpbmcocHJvY2Vzcy5lbnYuRU5BQkxFX1lPVVRVQkUgfHwgXCJ0cnVlXCIpID09PSBcInRydWVcIixcclxuICBNT05HT0RCX1VSSTogcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkkgfHwgXCJtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3XCIsXHJcbiAgTU9OR09EQl9EQl9OQU1FOiBwcm9jZXNzLmVudi5NT05HT0RCX0RCX05BTUUgfHwgXCJkb2NzLWNoYXRcIixcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBTWVNURU1fUFJPTVBUID0gYFlvdSBhcmUgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IGFuc3dlcnMgcXVlc3Rpb25zIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBkb2N1bWVudCBjb250ZXh0IGFuZCBhbnkgaW1hZ2VzIHByb3ZpZGVkLlxyXG5XaGVuIGFuc3dlcmluZzpcclxuMS4gVXNlIHRoZSBkb2N1bWVudCBjb250ZXh0IHByb3ZpZGVkIHRvIGFuc3dlciB0aGUgcXVlc3Rpb24gYXMgYWNjdXJhdGVseSBhcyBwb3NzaWJsZVxyXG4yLiBJZiBpbWFnZXMgYXJlIHByb3ZpZGVkLCBhbmFseXplIHRoZW0gY2FyZWZ1bGx5IGFuZCBkZXNjcmliZSB3aGF0IHlvdSBzZWVcclxuMy4gSWYgdGhlIGluZm9ybWF0aW9uIGlzIHBhcnRpYWxseSBhdmFpbGFibGUgaW4gdGhlIGNvbnRleHQsIHByb3ZpZGUgd2hhdCB5b3UgY2FuIGZpbmQgYW5kIG1lbnRpb24gd2hhdCBtaWdodCBiZSBtaXNzaW5nXHJcbjQuIElmIHRoZSBhbnN3ZXIgY2Fubm90IGJlIGZvdW5kIGluIHRoZSBwcm92aWRlZCBjb250ZXh0IG9yIGltYWdlcywgY2xlYXJseSBzdGF0ZSB0aGF0IHRoZSBzcGVjaWZpYyBpbmZvcm1hdGlvbiBpcyBub3QgYXZhaWxhYmxlXHJcbjUuIEJlIGhlbHBmdWwgYW5kIHByb3ZpZGUgcmVsZXZhbnQgaW5mb3JtYXRpb24gZXZlbiBpZiBpdCdzIG5vdCBhbiBleGFjdCBtYXRjaCB0byB0aGUgcXVlc3Rpb25cclxuNi4gQWx3YXlzIGNpdGUgd2hpY2ggcGFydCBvZiB0aGUgZG9jdW1lbnQgb3IgaW1hZ2UgeW91J3JlIHJlZmVyZW5jaW5nIHdoZW4gcG9zc2libGVgO1xyXG5cclxuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiR0VNSU5JX0FQSV9LRVkiLCJwcm9jZXNzIiwiZW52IiwiTUFYX0NIVU5LX1NJWkUiLCJOdW1iZXIiLCJDSFVOS19PVkVSTEFQIiwiTUFYX0ZJTEVfU0laRV9NQiIsIkVNQkVERElOR19NT0RFTCIsIkdFTUlOSV9NT0RFTCIsIlRFTVBFUkFUVVJFIiwiTUFYX09VVFBVVF9UT0tFTlMiLCJFTkFCTEVfT0NSIiwiU3RyaW5nIiwiRU5BQkxFX1lPVVRVQkUiLCJNT05HT0RCX1VSSSIsIk1PTkdPREJfREJfTkFNRSIsIlNZU1RFTV9QUk9NUFQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/settings.ts\n");

/***/ }),

/***/ "(rsc)/./lib/textChunker.ts":
/*!****************************!*\
  !*** ./lib/textChunker.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TextChunker: () => (/* binding */ TextChunker)\n/* harmony export */ });\nclass TextChunker {\n    constructor(chunkSize = 1000, overlap = 200){\n        this.chunkSize = chunkSize;\n        this.overlap = overlap;\n    }\n    chunkBySentences(text, maxChunkSize) {\n        const limit = maxChunkSize ?? this.chunkSize;\n        const sentences = text.replace(/!/g, \".\").replace(/\\?/g, \".\").split(\".\").map((s)=>s.trim()).filter(Boolean);\n        const chunks = [];\n        let current = [];\n        let size = 0;\n        let id = 0;\n        for (const sentence of sentences){\n            const sentSize = sentence.split(/\\s+/).length;\n            if (size + sentSize > limit && current.length) {\n                chunks.push({\n                    id,\n                    text: current.join(\". \") + \".\",\n                    sentence_count: current.length,\n                    token_count: size\n                });\n                id += 1;\n                if (this.overlap > 0 && current.length > 1) {\n                    current = current.slice(-1);\n                    size = current[0].split(/\\s+/).length;\n                } else {\n                    current = [];\n                    size = 0;\n                }\n            }\n            current.push(sentence);\n            size += sentSize;\n        }\n        if (current.length) {\n            chunks.push({\n                id,\n                text: current.join(\". \") + \".\",\n                sentence_count: current.length,\n                token_count: size\n            });\n        }\n        return chunks;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdGV4dENodW5rZXIudHMiLCJtYXBwaW5ncyI6Ijs7OztBQVNPLE1BQU1BO0lBSVhDLFlBQVlDLFlBQW9CLElBQUksRUFBRUMsVUFBa0IsR0FBRyxDQUFFO1FBQzNELElBQUksQ0FBQ0QsU0FBUyxHQUFHQTtRQUNqQixJQUFJLENBQUNDLE9BQU8sR0FBR0E7SUFDakI7SUFFQUMsaUJBQWlCQyxJQUFZLEVBQUVDLFlBQXFCLEVBQVc7UUFDN0QsTUFBTUMsUUFBUUQsZ0JBQWdCLElBQUksQ0FBQ0osU0FBUztRQUM1QyxNQUFNTSxZQUFZSCxLQUFLSSxPQUFPLENBQUMsTUFBTSxLQUFLQSxPQUFPLENBQUMsT0FBTyxLQUFLQyxLQUFLLENBQUMsS0FBS0MsR0FBRyxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFQyxJQUFJLElBQUlDLE1BQU0sQ0FBQ0M7UUFDbkcsTUFBTUMsU0FBa0IsRUFBRTtRQUMxQixJQUFJQyxVQUFvQixFQUFFO1FBQzFCLElBQUlDLE9BQU87UUFDWCxJQUFJQyxLQUFLO1FBRVQsS0FBSyxNQUFNQyxZQUFZWixVQUFXO1lBQ2hDLE1BQU1hLFdBQVdELFNBQVNWLEtBQUssQ0FBQyxPQUFPWSxNQUFNO1lBQzdDLElBQUlKLE9BQU9HLFdBQVdkLFNBQVNVLFFBQVFLLE1BQU0sRUFBRTtnQkFDN0NOLE9BQU9PLElBQUksQ0FBQztvQkFBRUo7b0JBQUlkLE1BQU1ZLFFBQVFPLElBQUksQ0FBQyxRQUFRO29CQUFLQyxnQkFBZ0JSLFFBQVFLLE1BQU07b0JBQUVJLGFBQWFSO2dCQUFLO2dCQUNwR0MsTUFBTTtnQkFDTixJQUFJLElBQUksQ0FBQ2hCLE9BQU8sR0FBRyxLQUFLYyxRQUFRSyxNQUFNLEdBQUcsR0FBRztvQkFDMUNMLFVBQVVBLFFBQVFVLEtBQUssQ0FBQyxDQUFDO29CQUN6QlQsT0FBT0QsT0FBTyxDQUFDLEVBQUUsQ0FBQ1AsS0FBSyxDQUFDLE9BQU9ZLE1BQU07Z0JBQ3ZDLE9BQU87b0JBQ0xMLFVBQVUsRUFBRTtvQkFDWkMsT0FBTztnQkFDVDtZQUNGO1lBQ0FELFFBQVFNLElBQUksQ0FBQ0g7WUFDYkYsUUFBUUc7UUFDVjtRQUNBLElBQUlKLFFBQVFLLE1BQU0sRUFBRTtZQUNsQk4sT0FBT08sSUFBSSxDQUFDO2dCQUFFSjtnQkFBSWQsTUFBTVksUUFBUU8sSUFBSSxDQUFDLFFBQVE7Z0JBQUtDLGdCQUFnQlIsUUFBUUssTUFBTTtnQkFBRUksYUFBYVI7WUFBSztRQUN0RztRQUNBLE9BQU9GO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2RvY3MtY2hhdC1uZXh0Ly4vbGliL3RleHRDaHVua2VyLnRzPzc4NDAiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgQ2h1bmsgPSB7XHJcbiAgaWQ6IG51bWJlcjtcclxuICB0ZXh0OiBzdHJpbmc7XHJcbiAgdG9rZW5fY291bnQ/OiBudW1iZXI7XHJcbiAgc2VudGVuY2VfY291bnQ/OiBudW1iZXI7XHJcbiAgc3RhcnRfcG9zPzogbnVtYmVyO1xyXG4gIGVuZF9wb3M/OiBudW1iZXI7XHJcbn07XHJcblxyXG5leHBvcnQgY2xhc3MgVGV4dENodW5rZXIge1xyXG4gIHByaXZhdGUgY2h1bmtTaXplOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBvdmVybGFwOiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGNodW5rU2l6ZTogbnVtYmVyID0gMTAwMCwgb3ZlcmxhcDogbnVtYmVyID0gMjAwKSB7XHJcbiAgICB0aGlzLmNodW5rU2l6ZSA9IGNodW5rU2l6ZTtcclxuICAgIHRoaXMub3ZlcmxhcCA9IG92ZXJsYXA7XHJcbiAgfVxyXG5cclxuICBjaHVua0J5U2VudGVuY2VzKHRleHQ6IHN0cmluZywgbWF4Q2h1bmtTaXplPzogbnVtYmVyKTogQ2h1bmtbXSB7XHJcbiAgICBjb25zdCBsaW1pdCA9IG1heENodW5rU2l6ZSA/PyB0aGlzLmNodW5rU2l6ZTtcclxuICAgIGNvbnN0IHNlbnRlbmNlcyA9IHRleHQucmVwbGFjZSgvIS9nLCBcIi5cIikucmVwbGFjZSgvXFw/L2csIFwiLlwiKS5zcGxpdChcIi5cIikubWFwKHMgPT4gcy50cmltKCkpLmZpbHRlcihCb29sZWFuKTtcclxuICAgIGNvbnN0IGNodW5rczogQ2h1bmtbXSA9IFtdO1xyXG4gICAgbGV0IGN1cnJlbnQ6IHN0cmluZ1tdID0gW107XHJcbiAgICBsZXQgc2l6ZSA9IDA7XHJcbiAgICBsZXQgaWQgPSAwO1xyXG5cclxuICAgIGZvciAoY29uc3Qgc2VudGVuY2Ugb2Ygc2VudGVuY2VzKSB7XHJcbiAgICAgIGNvbnN0IHNlbnRTaXplID0gc2VudGVuY2Uuc3BsaXQoL1xccysvKS5sZW5ndGg7XHJcbiAgICAgIGlmIChzaXplICsgc2VudFNpemUgPiBsaW1pdCAmJiBjdXJyZW50Lmxlbmd0aCkge1xyXG4gICAgICAgIGNodW5rcy5wdXNoKHsgaWQsIHRleHQ6IGN1cnJlbnQuam9pbignLiAnKSArICcuJywgc2VudGVuY2VfY291bnQ6IGN1cnJlbnQubGVuZ3RoLCB0b2tlbl9jb3VudDogc2l6ZSB9KTtcclxuICAgICAgICBpZCArPSAxO1xyXG4gICAgICAgIGlmICh0aGlzLm92ZXJsYXAgPiAwICYmIGN1cnJlbnQubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQuc2xpY2UoLTEpO1xyXG4gICAgICAgICAgc2l6ZSA9IGN1cnJlbnRbMF0uc3BsaXQoL1xccysvKS5sZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGN1cnJlbnQgPSBbXTtcclxuICAgICAgICAgIHNpemUgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBjdXJyZW50LnB1c2goc2VudGVuY2UpO1xyXG4gICAgICBzaXplICs9IHNlbnRTaXplO1xyXG4gICAgfVxyXG4gICAgaWYgKGN1cnJlbnQubGVuZ3RoKSB7XHJcbiAgICAgIGNodW5rcy5wdXNoKHsgaWQsIHRleHQ6IGN1cnJlbnQuam9pbignLiAnKSArICcuJywgc2VudGVuY2VfY291bnQ6IGN1cnJlbnQubGVuZ3RoLCB0b2tlbl9jb3VudDogc2l6ZSB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBjaHVua3M7XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibmFtZXMiOlsiVGV4dENodW5rZXIiLCJjb25zdHJ1Y3RvciIsImNodW5rU2l6ZSIsIm92ZXJsYXAiLCJjaHVua0J5U2VudGVuY2VzIiwidGV4dCIsIm1heENodW5rU2l6ZSIsImxpbWl0Iiwic2VudGVuY2VzIiwicmVwbGFjZSIsInNwbGl0IiwibWFwIiwicyIsInRyaW0iLCJmaWx0ZXIiLCJCb29sZWFuIiwiY2h1bmtzIiwiY3VycmVudCIsInNpemUiLCJpZCIsInNlbnRlbmNlIiwic2VudFNpemUiLCJsZW5ndGgiLCJwdXNoIiwiam9pbiIsInNlbnRlbmNlX2NvdW50IiwidG9rZW5fY291bnQiLCJzbGljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/textChunker.ts\n");

/***/ }),

/***/ "(rsc)/./lib/vectorStore.ts":
/*!****************************!*\
  !*** ./lib/vectorStore.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   VectorStore: () => (/* binding */ VectorStore)\n/* harmony export */ });\n/* harmony import */ var _xenova_transformers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @xenova/transformers */ \"(rsc)/./node_modules/@xenova/transformers/src/transformers.js\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_1__);\n\n\nclass VectorStore {\n    constructor(modelName, mongoUri, dbName){\n        this.chunks = [];\n        this.embeddings = [];\n        this.embedderPromise = null;\n        this.client = null;\n        this.db = null;\n        this.collection = null;\n        this.isConnected = false;\n        this.modelName = modelName;\n        this.useMongo = Boolean(mongoUri);\n        if (mongoUri) {\n            this.client = new mongodb__WEBPACK_IMPORTED_MODULE_1__.MongoClient(mongoUri);\n            this.initMongo(dbName || \"docs-chat\").catch((err)=>{\n                console.error(\"Failed to initialize MongoDB:\", err);\n            });\n        }\n    }\n    async initMongo(dbName) {\n        try {\n            if (!this.client) {\n                console.warn(\"MongoDB client not initialized\");\n                this.isConnected = false;\n                return;\n            }\n            await this.client.connect();\n            this.db = this.client.db(dbName);\n            this.collection = this.db.collection(\"chunks\");\n            // Create index on id for faster lookups\n            try {\n                await this.collection.createIndex({\n                    id: 1\n                });\n            } catch (idxErr) {\n                // Index might already exist, that's okay\n                console.log(\"Index creation note:\", idxErr);\n            }\n            this.isConnected = true;\n            console.log(`Connected to MongoDB database: ${dbName}`);\n            await this.loadFromMongo();\n        } catch (err) {\n            console.error(\"MongoDB connection error:\", err.message || err);\n            console.warn(\"Falling back to in-memory storage. Data will not persist.\");\n            this.isConnected = false;\n        // Continue with in-memory mode - the app will still work\n        }\n    }\n    async loadFromMongo() {\n        if (!this.collection || !this.isConnected) {\n            console.log(\"Skipping MongoDB load - not connected\");\n            return;\n        }\n        try {\n            const documents = await this.collection.find({}).sort({\n                id: 1\n            }).toArray();\n            // Only load if we don't already have chunks in memory (to avoid overwriting)\n            if (this.chunks.length === 0 && documents.length > 0) {\n                this.chunks = documents.map((doc)=>({\n                        id: doc.id,\n                        text: doc.text\n                    }));\n                this.embeddings = documents.map((doc)=>new Float32Array(doc.embedding));\n                console.log(`Loaded ${this.chunks.length} chunks from MongoDB`);\n            } else if (this.chunks.length > 0) {\n                console.log(`Skipping MongoDB load - already have ${this.chunks.length} chunks in memory`);\n            } else {\n                console.log(\"No chunks in MongoDB to load\");\n            }\n        } catch (err) {\n            console.error(\"Failed to load from MongoDB:\", err);\n        }\n    }\n    async getEmbedder() {\n        if (!this.embedderPromise) {\n            const model = this.modelName.includes(\"/\") ? this.modelName : `Xenova/${this.modelName}`;\n            this.embedderPromise = (0,_xenova_transformers__WEBPACK_IMPORTED_MODULE_0__.pipeline)(\"feature-extraction\", model);\n        }\n        return this.embedderPromise;\n    }\n    async addDocuments(chunks) {\n        if (!chunks.length) {\n            console.warn(\"addDocuments called with empty chunks array\");\n            return;\n        }\n        console.log(`Adding ${chunks.length} chunks to vector store. Current chunks: ${this.chunks.length}`);\n        const embedder = await this.getEmbedder();\n        const texts = chunks.map((c)=>c.text);\n        const outputs = await embedder(texts, {\n            pooling: \"mean\",\n            normalize: true\n        });\n        const vectors = outputs.tolist().map((row)=>new Float32Array(row));\n        // Determine starting ID\n        const startId = this.chunks.length > 0 ? Math.max(...this.chunks.map((c)=>c.id)) + 1 : 0;\n        const chunksWithIds = chunks.map((chunk, i)=>({\n                ...chunk,\n                id: startId + i\n            }));\n        // Add to memory FIRST (this ensures in-memory mode works even if MongoDB fails)\n        this.chunks.push(...chunksWithIds);\n        this.embeddings.push(...vectors);\n        console.log(`Added ${chunksWithIds.length} chunks to memory. Total chunks now: ${this.chunks.length}`);\n        // Save to MongoDB if connected (this is optional - memory storage is primary)\n        if (this.collection && this.isConnected) {\n            try {\n                const documents = chunksWithIds.map((chunk, i)=>({\n                        id: chunk.id,\n                        text: chunk.text,\n                        embedding: Array.from(vectors[i]),\n                        createdAt: new Date()\n                    }));\n                await this.collection.insertMany(documents);\n                console.log(`Saved ${documents.length} chunks to MongoDB`);\n            } catch (err) {\n                console.error(\"Failed to save to MongoDB (continuing with in-memory storage):\", err);\n            // Continue even if MongoDB save fails - memory storage is already done\n            }\n        } else {\n            console.log(`MongoDB not connected (isConnected: ${this.isConnected}), using in-memory storage only`);\n        }\n    }\n    async search(query, topK = 5) {\n        if (this.chunks.length === 0) return [];\n        const embedder = await this.getEmbedder();\n        const out = await embedder(query, {\n            pooling: \"mean\",\n            normalize: true\n        });\n        const q = new Float32Array(out.tolist()[0]);\n        // Calculate cosine similarity for all embeddings\n        const scores = this.embeddings.map((v)=>cosineSimilarity(q, v));\n        // Sort by score and get top K\n        const indices = scores.map((s, i)=>[\n                s,\n                i\n            ]).sort((a, b)=>b[0] - a[0]).slice(0, Math.min(topK, scores.length));\n        return indices.map(([score, i])=>({\n                chunk: this.chunks[i],\n                score\n            }));\n    }\n    async clear() {\n        this.chunks = [];\n        this.embeddings = [];\n        if (this.collection && this.isConnected) {\n            try {\n                const result = await this.collection.deleteMany({});\n                console.log(`Cleared ${result.deletedCount} chunks from MongoDB`);\n            } catch (err) {\n                console.error(\"Failed to clear MongoDB:\", err);\n            // Continue even if MongoDB clear fails - memory is already cleared\n            }\n        }\n    }\n    getStats() {\n        return {\n            total_chunks: this.chunks.length,\n            dimension: this.embeddings[0]?.length || 0,\n            model_name: this.modelName,\n            index_size: this.embeddings.length\n        };\n    }\n    async close() {\n        if (this.client && this.isConnected) {\n            await this.client.close();\n            this.isConnected = false;\n        }\n    }\n}\nfunction cosineSimilarity(a, b) {\n    let dot = 0;\n    let na = 0;\n    let nb = 0;\n    for(let i = 0; i < a.length && i < b.length; i++){\n        dot += a[i] * b[i];\n        na += a[i] * a[i];\n        nb += b[i] * b[i];\n    }\n    if (na === 0 || nb === 0) return 0;\n    return dot / (Math.sqrt(na) * Math.sqrt(nb));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdmVjdG9yU3RvcmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFnRDtBQUVNO0FBWS9DLE1BQU1FO0lBV1hDLFlBQVlDLFNBQWlCLEVBQUVDLFFBQWlCLEVBQUVDLE1BQWUsQ0FBRTthQVYzREMsU0FBa0IsRUFBRTthQUNwQkMsYUFBMEIsRUFBRTthQUM1QkMsa0JBQXVDO2FBRXZDQyxTQUE2QjthQUM3QkMsS0FBZ0I7YUFDaEJDLGFBQStDO2FBRS9DQyxjQUF1QjtRQUc3QixJQUFJLENBQUNULFNBQVMsR0FBR0E7UUFDakIsSUFBSSxDQUFDVSxRQUFRLEdBQUdDLFFBQVFWO1FBRXhCLElBQUlBLFVBQVU7WUFDWixJQUFJLENBQUNLLE1BQU0sR0FBRyxJQUFJVCxnREFBV0EsQ0FBQ0k7WUFDOUIsSUFBSSxDQUFDVyxTQUFTLENBQUNWLFVBQVUsYUFBYVcsS0FBSyxDQUFDLENBQUNDO2dCQUMzQ0MsUUFBUUMsS0FBSyxDQUFDLGlDQUFpQ0Y7WUFDakQ7UUFDRjtJQUNGO0lBRUEsTUFBY0YsVUFBVVYsTUFBYyxFQUFFO1FBQ3RDLElBQUk7WUFDRixJQUFJLENBQUMsSUFBSSxDQUFDSSxNQUFNLEVBQUU7Z0JBQ2hCUyxRQUFRRSxJQUFJLENBQUM7Z0JBQ2IsSUFBSSxDQUFDUixXQUFXLEdBQUc7Z0JBQ25CO1lBQ0Y7WUFFQSxNQUFNLElBQUksQ0FBQ0gsTUFBTSxDQUFDWSxPQUFPO1lBQ3pCLElBQUksQ0FBQ1gsRUFBRSxHQUFHLElBQUksQ0FBQ0QsTUFBTSxDQUFDQyxFQUFFLENBQUNMO1lBQ3pCLElBQUksQ0FBQ00sVUFBVSxHQUFHLElBQUksQ0FBQ0QsRUFBRSxDQUFDQyxVQUFVLENBQWdCO1lBRXBELHdDQUF3QztZQUN4QyxJQUFJO2dCQUNGLE1BQU0sSUFBSSxDQUFDQSxVQUFVLENBQUNXLFdBQVcsQ0FBQztvQkFBRUMsSUFBSTtnQkFBRTtZQUM1QyxFQUFFLE9BQU9DLFFBQVE7Z0JBQ2YseUNBQXlDO2dCQUN6Q04sUUFBUU8sR0FBRyxDQUFDLHdCQUF3QkQ7WUFDdEM7WUFFQSxJQUFJLENBQUNaLFdBQVcsR0FBRztZQUNuQk0sUUFBUU8sR0FBRyxDQUFDLENBQUMsK0JBQStCLEVBQUVwQixPQUFPLENBQUM7WUFDdEQsTUFBTSxJQUFJLENBQUNxQixhQUFhO1FBQzFCLEVBQUUsT0FBT1QsS0FBVTtZQUNqQkMsUUFBUUMsS0FBSyxDQUFDLDZCQUE2QkYsSUFBSVUsT0FBTyxJQUFJVjtZQUMxREMsUUFBUUUsSUFBSSxDQUFDO1lBQ2IsSUFBSSxDQUFDUixXQUFXLEdBQUc7UUFDbkIseURBQXlEO1FBQzNEO0lBQ0Y7SUFFQSxNQUFjYyxnQkFBZ0I7UUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQ2YsVUFBVSxJQUFJLENBQUMsSUFBSSxDQUFDQyxXQUFXLEVBQUU7WUFDekNNLFFBQVFPLEdBQUcsQ0FBQztZQUNaO1FBQ0Y7UUFFQSxJQUFJO1lBQ0YsTUFBTUcsWUFBWSxNQUFNLElBQUksQ0FBQ2pCLFVBQVUsQ0FBQ2tCLElBQUksQ0FBQyxDQUFDLEdBQUdDLElBQUksQ0FBQztnQkFBRVAsSUFBSTtZQUFFLEdBQUdRLE9BQU87WUFFeEUsNkVBQTZFO1lBQzdFLElBQUksSUFBSSxDQUFDekIsTUFBTSxDQUFDMEIsTUFBTSxLQUFLLEtBQUtKLFVBQVVJLE1BQU0sR0FBRyxHQUFHO2dCQUNwRCxJQUFJLENBQUMxQixNQUFNLEdBQUdzQixVQUFVSyxHQUFHLENBQUMsQ0FBQ0MsTUFBUzt3QkFDcENYLElBQUlXLElBQUlYLEVBQUU7d0JBQ1ZZLE1BQU1ELElBQUlDLElBQUk7b0JBQ2hCO2dCQUNBLElBQUksQ0FBQzVCLFVBQVUsR0FBR3FCLFVBQVVLLEdBQUcsQ0FBQyxDQUFDQyxNQUMvQixJQUFJRSxhQUFhRixJQUFJRyxTQUFTO2dCQUVoQ25CLFFBQVFPLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUNuQixNQUFNLENBQUMwQixNQUFNLENBQUMsb0JBQW9CLENBQUM7WUFDaEUsT0FBTyxJQUFJLElBQUksQ0FBQzFCLE1BQU0sQ0FBQzBCLE1BQU0sR0FBRyxHQUFHO2dCQUNqQ2QsUUFBUU8sR0FBRyxDQUFDLENBQUMscUNBQXFDLEVBQUUsSUFBSSxDQUFDbkIsTUFBTSxDQUFDMEIsTUFBTSxDQUFDLGlCQUFpQixDQUFDO1lBQzNGLE9BQU87Z0JBQ0xkLFFBQVFPLEdBQUcsQ0FBQztZQUNkO1FBQ0YsRUFBRSxPQUFPUixLQUFLO1lBQ1pDLFFBQVFDLEtBQUssQ0FBQyxnQ0FBZ0NGO1FBQ2hEO0lBQ0Y7SUFFQSxNQUFjcUIsY0FBYztRQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDOUIsZUFBZSxFQUFFO1lBQ3pCLE1BQU0rQixRQUFRLElBQUksQ0FBQ3BDLFNBQVMsQ0FBQ3FDLFFBQVEsQ0FBQyxPQUFPLElBQUksQ0FBQ3JDLFNBQVMsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUNBLFNBQVMsQ0FBQyxDQUFDO1lBQ3hGLElBQUksQ0FBQ0ssZUFBZSxHQUFHVCw4REFBUUEsQ0FBQyxzQkFBc0J3QztRQUN4RDtRQUNBLE9BQU8sSUFBSSxDQUFDL0IsZUFBZTtJQUM3QjtJQUVBLE1BQU1pQyxhQUFhbkMsTUFBZSxFQUFpQjtRQUNqRCxJQUFJLENBQUNBLE9BQU8wQixNQUFNLEVBQUU7WUFDbEJkLFFBQVFFLElBQUksQ0FBQztZQUNiO1FBQ0Y7UUFFQUYsUUFBUU8sR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFbkIsT0FBTzBCLE1BQU0sQ0FBQyx5Q0FBeUMsRUFBRSxJQUFJLENBQUMxQixNQUFNLENBQUMwQixNQUFNLENBQUMsQ0FBQztRQUVuRyxNQUFNVSxXQUFXLE1BQU0sSUFBSSxDQUFDSixXQUFXO1FBQ3ZDLE1BQU1LLFFBQVFyQyxPQUFPMkIsR0FBRyxDQUFDVyxDQUFBQSxJQUFLQSxFQUFFVCxJQUFJO1FBQ3BDLE1BQU1VLFVBQVUsTUFBTUgsU0FBU0MsT0FBTztZQUFFRyxTQUFTO1lBQVFDLFdBQVc7UUFBSztRQUN6RSxNQUFNQyxVQUF1QkgsUUFBUUksTUFBTSxHQUFHaEIsR0FBRyxDQUFDLENBQUNpQixNQUFrQixJQUFJZCxhQUFhYztRQUV0Rix3QkFBd0I7UUFDeEIsTUFBTUMsVUFBVSxJQUFJLENBQUM3QyxNQUFNLENBQUMwQixNQUFNLEdBQUcsSUFBSW9CLEtBQUtDLEdBQUcsSUFBSSxJQUFJLENBQUMvQyxNQUFNLENBQUMyQixHQUFHLENBQUNXLENBQUFBLElBQUtBLEVBQUVyQixFQUFFLEtBQUssSUFBSTtRQUN2RixNQUFNK0IsZ0JBQWdCaEQsT0FBTzJCLEdBQUcsQ0FBQyxDQUFDc0IsT0FBT0MsSUFBTztnQkFBRSxHQUFHRCxLQUFLO2dCQUFFaEMsSUFBSTRCLFVBQVVLO1lBQUU7UUFFNUUsZ0ZBQWdGO1FBQ2hGLElBQUksQ0FBQ2xELE1BQU0sQ0FBQ21ELElBQUksSUFBSUg7UUFDcEIsSUFBSSxDQUFDL0MsVUFBVSxDQUFDa0QsSUFBSSxJQUFJVDtRQUV4QjlCLFFBQVFPLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRTZCLGNBQWN0QixNQUFNLENBQUMscUNBQXFDLEVBQUUsSUFBSSxDQUFDMUIsTUFBTSxDQUFDMEIsTUFBTSxDQUFDLENBQUM7UUFFckcsOEVBQThFO1FBQzlFLElBQUksSUFBSSxDQUFDckIsVUFBVSxJQUFJLElBQUksQ0FBQ0MsV0FBVyxFQUFFO1lBQ3ZDLElBQUk7Z0JBQ0YsTUFBTWdCLFlBQTZCMEIsY0FBY3JCLEdBQUcsQ0FBQyxDQUFDc0IsT0FBT0MsSUFBTzt3QkFDbEVqQyxJQUFJZ0MsTUFBTWhDLEVBQUU7d0JBQ1pZLE1BQU1vQixNQUFNcEIsSUFBSTt3QkFDaEJFLFdBQVdxQixNQUFNQyxJQUFJLENBQUNYLE9BQU8sQ0FBQ1EsRUFBRTt3QkFDaENJLFdBQVcsSUFBSUM7b0JBQ2pCO2dCQUVBLE1BQU0sSUFBSSxDQUFDbEQsVUFBVSxDQUFDbUQsVUFBVSxDQUFDbEM7Z0JBQ2pDVixRQUFRTyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUVHLFVBQVVJLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQztZQUMzRCxFQUFFLE9BQU9mLEtBQUs7Z0JBQ1pDLFFBQVFDLEtBQUssQ0FBQyxrRUFBa0VGO1lBQ2hGLHVFQUF1RTtZQUN6RTtRQUNGLE9BQU87WUFDTEMsUUFBUU8sR0FBRyxDQUFDLENBQUMsb0NBQW9DLEVBQUUsSUFBSSxDQUFDYixXQUFXLENBQUMsK0JBQStCLENBQUM7UUFDdEc7SUFDRjtJQUVBLE1BQU1tRCxPQUFPQyxLQUFhLEVBQUVDLE9BQWUsQ0FBQyxFQUE4QztRQUN4RixJQUFJLElBQUksQ0FBQzNELE1BQU0sQ0FBQzBCLE1BQU0sS0FBSyxHQUFHLE9BQU8sRUFBRTtRQUV2QyxNQUFNVSxXQUFXLE1BQU0sSUFBSSxDQUFDSixXQUFXO1FBQ3ZDLE1BQU00QixNQUFNLE1BQU14QixTQUFTc0IsT0FBTztZQUFFbEIsU0FBUztZQUFRQyxXQUFXO1FBQUs7UUFDckUsTUFBTW9CLElBQUksSUFBSS9CLGFBQWE4QixJQUFJakIsTUFBTSxFQUFFLENBQUMsRUFBRTtRQUUxQyxpREFBaUQ7UUFDakQsTUFBTW1CLFNBQVMsSUFBSSxDQUFDN0QsVUFBVSxDQUFDMEIsR0FBRyxDQUFDLENBQUNvQyxJQUFNQyxpQkFBaUJILEdBQUdFO1FBRTlELDhCQUE4QjtRQUM5QixNQUFNRSxVQUFVSCxPQUNibkMsR0FBRyxDQUFDLENBQUN1QyxHQUFHaEIsSUFBTTtnQkFBQ2dCO2dCQUFHaEI7YUFBRSxFQUNwQjFCLElBQUksQ0FBQyxDQUFDMkMsR0FBR0MsSUFBTUEsQ0FBQyxDQUFDLEVBQUUsR0FBR0QsQ0FBQyxDQUFDLEVBQUUsRUFDMUJFLEtBQUssQ0FBQyxHQUFHdkIsS0FBS3dCLEdBQUcsQ0FBQ1gsTUFBTUcsT0FBT3BDLE1BQU07UUFFeEMsT0FBT3VDLFFBQVF0QyxHQUFHLENBQUMsQ0FBQyxDQUFDNEMsT0FBT3JCLEVBQUUsR0FBTTtnQkFDbENELE9BQU8sSUFBSSxDQUFDakQsTUFBTSxDQUFDa0QsRUFBRTtnQkFDckJxQjtZQUNGO0lBQ0Y7SUFFQSxNQUFNQyxRQUFRO1FBQ1osSUFBSSxDQUFDeEUsTUFBTSxHQUFHLEVBQUU7UUFDaEIsSUFBSSxDQUFDQyxVQUFVLEdBQUcsRUFBRTtRQUVwQixJQUFJLElBQUksQ0FBQ0ksVUFBVSxJQUFJLElBQUksQ0FBQ0MsV0FBVyxFQUFFO1lBQ3ZDLElBQUk7Z0JBQ0YsTUFBTW1FLFNBQVMsTUFBTSxJQUFJLENBQUNwRSxVQUFVLENBQUNxRSxVQUFVLENBQUMsQ0FBQztnQkFDakQ5RCxRQUFRTyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUVzRCxPQUFPRSxZQUFZLENBQUMsb0JBQW9CLENBQUM7WUFDbEUsRUFBRSxPQUFPaEUsS0FBSztnQkFDWkMsUUFBUUMsS0FBSyxDQUFDLDRCQUE0QkY7WUFDMUMsbUVBQW1FO1lBQ3JFO1FBQ0Y7SUFDRjtJQUVBaUUsV0FBVztRQUNULE9BQU87WUFDTEMsY0FBYyxJQUFJLENBQUM3RSxNQUFNLENBQUMwQixNQUFNO1lBQ2hDb0QsV0FBVyxJQUFJLENBQUM3RSxVQUFVLENBQUMsRUFBRSxFQUFFeUIsVUFBVTtZQUN6Q3FELFlBQVksSUFBSSxDQUFDbEYsU0FBUztZQUMxQm1GLFlBQVksSUFBSSxDQUFDL0UsVUFBVSxDQUFDeUIsTUFBTTtRQUNwQztJQUNGO0lBRUEsTUFBTXVELFFBQVE7UUFDWixJQUFJLElBQUksQ0FBQzlFLE1BQU0sSUFBSSxJQUFJLENBQUNHLFdBQVcsRUFBRTtZQUNuQyxNQUFNLElBQUksQ0FBQ0gsTUFBTSxDQUFDOEUsS0FBSztZQUN2QixJQUFJLENBQUMzRSxXQUFXLEdBQUc7UUFDckI7SUFDRjtBQUNGO0FBRUEsU0FBUzBELGlCQUFpQkcsQ0FBZSxFQUFFQyxDQUFlO0lBQ3hELElBQUljLE1BQU07SUFDVixJQUFJQyxLQUFLO0lBQ1QsSUFBSUMsS0FBSztJQUNULElBQUssSUFBSWxDLElBQUksR0FBR0EsSUFBSWlCLEVBQUV6QyxNQUFNLElBQUl3QixJQUFJa0IsRUFBRTFDLE1BQU0sRUFBRXdCLElBQUs7UUFDakRnQyxPQUFPZixDQUFDLENBQUNqQixFQUFFLEdBQUdrQixDQUFDLENBQUNsQixFQUFFO1FBQ2xCaUMsTUFBTWhCLENBQUMsQ0FBQ2pCLEVBQUUsR0FBR2lCLENBQUMsQ0FBQ2pCLEVBQUU7UUFDakJrQyxNQUFNaEIsQ0FBQyxDQUFDbEIsRUFBRSxHQUFHa0IsQ0FBQyxDQUFDbEIsRUFBRTtJQUNuQjtJQUNBLElBQUlpQyxPQUFPLEtBQUtDLE9BQU8sR0FBRyxPQUFPO0lBQ2pDLE9BQU9GLE1BQU9wQyxDQUFBQSxLQUFLdUMsSUFBSSxDQUFDRixNQUFNckMsS0FBS3VDLElBQUksQ0FBQ0QsR0FBRTtBQUM1QyIsInNvdXJjZXMiOlsid2VicGFjazovL2RvY3MtY2hhdC1uZXh0Ly4vbGliL3ZlY3RvclN0b3JlLnRzPzQzMzgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGlwZWxpbmUgfSBmcm9tIFwiQHhlbm92YS90cmFuc2Zvcm1lcnNcIjtcclxuaW1wb3J0IHR5cGUgeyBDaHVuayB9IGZyb20gXCIuL3RleHRDaHVua2VyXCI7XHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50LCBEYiwgQ29sbGVjdGlvbiB9IGZyb20gXCJtb25nb2RiXCI7XHJcbmltcG9ydCB7IHNldHRpbmdzIH0gZnJvbSBcIi4vc2V0dGluZ3NcIjtcclxuXHJcbnR5cGUgRW1iZWRkaW5nID0gRmxvYXQzMkFycmF5O1xyXG5cclxuaW50ZXJmYWNlIENodW5rRG9jdW1lbnQge1xyXG4gIGlkOiBudW1iZXI7XHJcbiAgdGV4dDogc3RyaW5nO1xyXG4gIGVtYmVkZGluZzogbnVtYmVyW107XHJcbiAgY3JlYXRlZEF0OiBEYXRlO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVmVjdG9yU3RvcmUge1xyXG4gIHByaXZhdGUgY2h1bmtzOiBDaHVua1tdID0gW107XHJcbiAgcHJpdmF0ZSBlbWJlZGRpbmdzOiBFbWJlZGRpbmdbXSA9IFtdO1xyXG4gIHByaXZhdGUgZW1iZWRkZXJQcm9taXNlOiBQcm9taXNlPGFueT4gfCBudWxsID0gbnVsbDtcclxuICBwcml2YXRlIG1vZGVsTmFtZTogc3RyaW5nO1xyXG4gIHByaXZhdGUgY2xpZW50OiBNb25nb0NsaWVudCB8IG51bGwgPSBudWxsO1xyXG4gIHByaXZhdGUgZGI6IERiIHwgbnVsbCA9IG51bGw7XHJcbiAgcHJpdmF0ZSBjb2xsZWN0aW9uOiBDb2xsZWN0aW9uPENodW5rRG9jdW1lbnQ+IHwgbnVsbCA9IG51bGw7XHJcbiAgcHJpdmF0ZSB1c2VNb25nbzogYm9vbGVhbjtcclxuICBwcml2YXRlIGlzQ29ubmVjdGVkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKG1vZGVsTmFtZTogc3RyaW5nLCBtb25nb1VyaT86IHN0cmluZywgZGJOYW1lPzogc3RyaW5nKSB7XHJcbiAgICB0aGlzLm1vZGVsTmFtZSA9IG1vZGVsTmFtZTtcclxuICAgIHRoaXMudXNlTW9uZ28gPSBCb29sZWFuKG1vbmdvVXJpKTtcclxuICAgIFxyXG4gICAgaWYgKG1vbmdvVXJpKSB7XHJcbiAgICAgIHRoaXMuY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KG1vbmdvVXJpKTtcclxuICAgICAgdGhpcy5pbml0TW9uZ28oZGJOYW1lIHx8IFwiZG9jcy1jaGF0XCIpLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGluaXRpYWxpemUgTW9uZ29EQjpcIiwgZXJyKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGluaXRNb25nbyhkYk5hbWU6IHN0cmluZykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCF0aGlzLmNsaWVudCkge1xyXG4gICAgICAgIGNvbnNvbGUud2FybihcIk1vbmdvREIgY2xpZW50IG5vdCBpbml0aWFsaXplZFwiKTtcclxuICAgICAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5jb25uZWN0KCk7XHJcbiAgICAgIHRoaXMuZGIgPSB0aGlzLmNsaWVudC5kYihkYk5hbWUpO1xyXG4gICAgICB0aGlzLmNvbGxlY3Rpb24gPSB0aGlzLmRiLmNvbGxlY3Rpb248Q2h1bmtEb2N1bWVudD4oXCJjaHVua3NcIik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDcmVhdGUgaW5kZXggb24gaWQgZm9yIGZhc3RlciBsb29rdXBzXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmNyZWF0ZUluZGV4KHsgaWQ6IDEgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGlkeEVycikge1xyXG4gICAgICAgIC8vIEluZGV4IG1pZ2h0IGFscmVhZHkgZXhpc3QsIHRoYXQncyBva2F5XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJJbmRleCBjcmVhdGlvbiBub3RlOlwiLCBpZHhFcnIpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLmlzQ29ubmVjdGVkID0gdHJ1ZTtcclxuICAgICAgY29uc29sZS5sb2coYENvbm5lY3RlZCB0byBNb25nb0RCIGRhdGFiYXNlOiAke2RiTmFtZX1gKTtcclxuICAgICAgYXdhaXQgdGhpcy5sb2FkRnJvbU1vbmdvKCk7XHJcbiAgICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiTW9uZ29EQiBjb25uZWN0aW9uIGVycm9yOlwiLCBlcnIubWVzc2FnZSB8fCBlcnIpO1xyXG4gICAgICBjb25zb2xlLndhcm4oXCJGYWxsaW5nIGJhY2sgdG8gaW4tbWVtb3J5IHN0b3JhZ2UuIERhdGEgd2lsbCBub3QgcGVyc2lzdC5cIik7XHJcbiAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgLy8gQ29udGludWUgd2l0aCBpbi1tZW1vcnkgbW9kZSAtIHRoZSBhcHAgd2lsbCBzdGlsbCB3b3JrXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGxvYWRGcm9tTW9uZ28oKSB7XHJcbiAgICBpZiAoIXRoaXMuY29sbGVjdGlvbiB8fCAhdGhpcy5pc0Nvbm5lY3RlZCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcIlNraXBwaW5nIE1vbmdvREIgbG9hZCAtIG5vdCBjb25uZWN0ZWRcIik7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZG9jdW1lbnRzID0gYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmZpbmQoe30pLnNvcnQoeyBpZDogMSB9KS50b0FycmF5KCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBPbmx5IGxvYWQgaWYgd2UgZG9uJ3QgYWxyZWFkeSBoYXZlIGNodW5rcyBpbiBtZW1vcnkgKHRvIGF2b2lkIG92ZXJ3cml0aW5nKVxyXG4gICAgICBpZiAodGhpcy5jaHVua3MubGVuZ3RoID09PSAwICYmIGRvY3VtZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5jaHVua3MgPSBkb2N1bWVudHMubWFwKChkb2MpID0+ICh7IFxyXG4gICAgICAgICAgaWQ6IGRvYy5pZCwgXHJcbiAgICAgICAgICB0ZXh0OiBkb2MudGV4dCBcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgdGhpcy5lbWJlZGRpbmdzID0gZG9jdW1lbnRzLm1hcCgoZG9jKSA9PiBcclxuICAgICAgICAgIG5ldyBGbG9hdDMyQXJyYXkoZG9jLmVtYmVkZGluZylcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBMb2FkZWQgJHt0aGlzLmNodW5rcy5sZW5ndGh9IGNodW5rcyBmcm9tIE1vbmdvREJgKTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmNodW5rcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYFNraXBwaW5nIE1vbmdvREIgbG9hZCAtIGFscmVhZHkgaGF2ZSAke3RoaXMuY2h1bmtzLmxlbmd0aH0gY2h1bmtzIGluIG1lbW9yeWApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiTm8gY2h1bmtzIGluIE1vbmdvREIgdG8gbG9hZFwiKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBmcm9tIE1vbmdvREI6XCIsIGVycik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGdldEVtYmVkZGVyKCkge1xyXG4gICAgaWYgKCF0aGlzLmVtYmVkZGVyUHJvbWlzZSkge1xyXG4gICAgICBjb25zdCBtb2RlbCA9IHRoaXMubW9kZWxOYW1lLmluY2x1ZGVzKCcvJykgPyB0aGlzLm1vZGVsTmFtZSA6IGBYZW5vdmEvJHt0aGlzLm1vZGVsTmFtZX1gO1xyXG4gICAgICB0aGlzLmVtYmVkZGVyUHJvbWlzZSA9IHBpcGVsaW5lKFwiZmVhdHVyZS1leHRyYWN0aW9uXCIsIG1vZGVsKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmVtYmVkZGVyUHJvbWlzZTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGFkZERvY3VtZW50cyhjaHVua3M6IENodW5rW10pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICghY2h1bmtzLmxlbmd0aCkge1xyXG4gICAgICBjb25zb2xlLndhcm4oXCJhZGREb2N1bWVudHMgY2FsbGVkIHdpdGggZW1wdHkgY2h1bmtzIGFycmF5XCIpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKGBBZGRpbmcgJHtjaHVua3MubGVuZ3RofSBjaHVua3MgdG8gdmVjdG9yIHN0b3JlLiBDdXJyZW50IGNodW5rczogJHt0aGlzLmNodW5rcy5sZW5ndGh9YCk7XHJcbiAgICBcclxuICAgIGNvbnN0IGVtYmVkZGVyID0gYXdhaXQgdGhpcy5nZXRFbWJlZGRlcigpO1xyXG4gICAgY29uc3QgdGV4dHMgPSBjaHVua3MubWFwKGMgPT4gYy50ZXh0KTtcclxuICAgIGNvbnN0IG91dHB1dHMgPSBhd2FpdCBlbWJlZGRlcih0ZXh0cywgeyBwb29saW5nOiBcIm1lYW5cIiwgbm9ybWFsaXplOiB0cnVlIH0pO1xyXG4gICAgY29uc3QgdmVjdG9yczogRW1iZWRkaW5nW10gPSBvdXRwdXRzLnRvbGlzdCgpLm1hcCgocm93OiBudW1iZXJbXSkgPT4gbmV3IEZsb2F0MzJBcnJheShyb3cpKTtcclxuICAgIFxyXG4gICAgLy8gRGV0ZXJtaW5lIHN0YXJ0aW5nIElEXHJcbiAgICBjb25zdCBzdGFydElkID0gdGhpcy5jaHVua3MubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLnRoaXMuY2h1bmtzLm1hcChjID0+IGMuaWQpKSArIDEgOiAwO1xyXG4gICAgY29uc3QgY2h1bmtzV2l0aElkcyA9IGNodW5rcy5tYXAoKGNodW5rLCBpKSA9PiAoeyAuLi5jaHVuaywgaWQ6IHN0YXJ0SWQgKyBpIH0pKTtcclxuICAgIFxyXG4gICAgLy8gQWRkIHRvIG1lbW9yeSBGSVJTVCAodGhpcyBlbnN1cmVzIGluLW1lbW9yeSBtb2RlIHdvcmtzIGV2ZW4gaWYgTW9uZ29EQiBmYWlscylcclxuICAgIHRoaXMuY2h1bmtzLnB1c2goLi4uY2h1bmtzV2l0aElkcyk7XHJcbiAgICB0aGlzLmVtYmVkZGluZ3MucHVzaCguLi52ZWN0b3JzKTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coYEFkZGVkICR7Y2h1bmtzV2l0aElkcy5sZW5ndGh9IGNodW5rcyB0byBtZW1vcnkuIFRvdGFsIGNodW5rcyBub3c6ICR7dGhpcy5jaHVua3MubGVuZ3RofWApO1xyXG4gICAgXHJcbiAgICAvLyBTYXZlIHRvIE1vbmdvREIgaWYgY29ubmVjdGVkICh0aGlzIGlzIG9wdGlvbmFsIC0gbWVtb3J5IHN0b3JhZ2UgaXMgcHJpbWFyeSlcclxuICAgIGlmICh0aGlzLmNvbGxlY3Rpb24gJiYgdGhpcy5pc0Nvbm5lY3RlZCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGRvY3VtZW50czogQ2h1bmtEb2N1bWVudFtdID0gY2h1bmtzV2l0aElkcy5tYXAoKGNodW5rLCBpKSA9PiAoe1xyXG4gICAgICAgICAgaWQ6IGNodW5rLmlkLFxyXG4gICAgICAgICAgdGV4dDogY2h1bmsudGV4dCxcclxuICAgICAgICAgIGVtYmVkZGluZzogQXJyYXkuZnJvbSh2ZWN0b3JzW2ldKSxcclxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmluc2VydE1hbnkoZG9jdW1lbnRzKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhgU2F2ZWQgJHtkb2N1bWVudHMubGVuZ3RofSBjaHVua3MgdG8gTW9uZ29EQmApO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNhdmUgdG8gTW9uZ29EQiAoY29udGludWluZyB3aXRoIGluLW1lbW9yeSBzdG9yYWdlKTpcIiwgZXJyKTtcclxuICAgICAgICAvLyBDb250aW51ZSBldmVuIGlmIE1vbmdvREIgc2F2ZSBmYWlscyAtIG1lbW9yeSBzdG9yYWdlIGlzIGFscmVhZHkgZG9uZVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmxvZyhgTW9uZ29EQiBub3QgY29ubmVjdGVkIChpc0Nvbm5lY3RlZDogJHt0aGlzLmlzQ29ubmVjdGVkfSksIHVzaW5nIGluLW1lbW9yeSBzdG9yYWdlIG9ubHlgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHNlYXJjaChxdWVyeTogc3RyaW5nLCB0b3BLOiBudW1iZXIgPSA1KTogUHJvbWlzZTx7IGNodW5rOiBDaHVuazsgc2NvcmU6IG51bWJlciB9W10+IHtcclxuICAgIGlmICh0aGlzLmNodW5rcy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcclxuICAgIFxyXG4gICAgY29uc3QgZW1iZWRkZXIgPSBhd2FpdCB0aGlzLmdldEVtYmVkZGVyKCk7XHJcbiAgICBjb25zdCBvdXQgPSBhd2FpdCBlbWJlZGRlcihxdWVyeSwgeyBwb29saW5nOiBcIm1lYW5cIiwgbm9ybWFsaXplOiB0cnVlIH0pO1xyXG4gICAgY29uc3QgcSA9IG5ldyBGbG9hdDMyQXJyYXkob3V0LnRvbGlzdCgpWzBdKTtcclxuICAgIFxyXG4gICAgLy8gQ2FsY3VsYXRlIGNvc2luZSBzaW1pbGFyaXR5IGZvciBhbGwgZW1iZWRkaW5nc1xyXG4gICAgY29uc3Qgc2NvcmVzID0gdGhpcy5lbWJlZGRpbmdzLm1hcCgodikgPT4gY29zaW5lU2ltaWxhcml0eShxLCB2KSk7XHJcbiAgICBcclxuICAgIC8vIFNvcnQgYnkgc2NvcmUgYW5kIGdldCB0b3AgS1xyXG4gICAgY29uc3QgaW5kaWNlcyA9IHNjb3Jlc1xyXG4gICAgICAubWFwKChzLCBpKSA9PiBbcywgaV0gYXMgY29uc3QpXHJcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiWzBdIC0gYVswXSlcclxuICAgICAgLnNsaWNlKDAsIE1hdGgubWluKHRvcEssIHNjb3Jlcy5sZW5ndGgpKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIGluZGljZXMubWFwKChbc2NvcmUsIGldKSA9PiAoeyBcclxuICAgICAgY2h1bms6IHRoaXMuY2h1bmtzW2ldLCBcclxuICAgICAgc2NvcmUgXHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBjbGVhcigpIHtcclxuICAgIHRoaXMuY2h1bmtzID0gW107XHJcbiAgICB0aGlzLmVtYmVkZGluZ3MgPSBbXTtcclxuICAgIFxyXG4gICAgaWYgKHRoaXMuY29sbGVjdGlvbiAmJiB0aGlzLmlzQ29ubmVjdGVkKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmRlbGV0ZU1hbnkoe30pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBDbGVhcmVkICR7cmVzdWx0LmRlbGV0ZWRDb3VudH0gY2h1bmtzIGZyb20gTW9uZ29EQmApO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNsZWFyIE1vbmdvREI6XCIsIGVycik7XHJcbiAgICAgICAgLy8gQ29udGludWUgZXZlbiBpZiBNb25nb0RCIGNsZWFyIGZhaWxzIC0gbWVtb3J5IGlzIGFscmVhZHkgY2xlYXJlZFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRTdGF0cygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRvdGFsX2NodW5rczogdGhpcy5jaHVua3MubGVuZ3RoLFxyXG4gICAgICBkaW1lbnNpb246IHRoaXMuZW1iZWRkaW5nc1swXT8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgIG1vZGVsX25hbWU6IHRoaXMubW9kZWxOYW1lLFxyXG4gICAgICBpbmRleF9zaXplOiB0aGlzLmVtYmVkZGluZ3MubGVuZ3RoLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGNsb3NlKCkge1xyXG4gICAgaWYgKHRoaXMuY2xpZW50ICYmIHRoaXMuaXNDb25uZWN0ZWQpIHtcclxuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuY2xvc2UoKTtcclxuICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY29zaW5lU2ltaWxhcml0eShhOiBGbG9hdDMyQXJyYXksIGI6IEZsb2F0MzJBcnJheSk6IG51bWJlciB7XHJcbiAgbGV0IGRvdCA9IDA7XHJcbiAgbGV0IG5hID0gMDtcclxuICBsZXQgbmIgPSAwO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYS5sZW5ndGggJiYgaSA8IGIubGVuZ3RoOyBpKyspIHtcclxuICAgIGRvdCArPSBhW2ldICogYltpXTtcclxuICAgIG5hICs9IGFbaV0gKiBhW2ldO1xyXG4gICAgbmIgKz0gYltpXSAqIGJbaV07XHJcbiAgfVxyXG4gIGlmIChuYSA9PT0gMCB8fCBuYiA9PT0gMCkgcmV0dXJuIDA7XHJcbiAgcmV0dXJuIGRvdCAvIChNYXRoLnNxcnQobmEpICogTWF0aC5zcXJ0KG5iKSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbInBpcGVsaW5lIiwiTW9uZ29DbGllbnQiLCJWZWN0b3JTdG9yZSIsImNvbnN0cnVjdG9yIiwibW9kZWxOYW1lIiwibW9uZ29VcmkiLCJkYk5hbWUiLCJjaHVua3MiLCJlbWJlZGRpbmdzIiwiZW1iZWRkZXJQcm9taXNlIiwiY2xpZW50IiwiZGIiLCJjb2xsZWN0aW9uIiwiaXNDb25uZWN0ZWQiLCJ1c2VNb25nbyIsIkJvb2xlYW4iLCJpbml0TW9uZ28iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsIndhcm4iLCJjb25uZWN0IiwiY3JlYXRlSW5kZXgiLCJpZCIsImlkeEVyciIsImxvZyIsImxvYWRGcm9tTW9uZ28iLCJtZXNzYWdlIiwiZG9jdW1lbnRzIiwiZmluZCIsInNvcnQiLCJ0b0FycmF5IiwibGVuZ3RoIiwibWFwIiwiZG9jIiwidGV4dCIsIkZsb2F0MzJBcnJheSIsImVtYmVkZGluZyIsImdldEVtYmVkZGVyIiwibW9kZWwiLCJpbmNsdWRlcyIsImFkZERvY3VtZW50cyIsImVtYmVkZGVyIiwidGV4dHMiLCJjIiwib3V0cHV0cyIsInBvb2xpbmciLCJub3JtYWxpemUiLCJ2ZWN0b3JzIiwidG9saXN0Iiwicm93Iiwic3RhcnRJZCIsIk1hdGgiLCJtYXgiLCJjaHVua3NXaXRoSWRzIiwiY2h1bmsiLCJpIiwicHVzaCIsIkFycmF5IiwiZnJvbSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJpbnNlcnRNYW55Iiwic2VhcmNoIiwicXVlcnkiLCJ0b3BLIiwib3V0IiwicSIsInNjb3JlcyIsInYiLCJjb3NpbmVTaW1pbGFyaXR5IiwiaW5kaWNlcyIsInMiLCJhIiwiYiIsInNsaWNlIiwibWluIiwic2NvcmUiLCJjbGVhciIsInJlc3VsdCIsImRlbGV0ZU1hbnkiLCJkZWxldGVkQ291bnQiLCJnZXRTdGF0cyIsInRvdGFsX2NodW5rcyIsImRpbWVuc2lvbiIsIm1vZGVsX25hbWUiLCJpbmRleF9zaXplIiwiY2xvc2UiLCJkb3QiLCJuYSIsIm5iIiwic3FydCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/vectorStore.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@xenova","vendor-chunks/onnxruntime-web","vendor-chunks/@huggingface","vendor-chunks/onnxruntime-common","vendor-chunks/@google","vendor-chunks/remove-markdown"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fupload%2Froute&page=%2Fapi%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fupload%2Froute.ts&appDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();