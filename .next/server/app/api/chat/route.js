"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "ffmpeg-static":
/*!********************************!*\
  !*** external "ffmpeg-static" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("ffmpeg-static");

/***/ }),

/***/ "jszip":
/*!************************!*\
  !*** external "jszip" ***!
  \************************/
/***/ ((module) => {

module.exports = require("jszip");

/***/ }),

/***/ "mammoth":
/*!**************************!*\
  !*** external "mammoth" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mammoth");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "onnxruntime-node":
/*!***********************************!*\
  !*** external "onnxruntime-node" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("onnxruntime-node");

/***/ }),

/***/ "pdf-parse":
/*!****************************!*\
  !*** external "pdf-parse" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("pdf-parse");

/***/ }),

/***/ "sharp":
/*!************************!*\
  !*** external "sharp" ***!
  \************************/
/***/ ((module) => {

module.exports = require("sharp");

/***/ }),

/***/ "tesseract.js":
/*!*******************************!*\
  !*** external "tesseract.js" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("tesseract.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "node:child_process":
/*!*************************************!*\
  !*** external "node:child_process" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("node:child_process");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:fs/promises":
/*!***********************************!*\
  !*** external "node:fs/promises" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:fs/promises");

/***/ }),

/***/ "node:os":
/*!**************************!*\
  !*** external "node:os" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:os");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:util");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "perf_hooks":
/*!*****************************!*\
  !*** external "perf_hooks" ***!
  \*****************************/
/***/ ((module) => {

module.exports = require("perf_hooks");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_komar_Desktop_docs_chat_master_docs_chat_master_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/chat/route.ts */ \"(rsc)/./app/api/chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\komar\\\\Desktop\\\\docs-chat-master\\\\docs-chat-master\\\\app\\\\api\\\\chat\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_komar_Desktop_docs_chat_master_docs_chat_master_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNrb21hciU1Q0Rlc2t0b3AlNUNkb2NzLWNoYXQtbWFzdGVyJTVDZG9jcy1jaGF0LW1hc3RlciU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDa29tYXIlNUNEZXNrdG9wJTVDZG9jcy1jaGF0LW1hc3RlciU1Q2RvY3MtY2hhdC1tYXN0ZXImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3VDO0FBQ3BIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZG9jcy1jaGF0LW5leHQvPzViNzAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxca29tYXJcXFxcRGVza3RvcFxcXFxkb2NzLWNoYXQtbWFzdGVyXFxcXGRvY3MtY2hhdC1tYXN0ZXJcXFxcYXBwXFxcXGFwaVxcXFxjaGF0XFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jaGF0L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvY2hhdFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvY2hhdC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXGtvbWFyXFxcXERlc2t0b3BcXFxcZG9jcy1jaGF0LW1hc3RlclxcXFxkb2NzLWNoYXQtbWFzdGVyXFxcXGFwcFxcXFxhcGlcXFxcY2hhdFxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvY2hhdC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/_state.ts":
/*!***************************!*\
  !*** ./app/api/_state.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chunker: () => (/* binding */ chunker),\n/* harmony export */   mediaFiles: () => (/* binding */ mediaFiles),\n/* harmony export */   sessions: () => (/* binding */ sessions),\n/* harmony export */   store: () => (/* binding */ store)\n/* harmony export */ });\n/* harmony import */ var _lib_settings__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/settings */ \"(rsc)/./lib/settings.ts\");\n/* harmony import */ var _lib_textChunker__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/textChunker */ \"(rsc)/./lib/textChunker.ts\");\n/* harmony import */ var _lib_vectorStore__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/vectorStore */ \"(rsc)/./lib/vectorStore.ts\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\nconst chunker = new _lib_textChunker__WEBPACK_IMPORTED_MODULE_1__.TextChunker(_lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.MAX_CHUNK_SIZE, _lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.CHUNK_OVERLAP);\n// Initialize VectorStore with MongoDB (singleton pattern for Next.js)\nif (!global.__vectorStore) {\n    console.log(\"Initializing new VectorStore instance...\");\n    global.__vectorStore = new _lib_vectorStore__WEBPACK_IMPORTED_MODULE_2__.VectorStore(_lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.EMBEDDING_MODEL, _lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.MONGODB_URI, _lib_settings__WEBPACK_IMPORTED_MODULE_0__.settings.MONGODB_DB_NAME);\n}\nif (!global.__sessions) {\n    global.__sessions = new Map();\n}\nif (!global.__mediaFiles) {\n    global.__mediaFiles = new Map();\n}\nconst store = global.__vectorStore;\nconst sessions = global.__sessions;\nconst mediaFiles = global.__mediaFiles;\n// Create uploads directory if it doesn't exist\nconst uploadsDir = node_path__WEBPACK_IMPORTED_MODULE_3___default().join(process.cwd(), \"uploads\");\ntry {\n    if (!node_fs__WEBPACK_IMPORTED_MODULE_4___default().existsSync(uploadsDir)) {\n        node_fs__WEBPACK_IMPORTED_MODULE_4___default().mkdirSync(uploadsDir, {\n            recursive: true\n        });\n    }\n} catch  {}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL19zdGF0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUEwQztBQUNNO0FBQ0E7QUFDbkI7QUFDSjtBQVlsQixNQUFNSyxVQUFVLElBQUlKLHlEQUFXQSxDQUFDRCxtREFBUUEsQ0FBQ00sY0FBYyxFQUFFTixtREFBUUEsQ0FBQ08sYUFBYSxFQUFFO0FBU3hGLHNFQUFzRTtBQUN0RSxJQUFJLENBQUNDLE9BQU9DLGFBQWEsRUFBRTtJQUN6QkMsUUFBUUMsR0FBRyxDQUFDO0lBQ1pILE9BQU9DLGFBQWEsR0FBRyxJQUFJUCx5REFBV0EsQ0FDcENGLG1EQUFRQSxDQUFDWSxlQUFlLEVBQ3hCWixtREFBUUEsQ0FBQ2EsV0FBVyxFQUNwQmIsbURBQVFBLENBQUNjLGVBQWU7QUFFNUI7QUFFQSxJQUFJLENBQUNOLE9BQU9PLFVBQVUsRUFBRTtJQUN0QlAsT0FBT08sVUFBVSxHQUFHLElBQUlDO0FBQzFCO0FBRUEsSUFBSSxDQUFDUixPQUFPUyxZQUFZLEVBQUU7SUFDeEJULE9BQU9TLFlBQVksR0FBRyxJQUFJRDtBQUM1QjtBQUVPLE1BQU1FLFFBQVFWLE9BQU9DLGFBQWEsQ0FBQztBQUNuQyxNQUFNVSxXQUFXWCxPQUFPTyxVQUFVLENBQUM7QUFDbkMsTUFBTUssYUFBYVosT0FBT1MsWUFBWSxDQUFDO0FBRTlDLCtDQUErQztBQUMvQyxNQUFNSSxhQUFhbEIscURBQVMsQ0FBQ29CLFFBQVFDLEdBQUcsSUFBSTtBQUM1QyxJQUFJO0lBQ0YsSUFBSSxDQUFDcEIseURBQWEsQ0FBQ2lCLGFBQWE7UUFDOUJqQix3REFBWSxDQUFDaUIsWUFBWTtZQUFFTSxXQUFXO1FBQUs7SUFDN0M7QUFDRixFQUFFLE9BQU0sQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL2RvY3MtY2hhdC1uZXh0Ly4vYXBwL2FwaS9fc3RhdGUudHM/NGFjNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzZXR0aW5ncyB9IGZyb20gXCJAL2xpYi9zZXR0aW5nc1wiO1xyXG5pbXBvcnQgeyBUZXh0Q2h1bmtlciB9IGZyb20gXCJAL2xpYi90ZXh0Q2h1bmtlclwiO1xyXG5pbXBvcnQgeyBWZWN0b3JTdG9yZSB9IGZyb20gXCJAL2xpYi92ZWN0b3JTdG9yZVwiO1xyXG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XHJcbmltcG9ydCBmcyBmcm9tIFwibm9kZTpmc1wiO1xyXG5cclxuZXhwb3J0IHR5cGUgQ2hhdE1lc3NhZ2UgPSB7IHJvbGU6IFwidXNlclwiIHwgXCJhc3Npc3RhbnRcIjsgY29udGVudDogc3RyaW5nIH07XHJcblxyXG5leHBvcnQgdHlwZSBNZWRpYUZpbGUgPSB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBmaWxlUGF0aDogc3RyaW5nO1xyXG4gIG1pbWVUeXBlOiBzdHJpbmc7XHJcbiAgb3JpZ2luYWxOYW1lOiBzdHJpbmc7XHJcbiAgdHlwZTogXCJpbWFnZVwiIHwgXCJ2aWRlb1wiIHwgXCJhdWRpb1wiO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNodW5rZXIgPSBuZXcgVGV4dENodW5rZXIoc2V0dGluZ3MuTUFYX0NIVU5LX1NJWkUsIHNldHRpbmdzLkNIVU5LX09WRVJMQVApO1xyXG5cclxuLy8gVXNlIGdsb2JhbCB0byBlbnN1cmUgc2luZ2xldG9uIGFjcm9zcyBOZXh0LmpzIGhvdCByZWxvYWRzXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICB2YXIgX192ZWN0b3JTdG9yZTogVmVjdG9yU3RvcmUgfCB1bmRlZmluZWQ7XHJcbiAgdmFyIF9fc2Vzc2lvbnM6IE1hcDxzdHJpbmcsIENoYXRNZXNzYWdlW10+IHwgdW5kZWZpbmVkO1xyXG4gIHZhciBfX21lZGlhRmlsZXM6IE1hcDxzdHJpbmcsIE1lZGlhRmlsZT4gfCB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbi8vIEluaXRpYWxpemUgVmVjdG9yU3RvcmUgd2l0aCBNb25nb0RCIChzaW5nbGV0b24gcGF0dGVybiBmb3IgTmV4dC5qcylcclxuaWYgKCFnbG9iYWwuX192ZWN0b3JTdG9yZSkge1xyXG4gIGNvbnNvbGUubG9nKFwiSW5pdGlhbGl6aW5nIG5ldyBWZWN0b3JTdG9yZSBpbnN0YW5jZS4uLlwiKTtcclxuICBnbG9iYWwuX192ZWN0b3JTdG9yZSA9IG5ldyBWZWN0b3JTdG9yZShcclxuICAgIHNldHRpbmdzLkVNQkVERElOR19NT0RFTCxcclxuICAgIHNldHRpbmdzLk1PTkdPREJfVVJJLFxyXG4gICAgc2V0dGluZ3MuTU9OR09EQl9EQl9OQU1FXHJcbiAgKTtcclxufVxyXG5cclxuaWYgKCFnbG9iYWwuX19zZXNzaW9ucykge1xyXG4gIGdsb2JhbC5fX3Nlc3Npb25zID0gbmV3IE1hcDxzdHJpbmcsIENoYXRNZXNzYWdlW10+KCk7XHJcbn1cclxuXHJcbmlmICghZ2xvYmFsLl9fbWVkaWFGaWxlcykge1xyXG4gIGdsb2JhbC5fX21lZGlhRmlsZXMgPSBuZXcgTWFwPHN0cmluZywgTWVkaWFGaWxlPigpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3Qgc3RvcmUgPSBnbG9iYWwuX192ZWN0b3JTdG9yZTtcclxuZXhwb3J0IGNvbnN0IHNlc3Npb25zID0gZ2xvYmFsLl9fc2Vzc2lvbnM7XHJcbmV4cG9ydCBjb25zdCBtZWRpYUZpbGVzID0gZ2xvYmFsLl9fbWVkaWFGaWxlcztcclxuXHJcbi8vIENyZWF0ZSB1cGxvYWRzIGRpcmVjdG9yeSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbmNvbnN0IHVwbG9hZHNEaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgXCJ1cGxvYWRzXCIpO1xyXG50cnkge1xyXG4gIGlmICghZnMuZXhpc3RzU3luYyh1cGxvYWRzRGlyKSkge1xyXG4gICAgZnMubWtkaXJTeW5jKHVwbG9hZHNEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG4gIH1cclxufSBjYXRjaCB7fVxyXG5cclxuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiVGV4dENodW5rZXIiLCJWZWN0b3JTdG9yZSIsInBhdGgiLCJmcyIsImNodW5rZXIiLCJNQVhfQ0hVTktfU0laRSIsIkNIVU5LX09WRVJMQVAiLCJnbG9iYWwiLCJfX3ZlY3RvclN0b3JlIiwiY29uc29sZSIsImxvZyIsIkVNQkVERElOR19NT0RFTCIsIk1PTkdPREJfVVJJIiwiTU9OR09EQl9EQl9OQU1FIiwiX19zZXNzaW9ucyIsIk1hcCIsIl9fbWVkaWFGaWxlcyIsInN0b3JlIiwic2Vzc2lvbnMiLCJtZWRpYUZpbGVzIiwidXBsb2Fkc0RpciIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/_state.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/chat/route.ts":
/*!*******************************!*\
  !*** ./app/api/chat/route.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../_state */ \"(rsc)/./app/api/_state.ts\");\n/* harmony import */ var _lib_gemini__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/gemini */ \"(rsc)/./lib/gemini.ts\");\n/* harmony import */ var _lib_documentProcessor__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/documentProcessor */ \"(rsc)/./lib/documentProcessor.ts\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! node:fs/promises */ \"node:fs/promises\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(node_fs_promises__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\nconst runtime = \"nodejs\";\nasync function POST(req) {\n    const body = await req.json().catch(()=>({}));\n    const { session_id, query, top_k = 5 } = body;\n    if (!query || !query.trim()) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        detail: \"Query cannot be empty\"\n    }, {\n        status: 400\n    });\n    if (!_state__WEBPACK_IMPORTED_MODULE_1__.sessions.has(session_id)) {\n        _state__WEBPACK_IMPORTED_MODULE_1__.sessions.set(session_id, []);\n    }\n    const history = _state__WEBPACK_IMPORTED_MODULE_1__.sessions.get(session_id);\n    history.push({\n        role: \"user\",\n        content: query\n    });\n    try {\n        // Collect all media files (images/videos) for visual analysis\n        const mediaToInclude = [];\n        for (const [id, media] of _state__WEBPACK_IMPORTED_MODULE_1__.mediaFiles.entries()){\n            if (media.type === \"image\" || media.type === \"video\") {\n                mediaToInclude.push({\n                    filePath: media.filePath,\n                    mimeType: media.mimeType\n                });\n            }\n        }\n        console.log(`Chat request - Media files: ${mediaToInclude.length}, MediaFiles map size: ${_state__WEBPACK_IMPORTED_MODULE_1__.mediaFiles.size}`);\n        // Process media files (extract video frames, etc.)\n        const finalMediaFiles = [];\n        for (const media of mediaToInclude){\n            if (media.mimeType.startsWith(\"video/\")) {\n                try {\n                    const frames = await (0,_lib_documentProcessor__WEBPACK_IMPORTED_MODULE_3__.extractVideoFrames)(media.filePath, 5);\n                    for (const framePath of frames){\n                        try {\n                            await node_fs_promises__WEBPACK_IMPORTED_MODULE_4___default().access(framePath); // Check if file exists\n                            finalMediaFiles.push({\n                                filePath: framePath,\n                                mimeType: \"image/jpeg\"\n                            });\n                        } catch (e) {\n                            console.warn(\"Failed to access video frame:\", e);\n                        }\n                    }\n                } catch (e) {\n                    console.warn(\"Failed to extract video frames, using video file directly:\", e);\n                    finalMediaFiles.push(media);\n                }\n            } else {\n                finalMediaFiles.push(media);\n            }\n        }\n        // Get text context from vector store if available\n        const stats = _state__WEBPACK_IMPORTED_MODULE_1__.store.getStats();\n        const hasTextContext = stats.index_size > 0;\n        let textResults = [];\n        console.log(`Vector store stats - Total chunks: ${stats.total_chunks}, Index size: ${stats.index_size}, Has text context: ${hasTextContext}`);\n        if (hasTextContext) {\n            textResults = await _state__WEBPACK_IMPORTED_MODULE_1__.store.search(query, top_k);\n            console.log(`Found ${textResults.length} relevant text chunks for query: \"${query}\"`);\n            if (textResults.length > 0) {\n                console.log(`Top result score: ${textResults[0].score}, Text preview: ${textResults[0].chunk.text.substring(0, 100)}...`);\n            } else {\n                console.warn(`No search results found, but store has ${stats.total_chunks} chunks. This might indicate a search issue.`);\n            // Even if no search results, if we have chunks, try to use them with lower threshold\n            // For now, we'll proceed with empty results but the user should see a helpful message\n            }\n        }\n        // Build prompt combining text context and media\n        let prompt = \"\";\n        const hist = history.slice(-5).map((m)=>`${m.role === \"user\" ? \"User\" : \"Assistant\"}: ${m.content}`).join(\"\\n\");\n        if (textResults.length > 0 && finalMediaFiles.length > 0) {\n            // Both text and images available - combine them\n            const contexts = textResults.map((c, i)=>`[Context ${i + 1}]:\\n${c.chunk.text || \"\"}\\n`).join(\"\\n\");\n            prompt = `${hist ? `CONVERSATION HISTORY:\\n${hist}\\n\\n` : \"\"}USER QUESTION: ${query}\\n\\nDOCUMENT CONTEXT (from uploaded documents):\\n${contexts}\\n\\nIMAGES PROVIDED: ${finalMediaFiles.length} ${finalMediaFiles.length === 1 ? \"image\" : \"images\"} ${finalMediaFiles.length > 0 ? \"have been provided. Please analyze the images along with the document context to answer the question.\" : \"\"}\\n\\nPlease answer the question using both the document context and the images provided. If the images contain relevant information, include that in your answer.\\n\\nANSWER:`;\n        } else if (textResults.length > 0) {\n            // Only text context available\n            prompt = (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_2__.buildRagPrompt)(query, textResults.map((r)=>({\n                    text: r.chunk.text\n                })), history);\n        } else if (finalMediaFiles.length > 0) {\n            // Only images available\n            prompt = `${hist ? `CONVERSATION HISTORY:\\n${hist}\\n\\n` : \"\"}USER QUESTION: ${query}\\n\\nIMAGES PROVIDED: ${finalMediaFiles.length} ${finalMediaFiles.length === 1 ? \"image has\" : \"images have\"} been provided.\\n\\nPlease analyze the ${finalMediaFiles.length === 1 ? \"image\" : \"images\"} carefully and answer the question based on what you see. Describe the content, objects, text, layout, and any relevant details in the ${finalMediaFiles.length === 1 ? \"image\" : \"images\"}.\\n\\nANSWER:`;\n        } else {\n            // No context at all - neither text results nor media files\n            console.error(`No context available - hasTextContext: ${hasTextContext}, textResults: ${textResults.length}, mediaFiles: ${finalMediaFiles.length}, stats:`, stats);\n            if (!hasTextContext && finalMediaFiles.length === 0) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    detail: \"No documents or images uploaded. Please upload a document or image first. If you just uploaded a file, please wait a moment for processing to complete and try again.\"\n                }, {\n                    status: 400\n                });\n            }\n            // We have text context but no search results - provide a helpful response\n            if (hasTextContext && textResults.length === 0) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    session_id,\n                    query,\n                    response: \"I couldn't find information directly matching your question in the uploaded documents. The documents may not contain information about this specific topic, or the question might need to be rephrased. Please try:\\n1. Rephrasing your question using different keywords\\n2. Asking a more general question about the document content\\n3. Uploading additional relevant documents\",\n                    relevant_chunks: [],\n                    chunk_count: 0\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                session_id,\n                query,\n                response: \"I couldn't find relevant information in the documents to answer your question. Please try rephrasing your question or upload more relevant documents.\",\n                relevant_chunks: [],\n                chunk_count: 0\n            });\n        }\n        // Generate response with Gemini (including images if available)\n        const answer = await (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_2__.generateWithGemini)(prompt, finalMediaFiles.length > 0 ? finalMediaFiles : undefined);\n        history.push({\n            role: \"assistant\",\n            content: answer\n        });\n        const chunk_info = textResults.map((r)=>({\n                id: r.chunk.id,\n                text: r.chunk.text.length > 200 ? r.chunk.text.slice(0, 200) + \"...\" : r.chunk.text,\n                score: r.score\n            }));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            session_id,\n            query,\n            response: answer,\n            relevant_chunks: chunk_info,\n            chunk_count: textResults.length,\n            media_analyzed: finalMediaFiles.length\n        });\n    } catch (e) {\n        console.error(\"Error in chat route:\", e);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            detail: `Error generating response: ${e.message || e}`\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UTtRQUFJO0lBQ25CO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kb2NzLWNoYXQtbmV4dC8uL2FwcC9hcGkvY2hhdC9yb3V0ZS50cz9kZTQ2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xyXG5pbXBvcnQgeyBzZXNzaW9ucywgc3RvcmUsIG1lZGlhRmlsZXMgfSBmcm9tIFwiLi4vX3N0YXRlXCI7XHJcbmltcG9ydCB7IGJ1aWxkUmFnUHJvbXB0LCBnZW5lcmF0ZVdpdGhHZW1pbmkgfSBmcm9tIFwiQC9saWIvZ2VtaW5pXCI7XHJcbmltcG9ydCB7IGV4dHJhY3RWaWRlb0ZyYW1lcyB9IGZyb20gXCJAL2xpYi9kb2N1bWVudFByb2Nlc3NvclwiO1xyXG5pbXBvcnQgZnMgZnJvbSBcIm5vZGU6ZnMvcHJvbWlzZXNcIjtcclxuXHJcbnR5cGUgQ2hhdFJlcXVlc3QgPSB7IHNlc3Npb25faWQ6IHN0cmluZzsgcXVlcnk6IHN0cmluZzsgdG9wX2s/OiBudW1iZXIgfTtcclxuXHJcbmV4cG9ydCBjb25zdCBydW50aW1lID0gXCJub2RlanNcIjtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogUmVxdWVzdCkge1xyXG4gIGNvbnN0IGJvZHkgPSAoYXdhaXQgcmVxLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKSkgYXMgQ2hhdFJlcXVlc3Q7XHJcbiAgY29uc3QgeyBzZXNzaW9uX2lkLCBxdWVyeSwgdG9wX2sgPSA1IH0gPSBib2R5O1xyXG4gIGlmICghcXVlcnkgfHwgIXF1ZXJ5LnRyaW0oKSkgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZGV0YWlsOiBcIlF1ZXJ5IGNhbm5vdCBiZSBlbXB0eVwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcblxyXG4gIGlmICghc2Vzc2lvbnMuaGFzKHNlc3Npb25faWQpKSB7XHJcbiAgICBzZXNzaW9ucy5zZXQoc2Vzc2lvbl9pZCwgW10pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgaGlzdG9yeSA9IHNlc3Npb25zLmdldChzZXNzaW9uX2lkKSE7XHJcbiAgaGlzdG9yeS5wdXNoKHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IHF1ZXJ5IH0pO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gQ29sbGVjdCBhbGwgbWVkaWEgZmlsZXMgKGltYWdlcy92aWRlb3MpIGZvciB2aXN1YWwgYW5hbHlzaXNcclxuICAgIGNvbnN0IG1lZGlhVG9JbmNsdWRlOiB7IGZpbGVQYXRoOiBzdHJpbmc7IG1pbWVUeXBlOiBzdHJpbmcgfVtdID0gW107XHJcbiAgICBmb3IgKGNvbnN0IFtpZCwgbWVkaWFdIG9mIG1lZGlhRmlsZXMuZW50cmllcygpKSB7XHJcbiAgICAgIGlmIChtZWRpYS50eXBlID09PSBcImltYWdlXCIgfHwgbWVkaWEudHlwZSA9PT0gXCJ2aWRlb1wiKSB7XHJcbiAgICAgICAgbWVkaWFUb0luY2x1ZGUucHVzaCh7IGZpbGVQYXRoOiBtZWRpYS5maWxlUGF0aCwgbWltZVR5cGU6IG1lZGlhLm1pbWVUeXBlIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKGBDaGF0IHJlcXVlc3QgLSBNZWRpYSBmaWxlczogJHttZWRpYVRvSW5jbHVkZS5sZW5ndGh9LCBNZWRpYUZpbGVzIG1hcCBzaXplOiAke21lZGlhRmlsZXMuc2l6ZX1gKTtcclxuXHJcbiAgICAvLyBQcm9jZXNzIG1lZGlhIGZpbGVzIChleHRyYWN0IHZpZGVvIGZyYW1lcywgZXRjLilcclxuICAgIGNvbnN0IGZpbmFsTWVkaWFGaWxlczogeyBmaWxlUGF0aDogc3RyaW5nOyBtaW1lVHlwZTogc3RyaW5nIH1bXSA9IFtdO1xyXG4gICAgZm9yIChjb25zdCBtZWRpYSBvZiBtZWRpYVRvSW5jbHVkZSkge1xyXG4gICAgICBpZiAobWVkaWEubWltZVR5cGUuc3RhcnRzV2l0aCgndmlkZW8vJykpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgZnJhbWVzID0gYXdhaXQgZXh0cmFjdFZpZGVvRnJhbWVzKG1lZGlhLmZpbGVQYXRoLCA1KTtcclxuICAgICAgICAgIGZvciAoY29uc3QgZnJhbWVQYXRoIG9mIGZyYW1lcykge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgIGF3YWl0IGZzLmFjY2VzcyhmcmFtZVBhdGgpOyAvLyBDaGVjayBpZiBmaWxlIGV4aXN0c1xyXG4gICAgICAgICAgICAgIGZpbmFsTWVkaWFGaWxlcy5wdXNoKHsgXHJcbiAgICAgICAgICAgICAgICBmaWxlUGF0aDogZnJhbWVQYXRoLCBcclxuICAgICAgICAgICAgICAgIG1pbWVUeXBlOiAnaW1hZ2UvanBlZycgXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gYWNjZXNzIHZpZGVvIGZyYW1lOlwiLCBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBleHRyYWN0IHZpZGVvIGZyYW1lcywgdXNpbmcgdmlkZW8gZmlsZSBkaXJlY3RseTpcIiwgZSk7XHJcbiAgICAgICAgICBmaW5hbE1lZGlhRmlsZXMucHVzaChtZWRpYSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGZpbmFsTWVkaWFGaWxlcy5wdXNoKG1lZGlhKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCB0ZXh0IGNvbnRleHQgZnJvbSB2ZWN0b3Igc3RvcmUgaWYgYXZhaWxhYmxlXHJcbiAgICBjb25zdCBzdGF0cyA9IHN0b3JlLmdldFN0YXRzKCk7XHJcbiAgICBjb25zdCBoYXNUZXh0Q29udGV4dCA9IHN0YXRzLmluZGV4X3NpemUgPiAwO1xyXG4gICAgbGV0IHRleHRSZXN1bHRzOiB7IGNodW5rOiBhbnk7IHNjb3JlOiBudW1iZXIgfVtdID0gW107XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKGBWZWN0b3Igc3RvcmUgc3RhdHMgLSBUb3RhbCBjaHVua3M6ICR7c3RhdHMudG90YWxfY2h1bmtzfSwgSW5kZXggc2l6ZTogJHtzdGF0cy5pbmRleF9zaXplfSwgSGFzIHRleHQgY29udGV4dDogJHtoYXNUZXh0Q29udGV4dH1gKTtcclxuICAgIFxyXG4gICAgaWYgKGhhc1RleHRDb250ZXh0KSB7XHJcbiAgICAgIHRleHRSZXN1bHRzID0gYXdhaXQgc3RvcmUuc2VhcmNoKHF1ZXJ5LCB0b3Bfayk7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBGb3VuZCAke3RleHRSZXN1bHRzLmxlbmd0aH0gcmVsZXZhbnQgdGV4dCBjaHVua3MgZm9yIHF1ZXJ5OiBcIiR7cXVlcnl9XCJgKTtcclxuICAgICAgaWYgKHRleHRSZXN1bHRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgVG9wIHJlc3VsdCBzY29yZTogJHt0ZXh0UmVzdWx0c1swXS5zY29yZX0sIFRleHQgcHJldmlldzogJHt0ZXh0UmVzdWx0c1swXS5jaHVuay50ZXh0LnN1YnN0cmluZygwLCAxMDApfS4uLmApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUud2FybihgTm8gc2VhcmNoIHJlc3VsdHMgZm91bmQsIGJ1dCBzdG9yZSBoYXMgJHtzdGF0cy50b3RhbF9jaHVua3N9IGNodW5rcy4gVGhpcyBtaWdodCBpbmRpY2F0ZSBhIHNlYXJjaCBpc3N1ZS5gKTtcclxuICAgICAgICAvLyBFdmVuIGlmIG5vIHNlYXJjaCByZXN1bHRzLCBpZiB3ZSBoYXZlIGNodW5rcywgdHJ5IHRvIHVzZSB0aGVtIHdpdGggbG93ZXIgdGhyZXNob2xkXHJcbiAgICAgICAgLy8gRm9yIG5vdywgd2UnbGwgcHJvY2VlZCB3aXRoIGVtcHR5IHJlc3VsdHMgYnV0IHRoZSB1c2VyIHNob3VsZCBzZWUgYSBoZWxwZnVsIG1lc3NhZ2VcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEJ1aWxkIHByb21wdCBjb21iaW5pbmcgdGV4dCBjb250ZXh0IGFuZCBtZWRpYVxyXG4gICAgbGV0IHByb21wdCA9IFwiXCI7XHJcbiAgICBjb25zdCBoaXN0ID0gaGlzdG9yeS5zbGljZSgtNSkubWFwKG0gPT4gYCR7bS5yb2xlID09PSBcInVzZXJcIiA/IFwiVXNlclwiIDogXCJBc3Npc3RhbnRcIn06ICR7bS5jb250ZW50fWApLmpvaW4oXCJcXG5cIik7XHJcbiAgICBcclxuICAgIGlmICh0ZXh0UmVzdWx0cy5sZW5ndGggPiAwICYmIGZpbmFsTWVkaWFGaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIC8vIEJvdGggdGV4dCBhbmQgaW1hZ2VzIGF2YWlsYWJsZSAtIGNvbWJpbmUgdGhlbVxyXG4gICAgICBjb25zdCBjb250ZXh0cyA9IHRleHRSZXN1bHRzLm1hcCgoYywgaSkgPT4gYFtDb250ZXh0ICR7aSArIDF9XTpcXG4ke2MuY2h1bmsudGV4dCB8fCBcIlwifVxcbmApLmpvaW4oXCJcXG5cIik7XHJcbiAgICAgIHByb21wdCA9IGAke2hpc3QgPyBgQ09OVkVSU0FUSU9OIEhJU1RPUlk6XFxuJHtoaXN0fVxcblxcbmAgOiBcIlwifVVTRVIgUVVFU1RJT046ICR7cXVlcnl9XFxuXFxuRE9DVU1FTlQgQ09OVEVYVCAoZnJvbSB1cGxvYWRlZCBkb2N1bWVudHMpOlxcbiR7Y29udGV4dHN9XFxuXFxuSU1BR0VTIFBST1ZJREVEOiAke2ZpbmFsTWVkaWFGaWxlcy5sZW5ndGh9ICR7ZmluYWxNZWRpYUZpbGVzLmxlbmd0aCA9PT0gMSA/ICdpbWFnZScgOiAnaW1hZ2VzJ30gJHtmaW5hbE1lZGlhRmlsZXMubGVuZ3RoID4gMCA/ICdoYXZlIGJlZW4gcHJvdmlkZWQuIFBsZWFzZSBhbmFseXplIHRoZSBpbWFnZXMgYWxvbmcgd2l0aCB0aGUgZG9jdW1lbnQgY29udGV4dCB0byBhbnN3ZXIgdGhlIHF1ZXN0aW9uLicgOiAnJ31cXG5cXG5QbGVhc2UgYW5zd2VyIHRoZSBxdWVzdGlvbiB1c2luZyBib3RoIHRoZSBkb2N1bWVudCBjb250ZXh0IGFuZCB0aGUgaW1hZ2VzIHByb3ZpZGVkLiBJZiB0aGUgaW1hZ2VzIGNvbnRhaW4gcmVsZXZhbnQgaW5mb3JtYXRpb24sIGluY2x1ZGUgdGhhdCBpbiB5b3VyIGFuc3dlci5cXG5cXG5BTlNXRVI6YDtcclxuICAgIH0gZWxzZSBpZiAodGV4dFJlc3VsdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAvLyBPbmx5IHRleHQgY29udGV4dCBhdmFpbGFibGVcclxuICAgICAgcHJvbXB0ID0gYnVpbGRSYWdQcm9tcHQocXVlcnksIHRleHRSZXN1bHRzLm1hcChyID0+ICh7IHRleHQ6IHIuY2h1bmsudGV4dCB9KSksIGhpc3RvcnkpO1xyXG4gICAgfSBlbHNlIGlmIChmaW5hbE1lZGlhRmlsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAvLyBPbmx5IGltYWdlcyBhdmFpbGFibGVcclxuICAgICAgcHJvbXB0ID0gYCR7aGlzdCA/IGBDT05WRVJTQVRJT04gSElTVE9SWTpcXG4ke2hpc3R9XFxuXFxuYCA6IFwiXCJ9VVNFUiBRVUVTVElPTjogJHtxdWVyeX1cXG5cXG5JTUFHRVMgUFJPVklERUQ6ICR7ZmluYWxNZWRpYUZpbGVzLmxlbmd0aH0gJHtmaW5hbE1lZGlhRmlsZXMubGVuZ3RoID09PSAxID8gJ2ltYWdlIGhhcycgOiAnaW1hZ2VzIGhhdmUnfSBiZWVuIHByb3ZpZGVkLlxcblxcblBsZWFzZSBhbmFseXplIHRoZSAke2ZpbmFsTWVkaWFGaWxlcy5sZW5ndGggPT09IDEgPyAnaW1hZ2UnIDogJ2ltYWdlcyd9IGNhcmVmdWxseSBhbmQgYW5zd2VyIHRoZSBxdWVzdGlvbiBiYXNlZCBvbiB3aGF0IHlvdSBzZWUuIERlc2NyaWJlIHRoZSBjb250ZW50LCBvYmplY3RzLCB0ZXh0LCBsYXlvdXQsIGFuZCBhbnkgcmVsZXZhbnQgZGV0YWlscyBpbiB0aGUgJHtmaW5hbE1lZGlhRmlsZXMubGVuZ3RoID09PSAxID8gJ2ltYWdlJyA6ICdpbWFnZXMnfS5cXG5cXG5BTlNXRVI6YDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIE5vIGNvbnRleHQgYXQgYWxsIC0gbmVpdGhlciB0ZXh0IHJlc3VsdHMgbm9yIG1lZGlhIGZpbGVzXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYE5vIGNvbnRleHQgYXZhaWxhYmxlIC0gaGFzVGV4dENvbnRleHQ6ICR7aGFzVGV4dENvbnRleHR9LCB0ZXh0UmVzdWx0czogJHt0ZXh0UmVzdWx0cy5sZW5ndGh9LCBtZWRpYUZpbGVzOiAke2ZpbmFsTWVkaWFGaWxlcy5sZW5ndGh9LCBzdGF0czpgLCBzdGF0cyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWhhc1RleHRDb250ZXh0ICYmIGZpbmFsTWVkaWFGaWxlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcclxuICAgICAgICAgIGRldGFpbDogXCJObyBkb2N1bWVudHMgb3IgaW1hZ2VzIHVwbG9hZGVkLiBQbGVhc2UgdXBsb2FkIGEgZG9jdW1lbnQgb3IgaW1hZ2UgZmlyc3QuIElmIHlvdSBqdXN0IHVwbG9hZGVkIGEgZmlsZSwgcGxlYXNlIHdhaXQgYSBtb21lbnQgZm9yIHByb2Nlc3NpbmcgdG8gY29tcGxldGUgYW5kIHRyeSBhZ2Fpbi5cIiBcclxuICAgICAgICB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBXZSBoYXZlIHRleHQgY29udGV4dCBidXQgbm8gc2VhcmNoIHJlc3VsdHMgLSBwcm92aWRlIGEgaGVscGZ1bCByZXNwb25zZVxyXG4gICAgICBpZiAoaGFzVGV4dENvbnRleHQgJiYgdGV4dFJlc3VsdHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXHJcbiAgICAgICAgc2Vzc2lvbl9pZCwgXHJcbiAgICAgICAgcXVlcnksIFxyXG4gICAgICAgIHJlc3BvbnNlOiBcIkkgY291bGRuJ3QgZmluZCBpbmZvcm1hdGlvbiBkaXJlY3RseSBtYXRjaGluZyB5b3VyIHF1ZXN0aW9uIGluIHRoZSB1cGxvYWRlZCBkb2N1bWVudHMuIFRoZSBkb2N1bWVudHMgbWF5IG5vdCBjb250YWluIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgc3BlY2lmaWMgdG9waWMsIG9yIHRoZSBxdWVzdGlvbiBtaWdodCBuZWVkIHRvIGJlIHJlcGhyYXNlZC4gUGxlYXNlIHRyeTpcXG4xLiBSZXBocmFzaW5nIHlvdXIgcXVlc3Rpb24gdXNpbmcgZGlmZmVyZW50IGtleXdvcmRzXFxuMi4gQXNraW5nIGEgbW9yZSBnZW5lcmFsIHF1ZXN0aW9uIGFib3V0IHRoZSBkb2N1bWVudCBjb250ZW50XFxuMy4gVXBsb2FkaW5nIGFkZGl0aW9uYWwgcmVsZXZhbnQgZG9jdW1lbnRzXCIsIFxyXG4gICAgICAgIHJlbGV2YW50X2NodW5rczogW10sIFxyXG4gICAgICAgIGNodW5rX2NvdW50OiAwIFxyXG4gICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXHJcbiAgICAgICAgc2Vzc2lvbl9pZCwgXHJcbiAgICAgICAgcXVlcnksIFxyXG4gICAgICAgIHJlc3BvbnNlOiBcIkkgY291bGRuJ3QgZmluZCByZWxldmFudCBpbmZvcm1hdGlvbiBpbiB0aGUgZG9jdW1lbnRzIHRvIGFuc3dlciB5b3VyIHF1ZXN0aW9uLiBQbGVhc2UgdHJ5IHJlcGhyYXNpbmcgeW91ciBxdWVzdGlvbiBvciB1cGxvYWQgbW9yZSByZWxldmFudCBkb2N1bWVudHMuXCIsIFxyXG4gICAgICAgIHJlbGV2YW50X2NodW5rczogW10sIFxyXG4gICAgICAgIGNodW5rX2NvdW50OiAwIFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSByZXNwb25zZSB3aXRoIEdlbWluaSAoaW5jbHVkaW5nIGltYWdlcyBpZiBhdmFpbGFibGUpXHJcbiAgICBjb25zdCBhbnN3ZXIgPSBhd2FpdCBnZW5lcmF0ZVdpdGhHZW1pbmkoXHJcbiAgICAgIHByb21wdCwgXHJcbiAgICAgIGZpbmFsTWVkaWFGaWxlcy5sZW5ndGggPiAwID8gZmluYWxNZWRpYUZpbGVzIDogdW5kZWZpbmVkXHJcbiAgICApO1xyXG4gICAgXHJcbiAgICBoaXN0b3J5LnB1c2goeyByb2xlOiBcImFzc2lzdGFudFwiLCBjb250ZW50OiBhbnN3ZXIgfSk7XHJcbiAgICBcclxuICAgIGNvbnN0IGNodW5rX2luZm8gPSB0ZXh0UmVzdWx0cy5tYXAociA9PiAoeyBcclxuICAgICAgaWQ6IHIuY2h1bmsuaWQsIFxyXG4gICAgICB0ZXh0OiByLmNodW5rLnRleHQubGVuZ3RoID4gMjAwID8gci5jaHVuay50ZXh0LnNsaWNlKDAsIDIwMCkgKyBcIi4uLlwiIDogci5jaHVuay50ZXh0LCBcclxuICAgICAgc2NvcmU6IHIuc2NvcmUgXHJcbiAgICB9KSk7XHJcbiAgICBcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IFxyXG4gICAgICBzZXNzaW9uX2lkLCBcclxuICAgICAgcXVlcnksIFxyXG4gICAgICByZXNwb25zZTogYW5zd2VyLCBcclxuICAgICAgcmVsZXZhbnRfY2h1bmtzOiBjaHVua19pbmZvLCBcclxuICAgICAgY2h1bmtfY291bnQ6IHRleHRSZXN1bHRzLmxlbmd0aCxcclxuICAgICAgbWVkaWFfYW5hbHl6ZWQ6IGZpbmFsTWVkaWFGaWxlcy5sZW5ndGhcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGU6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGluIGNoYXQgcm91dGU6XCIsIGUpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXHJcbiAgICAgIGRldGFpbDogYEVycm9yIGdlbmVyYXRpbmcgcmVzcG9uc2U6ICR7ZS5tZXNzYWdlIHx8IGV9YCBcclxuICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwic2Vzc2lvbnMiLCJzdG9yZSIsIm1lZGlhRmlsZXMiLCJidWlsZFJhZ1Byb21wdCIsImdlbmVyYXRlV2l0aEdlbWluaSIsImV4dHJhY3RWaWRlb0ZyYW1lcyIsImZzIiwicnVudGltZSIsIlBPU1QiLCJyZXEiLCJib2R5IiwianNvbiIsImNhdGNoIiwic2Vzc2lvbl9pZCIsInF1ZXJ5IiwidG9wX2siLCJ0cmltIiwiZGV0YWlsIiwic3RhdHVzIiwiaGFzIiwic2V0IiwiaGlzdG9yeSIsImdldCIsInB1c2giLCJyb2xlIiwiY29udGVudCIsIm1lZGlhVG9JbmNsdWRlIiwiaWQiLCJtZWRpYSIsImVudHJpZXMiLCJ0eXBlIiwiZmlsZVBhdGgiLCJtaW1lVHlwZSIsImNvbnNvbGUiLCJsb2ciLCJsZW5ndGgiLCJzaXplIiwiZmluYWxNZWRpYUZpbGVzIiwic3RhcnRzV2l0aCIsImZyYW1lcyIsImZyYW1lUGF0aCIsImFjY2VzcyIsImUiLCJ3YXJuIiwic3RhdHMiLCJnZXRTdGF0cyIsImhhc1RleHRDb250ZXh0IiwiaW5kZXhfc2l6ZSIsInRleHRSZXN1bHRzIiwidG90YWxfY2h1bmtzIiwic2VhcmNoIiwic2NvcmUiLCJjaHVuayIsInRleHQiLCJzdWJzdHJpbmciLCJwcm9tcHQiLCJoaXN0Iiwic2xpY2UiLCJtYXAiLCJtIiwiam9pbiIsImNvbnRleHRzIiwiYyIsImkiLCJyIiwiZXJyb3IiLCJyZXNwb25zZSIsInJlbGV2YW50X2NodW5rcyIsImNodW5rX2NvdW50IiwiYW5zd2VyIiwidW5kZWZpbmVkIiwiY2h1bmtfaW5mbyIsIm1lZGlhX2FuYWx5emVkIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/chat/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/documentProcessor.ts":
/*!**********************************!*\
  !*** ./lib/documentProcessor.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cleanText: () => (/* binding */ cleanText),\n/* harmony export */   extractTextFromPdf: () => (/* binding */ extractTextFromPdf),\n/* harmony export */   extractTextFromTxt: () => (/* binding */ extractTextFromTxt),\n/* harmony export */   extractVideoFrames: () => (/* binding */ extractVideoFrames),\n/* harmony export */   processDocument: () => (/* binding */ processDocument)\n/* harmony export */ });\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:fs/promises */ \"node:fs/promises\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_fs_promises__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pdf-parse */ \"pdf-parse\");\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(pdf_parse__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var mammoth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mammoth */ \"mammoth\");\n/* harmony import */ var mammoth__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mammoth__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var remove_markdown__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! remove-markdown */ \"(rsc)/./node_modules/remove-markdown/index.js\");\n/* harmony import */ var remove_markdown__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(remove_markdown__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! jszip */ \"jszip\");\n/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(jszip__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var tesseract_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! tesseract.js */ \"tesseract.js\");\n/* harmony import */ var tesseract_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(tesseract_js__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./settings */ \"(rsc)/./lib/settings.ts\");\n/* harmony import */ var ffmpeg_static__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ffmpeg-static */ \"ffmpeg-static\");\n/* harmony import */ var ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(ffmpeg_static__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! node:child_process */ \"node:child_process\");\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(node_child_process__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! node:util */ \"node:util\");\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(node_util__WEBPACK_IMPORTED_MODULE_9__);\n/* harmony import */ var node_os__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! node:os */ \"node:os\");\n/* harmony import */ var node_os__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(node_os__WEBPACK_IMPORTED_MODULE_10__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var _xenova_transformers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @xenova/transformers */ \"(rsc)/./node_modules/@xenova/transformers/src/transformers.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst execFile = (0,node_util__WEBPACK_IMPORTED_MODULE_9__.promisify)(node_child_process__WEBPACK_IMPORTED_MODULE_8__.execFile);\nasync function extractTextFromPdf(filePath) {\n    try {\n        const data = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath);\n        const res = await pdf_parse__WEBPACK_IMPORTED_MODULE_1___default()(data, {\n            // Options for better text extraction\n            max: 0\n        });\n        let extractedText = res.text || \"\";\n        // If no text found, try to extract from info or metadata\n        if (!extractedText || extractedText.trim().length === 0) {\n            console.warn(\"No text extracted from PDF, might be scanned/image-based PDF\");\n        // Could try OCR here if needed, but for now just return empty\n        }\n        return extractedText;\n    } catch (e) {\n        console.error(`PDF extraction error for ${filePath}:`, e);\n        throw new Error(`Error extracting text from PDF: ${e.message || e}`);\n    }\n}\nasync function extractTextFromTxt(filePath) {\n    try {\n        const content = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath, {\n            encoding: \"utf-8\"\n        });\n        return content;\n    } catch (e) {\n        const content = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath, {\n            encoding: \"latin1\"\n        });\n        return content;\n    }\n}\nfunction cleanText(text) {\n    if (!text) return \"\";\n    // Remove excessive whitespace, normalize line breaks, and trim\n    return text.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\").replace(/\\n{3,}/g, \"\\n\\n\").split(/\\s+/).join(\" \").trim();\n}\nasync function processDocument(filePath) {\n    const lower = filePath.toLowerCase();\n    let text = \"\";\n    if (lower.endsWith(\".pdf\")) {\n        text = await extractTextFromPdf(filePath);\n    } else if (lower.endsWith(\".txt\") || lower.endsWith(\".text\") || lower.endsWith(\".bxt\")) {\n        text = await extractTextFromTxt(filePath);\n    } else if (lower.endsWith(\".md\") || lower.endsWith(\".markdown\")) {\n        const raw = await extractTextFromTxt(filePath);\n        text = remove_markdown__WEBPACK_IMPORTED_MODULE_3___default()(raw);\n    } else if (lower.endsWith(\".docx\")) {\n        try {\n            const data = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath);\n            const result = await mammoth__WEBPACK_IMPORTED_MODULE_2___default().extractRawText({\n                buffer: data\n            });\n            text = result.value || \"\";\n        } catch (e) {\n            throw new Error(`Error extracting text from DOCX: ${e.message || e}`);\n        }\n    } else if (lower.endsWith(\".pptx\")) {\n        try {\n            const data = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(filePath);\n            const zip = await jszip__WEBPACK_IMPORTED_MODULE_4___default().loadAsync(data);\n            const slideFiles = Object.keys(zip.files).filter((p)=>p.startsWith(\"ppt/slides/slide\") && p.endsWith(\".xml\"));\n            const contents = await Promise.all(slideFiles.map(async (p)=>{\n                const file = zip.file(p);\n                if (!file) return \"\";\n                const xml = await file.async(\"text\");\n                return xml.replace(/<[^>]+>/g, \" \").replace(/&amp;/g, \"&\").replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\").replace(/&quot;/g, '\"').replace(/&#39;/g, \"'\");\n            }));\n            text = contents.join(\"\\n\");\n        } catch (e) {\n            throw new Error(`Error extracting text from PPTX: ${e.message || e}`);\n        }\n    } else {\n        if (lower.endsWith(\".png\") || lower.endsWith(\".jpg\") || lower.endsWith(\".jpeg\")) {\n            if (!_settings__WEBPACK_IMPORTED_MODULE_6__.settings.ENABLE_OCR) {\n                throw new Error(\"OCR is disabled by settings.\");\n            }\n            try {\n                const result = await tesseract_js__WEBPACK_IMPORTED_MODULE_5___default().recognize(filePath, \"eng\");\n                text = result.data.text || \"\";\n            } catch (e) {\n                throw new Error(`Error extracting text from image: ${e.message || e}`);\n            }\n        } else if (lower.endsWith(\".mp3\") || lower.endsWith(\".mp4\") || lower.endsWith(\".wav\") || lower.endsWith(\".m4a\")) {\n            const wavPath = await ensureWavMono16k(filePath);\n            const asr = await (0,_xenova_transformers__WEBPACK_IMPORTED_MODULE_12__.pipeline)(\"automatic-speech-recognition\", \"Xenova/whisper-tiny.en\");\n            const result = await asr(wavPath, {\n                chunk_length_s: 30\n            });\n            text = result?.text || \"\";\n        } else {\n            throw new Error(`Unsupported file type: ${filePath}`);\n        }\n    }\n    return cleanText(text);\n}\nasync function ensureWavMono16k(inputPath) {\n    if (!(ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default())) throw new Error(\"ffmpeg not available\");\n    const out = node_path__WEBPACK_IMPORTED_MODULE_11___default().join(node_os__WEBPACK_IMPORTED_MODULE_10___default().tmpdir(), `${Date.now()}_audio.wav`);\n    await execFile((ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default()), [\n        \"-y\",\n        \"-i\",\n        inputPath,\n        \"-ac\",\n        \"1\",\n        \"-ar\",\n        \"16000\",\n        \"-f\",\n        \"wav\",\n        out\n    ]);\n    return out;\n}\nasync function extractVideoFrames(videoPath, maxFrames = 5) {\n    if (!(ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default())) throw new Error(\"ffmpeg not available\");\n    const framePaths = [];\n    const baseTimestamp = Date.now();\n    // Extract frames at intervals (start, middle, end)\n    // Extract frames at: 0%, 25%, 50%, 75%, 100% of video (or maxFrames evenly spaced)\n    for(let i = 0; i < maxFrames; i++){\n        const framePath = node_path__WEBPACK_IMPORTED_MODULE_11___default().join(node_os__WEBPACK_IMPORTED_MODULE_10___default().tmpdir(), `${baseTimestamp}_frame_${i}.jpg`);\n        try {\n            // Use percentage-based extraction for better coverage\n            // -ss seeks to timestamp, then extract one frame\n            // We'll extract frames at regular intervals (every 10 seconds or evenly distributed)\n            const timestamp = i * 10; // Extract every 10 seconds\n            await execFile((ffmpeg_static__WEBPACK_IMPORTED_MODULE_7___default()), [\n                \"-y\",\n                \"-ss\",\n                timestamp.toString(),\n                \"-i\",\n                videoPath,\n                \"-vframes\",\n                \"1\",\n                \"-q:v\",\n                \"2\",\n                \"-vf\",\n                \"scale=800:-1\",\n                framePath\n            ], {\n                timeout: 15000\n            });\n            // Check if frame file was created and has content\n            try {\n                const stats = await node_fs_promises__WEBPACK_IMPORTED_MODULE_0___default().stat(framePath);\n                if (stats.size > 0) {\n                    framePaths.push(framePath);\n                }\n            } catch  {\n            // Frame not created or empty, skip\n            }\n        } catch (e) {\n            console.warn(`Failed to extract frame ${i} at ${i * 10}s:`, e);\n        // Continue with next frame\n        }\n    }\n    return framePaths;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFFbUUsY0FBYyxPQUFPLEVBQUVDLEVBQUUsSUFBSSxDQUFDO1FBRTFFLElBQUk7WUFDRixzREFBc0Q7WUFDdEQsaURBQWlEO1lBQ2pELHFGQUFxRjtZQUNyRixNQUFNRSxZQUFZRixJQUFJLElBQUksMkJBQTJCO1lBRXJELE1BQU12RSxTQUFTRCxzREFBVUEsRUFBWTtnQkFDbkM7Z0JBQ0E7Z0JBQU8wRSxVQUFVQyxRQUFRO2dCQUN6QjtnQkFBTVA7Z0JBQ047Z0JBQVk7Z0JBQ1o7Z0JBQVE7Z0JBQ1I7Z0JBQU87Z0JBQ1BLO2FBQ0QsRUFBRTtnQkFBRUcsU0FBUztZQUFNO1lBRXBCLGtEQUFrRDtZQUNsRCxJQUFJO2dCQUNGLE1BQU1DLFFBQVEsTUFBTXBGLDREQUFPLENBQUNnRjtnQkFDNUIsSUFBSUksTUFBTUUsSUFBSSxHQUFHLEdBQUc7b0JBQ2xCVCxXQUFXVSxJQUFJLENBQUNQO2dCQUNsQjtZQUNGLEVBQUUsT0FBTTtZQUNOLG1DQUFtQztZQUNyQztRQUNGLEVBQUUsT0FBT3JELEdBQUc7WUFDVkYsUUFBUUMsSUFBSSxDQUFDLENBQUMsd0JBQXdCLEVBQUVxRCxFQUFFLElBQUksRUFBRUEsSUFBSSxHQUFHLEVBQUUsQ0FBQyxFQUFFcEQ7UUFDNUQsMkJBQTJCO1FBQzdCO0lBQ0Y7SUFFQSxPQUFPa0Q7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL2RvY3MtY2hhdC1uZXh0Ly4vbGliL2RvY3VtZW50UHJvY2Vzc29yLnRzP2U0MjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gXCJub2RlOmZzL3Byb21pc2VzXCI7XHJcbmltcG9ydCBwZGYgZnJvbSBcInBkZi1wYXJzZVwiO1xyXG5pbXBvcnQgbWFtbW90aCBmcm9tIFwibWFtbW90aFwiO1xyXG5pbXBvcnQgcmVtb3ZlTWFya2Rvd24gZnJvbSBcInJlbW92ZS1tYXJrZG93blwiO1xyXG5pbXBvcnQgSlNaaXAgZnJvbSBcImpzemlwXCI7XHJcbmltcG9ydCBUZXNzZXJhY3QgZnJvbSBcInRlc3NlcmFjdC5qc1wiO1xyXG5pbXBvcnQgeyBzZXR0aW5ncyB9IGZyb20gXCIuL3NldHRpbmdzXCI7XHJcbmltcG9ydCBmZm1wZWdQYXRoIGZyb20gXCJmZm1wZWctc3RhdGljXCI7XHJcbmltcG9ydCB7IGV4ZWNGaWxlIGFzIGV4ZWNGaWxlQ2IgfSBmcm9tIFwibm9kZTpjaGlsZF9wcm9jZXNzXCI7XHJcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gXCJub2RlOnV0aWxcIjtcclxuaW1wb3J0IG9zIGZyb20gXCJub2RlOm9zXCI7XHJcbmltcG9ydCBwYXRoIGZyb20gXCJub2RlOnBhdGhcIjtcclxuaW1wb3J0IHsgcGlwZWxpbmUgYXMgaGZQaXBlbGluZSB9IGZyb20gXCJAeGVub3ZhL3RyYW5zZm9ybWVyc1wiO1xyXG5cclxuY29uc3QgZXhlY0ZpbGUgPSBwcm9taXNpZnkoZXhlY0ZpbGVDYik7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXh0cmFjdFRleHRGcm9tUGRmKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZnMucmVhZEZpbGUoZmlsZVBhdGgpO1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcGRmKGRhdGEsIHtcclxuICAgICAgLy8gT3B0aW9ucyBmb3IgYmV0dGVyIHRleHQgZXh0cmFjdGlvblxyXG4gICAgICBtYXg6IDAsIC8vIFBhcnNlIGFsbCBwYWdlc1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGxldCBleHRyYWN0ZWRUZXh0ID0gcmVzLnRleHQgfHwgXCJcIjtcclxuICAgIFxyXG4gICAgLy8gSWYgbm8gdGV4dCBmb3VuZCwgdHJ5IHRvIGV4dHJhY3QgZnJvbSBpbmZvIG9yIG1ldGFkYXRhXHJcbiAgICBpZiAoIWV4dHJhY3RlZFRleHQgfHwgZXh0cmFjdGVkVGV4dC50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcIk5vIHRleHQgZXh0cmFjdGVkIGZyb20gUERGLCBtaWdodCBiZSBzY2FubmVkL2ltYWdlLWJhc2VkIFBERlwiKTtcclxuICAgICAgLy8gQ291bGQgdHJ5IE9DUiBoZXJlIGlmIG5lZWRlZCwgYnV0IGZvciBub3cganVzdCByZXR1cm4gZW1wdHlcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGV4dHJhY3RlZFRleHQ7XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKGBQREYgZXh0cmFjdGlvbiBlcnJvciBmb3IgJHtmaWxlUGF0aH06YCwgZSk7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGV4dHJhY3RpbmcgdGV4dCBmcm9tIFBERjogJHtlLm1lc3NhZ2UgfHwgZX1gKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHRyYWN0VGV4dEZyb21UeHQoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCBmcy5yZWFkRmlsZShmaWxlUGF0aCwgeyBlbmNvZGluZzogXCJ1dGYtOFwiIH0pO1xyXG4gICAgcmV0dXJuIGNvbnRlbnQ7XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgZnMucmVhZEZpbGUoZmlsZVBhdGgsIHsgZW5jb2Rpbmc6IFwibGF0aW4xXCIgfSk7XHJcbiAgICByZXR1cm4gY29udGVudDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGVhblRleHQodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcclxuICBpZiAoIXRleHQpIHJldHVybiBcIlwiO1xyXG4gIC8vIFJlbW92ZSBleGNlc3NpdmUgd2hpdGVzcGFjZSwgbm9ybWFsaXplIGxpbmUgYnJlYWtzLCBhbmQgdHJpbVxyXG4gIHJldHVybiB0ZXh0XHJcbiAgICAucmVwbGFjZSgvXFxyXFxuL2csIFwiXFxuXCIpXHJcbiAgICAucmVwbGFjZSgvXFxyL2csIFwiXFxuXCIpXHJcbiAgICAucmVwbGFjZSgvXFxuezMsfS9nLCBcIlxcblxcblwiKVxyXG4gICAgLnNwbGl0KC9cXHMrLylcclxuICAgIC5qb2luKFwiIFwiKVxyXG4gICAgLnRyaW0oKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NEb2N1bWVudChmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICBjb25zdCBsb3dlciA9IGZpbGVQYXRoLnRvTG93ZXJDYXNlKCk7XHJcbiAgbGV0IHRleHQgPSBcIlwiO1xyXG4gIGlmIChsb3dlci5lbmRzV2l0aCgnLnBkZicpKSB7XHJcbiAgICB0ZXh0ID0gYXdhaXQgZXh0cmFjdFRleHRGcm9tUGRmKGZpbGVQYXRoKTtcclxuICB9IGVsc2UgaWYgKGxvd2VyLmVuZHNXaXRoKCcudHh0JykgfHwgbG93ZXIuZW5kc1dpdGgoJy50ZXh0JykgfHwgbG93ZXIuZW5kc1dpdGgoJy5ieHQnKSkge1xyXG4gICAgdGV4dCA9IGF3YWl0IGV4dHJhY3RUZXh0RnJvbVR4dChmaWxlUGF0aCk7XHJcbiAgfSBlbHNlIGlmIChsb3dlci5lbmRzV2l0aCgnLm1kJykgfHwgbG93ZXIuZW5kc1dpdGgoJy5tYXJrZG93bicpKSB7XHJcbiAgICBjb25zdCByYXcgPSBhd2FpdCBleHRyYWN0VGV4dEZyb21UeHQoZmlsZVBhdGgpO1xyXG4gICAgdGV4dCA9IHJlbW92ZU1hcmtkb3duKHJhdyk7XHJcbiAgfSBlbHNlIGlmIChsb3dlci5lbmRzV2l0aCgnLmRvY3gnKSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKGZpbGVQYXRoKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbWFtbW90aC5leHRyYWN0UmF3VGV4dCh7IGJ1ZmZlcjogZGF0YSB9KTtcclxuICAgICAgdGV4dCA9IHJlc3VsdC52YWx1ZSB8fCBcIlwiO1xyXG4gICAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgZXh0cmFjdGluZyB0ZXh0IGZyb20gRE9DWDogJHtlLm1lc3NhZ2UgfHwgZX1gKTtcclxuICAgIH1cclxuICB9IGVsc2UgaWYgKGxvd2VyLmVuZHNXaXRoKCcucHB0eCcpKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgZnMucmVhZEZpbGUoZmlsZVBhdGgpO1xyXG4gICAgICBjb25zdCB6aXAgPSBhd2FpdCBKU1ppcC5sb2FkQXN5bmMoZGF0YSk7XHJcbiAgICAgIGNvbnN0IHNsaWRlRmlsZXMgPSBPYmplY3Qua2V5cyh6aXAuZmlsZXMpLmZpbHRlcigocCkgPT4gcC5zdGFydHNXaXRoKCdwcHQvc2xpZGVzL3NsaWRlJykgJiYgcC5lbmRzV2l0aCgnLnhtbCcpKTtcclxuICAgICAgY29uc3QgY29udGVudHMgPSBhd2FpdCBQcm9taXNlLmFsbChzbGlkZUZpbGVzLm1hcChhc3luYyAocCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZpbGUgPSB6aXAuZmlsZShwKTtcclxuICAgICAgICBpZiAoIWZpbGUpIHJldHVybiBcIlwiO1xyXG4gICAgICAgIGNvbnN0IHhtbCA9IGF3YWl0IGZpbGUuYXN5bmMoJ3RleHQnKTtcclxuICAgICAgICByZXR1cm4geG1sLnJlcGxhY2UoLzxbXj5dKz4vZywgJyAnKS5yZXBsYWNlKC8mYW1wOy9nLCAnJicpLnJlcGxhY2UoLyZsdDsvZywgJzwnKS5yZXBsYWNlKC8mZ3Q7L2csICc+JykucmVwbGFjZSgvJnF1b3Q7L2csICdcIicpLnJlcGxhY2UoLyYjMzk7L2csIFwiJ1wiKTtcclxuICAgICAgfSkpO1xyXG4gICAgICB0ZXh0ID0gY29udGVudHMuam9pbignXFxuJyk7XHJcbiAgICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBleHRyYWN0aW5nIHRleHQgZnJvbSBQUFRYOiAke2UubWVzc2FnZSB8fCBlfWApO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBpZiAobG93ZXIuZW5kc1dpdGgoJy5wbmcnKSB8fCBsb3dlci5lbmRzV2l0aCgnLmpwZycpIHx8IGxvd2VyLmVuZHNXaXRoKCcuanBlZycpKSB7XHJcbiAgICAgIGlmICghc2V0dGluZ3MuRU5BQkxFX09DUikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk9DUiBpcyBkaXNhYmxlZCBieSBzZXR0aW5ncy5cIik7XHJcbiAgICAgIH1cclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBUZXNzZXJhY3QucmVjb2duaXplKGZpbGVQYXRoLCAnZW5nJyk7XHJcbiAgICAgICAgdGV4dCA9IHJlc3VsdC5kYXRhLnRleHQgfHwgXCJcIjtcclxuICAgICAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBleHRyYWN0aW5nIHRleHQgZnJvbSBpbWFnZTogJHtlLm1lc3NhZ2UgfHwgZX1gKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChsb3dlci5lbmRzV2l0aCgnLm1wMycpIHx8IGxvd2VyLmVuZHNXaXRoKCcubXA0JykgfHwgbG93ZXIuZW5kc1dpdGgoJy53YXYnKSB8fCBsb3dlci5lbmRzV2l0aCgnLm00YScpKSB7XHJcbiAgICAgIGNvbnN0IHdhdlBhdGggPSBhd2FpdCBlbnN1cmVXYXZNb25vMTZrKGZpbGVQYXRoKTtcclxuICAgICAgY29uc3QgYXNyID0gYXdhaXQgaGZQaXBlbGluZSgnYXV0b21hdGljLXNwZWVjaC1yZWNvZ25pdGlvbicsICdYZW5vdmEvd2hpc3Blci10aW55LmVuJyk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdDogYW55ID0gYXdhaXQgYXNyKHdhdlBhdGgsIHsgY2h1bmtfbGVuZ3RoX3M6IDMwIH0pO1xyXG4gICAgICB0ZXh0ID0gcmVzdWx0Py50ZXh0IHx8ICcnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgZmlsZSB0eXBlOiAke2ZpbGVQYXRofWApO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gY2xlYW5UZXh0KHRleHQpO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBlbnN1cmVXYXZNb25vMTZrKGlucHV0UGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICBpZiAoIWZmbXBlZ1BhdGgpIHRocm93IG5ldyBFcnJvcignZmZtcGVnIG5vdCBhdmFpbGFibGUnKTtcclxuICBjb25zdCBvdXQgPSBwYXRoLmpvaW4ob3MudG1wZGlyKCksIGAke0RhdGUubm93KCl9X2F1ZGlvLndhdmApO1xyXG4gIGF3YWl0IGV4ZWNGaWxlKGZmbXBlZ1BhdGggYXMgc3RyaW5nLCBbXHJcbiAgICAnLXknLFxyXG4gICAgJy1pJywgaW5wdXRQYXRoLFxyXG4gICAgJy1hYycsICcxJyxcclxuICAgICctYXInLCAnMTYwMDAnLFxyXG4gICAgJy1mJywgJ3dhdicsXHJcbiAgICBvdXQsXHJcbiAgXSk7XHJcbiAgcmV0dXJuIG91dDtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RWaWRlb0ZyYW1lcyh2aWRlb1BhdGg6IHN0cmluZywgbWF4RnJhbWVzOiBudW1iZXIgPSA1KTogUHJvbWlzZTxzdHJpbmdbXT4ge1xyXG4gIGlmICghZmZtcGVnUGF0aCkgdGhyb3cgbmV3IEVycm9yKCdmZm1wZWcgbm90IGF2YWlsYWJsZScpO1xyXG4gIFxyXG4gIGNvbnN0IGZyYW1lUGF0aHM6IHN0cmluZ1tdID0gW107XHJcbiAgY29uc3QgYmFzZVRpbWVzdGFtcCA9IERhdGUubm93KCk7XHJcbiAgXHJcbiAgLy8gRXh0cmFjdCBmcmFtZXMgYXQgaW50ZXJ2YWxzIChzdGFydCwgbWlkZGxlLCBlbmQpXHJcbiAgLy8gRXh0cmFjdCBmcmFtZXMgYXQ6IDAlLCAyNSUsIDUwJSwgNzUlLCAxMDAlIG9mIHZpZGVvIChvciBtYXhGcmFtZXMgZXZlbmx5IHNwYWNlZClcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IG1heEZyYW1lczsgaSsrKSB7XHJcbiAgICBjb25zdCBmcmFtZVBhdGggPSBwYXRoLmpvaW4ob3MudG1wZGlyKCksIGAke2Jhc2VUaW1lc3RhbXB9X2ZyYW1lXyR7aX0uanBnYCk7XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFVzZSBwZXJjZW50YWdlLWJhc2VkIGV4dHJhY3Rpb24gZm9yIGJldHRlciBjb3ZlcmFnZVxyXG4gICAgICAvLyAtc3Mgc2Vla3MgdG8gdGltZXN0YW1wLCB0aGVuIGV4dHJhY3Qgb25lIGZyYW1lXHJcbiAgICAgIC8vIFdlJ2xsIGV4dHJhY3QgZnJhbWVzIGF0IHJlZ3VsYXIgaW50ZXJ2YWxzIChldmVyeSAxMCBzZWNvbmRzIG9yIGV2ZW5seSBkaXN0cmlidXRlZClcclxuICAgICAgY29uc3QgdGltZXN0YW1wID0gaSAqIDEwOyAvLyBFeHRyYWN0IGV2ZXJ5IDEwIHNlY29uZHNcclxuICAgICAgXHJcbiAgICAgIGF3YWl0IGV4ZWNGaWxlKGZmbXBlZ1BhdGggYXMgc3RyaW5nLCBbXHJcbiAgICAgICAgJy15JyxcclxuICAgICAgICAnLXNzJywgdGltZXN0YW1wLnRvU3RyaW5nKCksXHJcbiAgICAgICAgJy1pJywgdmlkZW9QYXRoLFxyXG4gICAgICAgICctdmZyYW1lcycsICcxJyxcclxuICAgICAgICAnLXE6dicsICcyJywgLy8gSGlnaCBxdWFsaXR5XHJcbiAgICAgICAgJy12ZicsICdzY2FsZT04MDA6LTEnLCAvLyBSZXNpemUgZm9yIGVmZmljaWVuY3lcclxuICAgICAgICBmcmFtZVBhdGgsXHJcbiAgICAgIF0sIHsgdGltZW91dDogMTUwMDAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiBmcmFtZSBmaWxlIHdhcyBjcmVhdGVkIGFuZCBoYXMgY29udGVudFxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgZnMuc3RhdChmcmFtZVBhdGgpO1xyXG4gICAgICAgIGlmIChzdGF0cy5zaXplID4gMCkge1xyXG4gICAgICAgICAgZnJhbWVQYXRocy5wdXNoKGZyYW1lUGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIHtcclxuICAgICAgICAvLyBGcmFtZSBub3QgY3JlYXRlZCBvciBlbXB0eSwgc2tpcFxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIGV4dHJhY3QgZnJhbWUgJHtpfSBhdCAke2kgKiAxMH1zOmAsIGUpO1xyXG4gICAgICAvLyBDb250aW51ZSB3aXRoIG5leHQgZnJhbWVcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIGZyYW1lUGF0aHM7XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJmcyIsInBkZiIsIm1hbW1vdGgiLCJyZW1vdmVNYXJrZG93biIsIkpTWmlwIiwiVGVzc2VyYWN0Iiwic2V0dGluZ3MiLCJmZm1wZWdQYXRoIiwiZXhlY0ZpbGUiLCJleGVjRmlsZUNiIiwicHJvbWlzaWZ5Iiwib3MiLCJwYXRoIiwicGlwZWxpbmUiLCJoZlBpcGVsaW5lIiwiZXh0cmFjdFRleHRGcm9tUGRmIiwiZmlsZVBhdGgiLCJkYXRhIiwicmVhZEZpbGUiLCJyZXMiLCJtYXgiLCJleHRyYWN0ZWRUZXh0IiwidGV4dCIsInRyaW0iLCJsZW5ndGgiLCJjb25zb2xlIiwid2FybiIsImUiLCJlcnJvciIsIkVycm9yIiwibWVzc2FnZSIsImV4dHJhY3RUZXh0RnJvbVR4dCIsImNvbnRlbnQiLCJlbmNvZGluZyIsImNsZWFuVGV4dCIsInJlcGxhY2UiLCJzcGxpdCIsImpvaW4iLCJwcm9jZXNzRG9jdW1lbnQiLCJsb3dlciIsInRvTG93ZXJDYXNlIiwiZW5kc1dpdGgiLCJyYXciLCJyZXN1bHQiLCJleHRyYWN0UmF3VGV4dCIsImJ1ZmZlciIsInZhbHVlIiwiemlwIiwibG9hZEFzeW5jIiwic2xpZGVGaWxlcyIsIk9iamVjdCIsImtleXMiLCJmaWxlcyIsImZpbHRlciIsInAiLCJzdGFydHNXaXRoIiwiY29udGVudHMiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiZmlsZSIsInhtbCIsImFzeW5jIiwiRU5BQkxFX09DUiIsInJlY29nbml6ZSIsIndhdlBhdGgiLCJlbnN1cmVXYXZNb25vMTZrIiwiYXNyIiwiY2h1bmtfbGVuZ3RoX3MiLCJpbnB1dFBhdGgiLCJvdXQiLCJ0bXBkaXIiLCJEYXRlIiwibm93IiwiZXh0cmFjdFZpZGVvRnJhbWVzIiwidmlkZW9QYXRoIiwibWF4RnJhbWVzIiwiZnJhbWVQYXRocyIsImJhc2VUaW1lc3RhbXAiLCJpIiwiZnJhbWVQYXRoIiwidGltZXN0YW1wIiwidG9TdHJpbmciLCJ0aW1lb3V0Iiwic3RhdHMiLCJzdGF0Iiwic2l6ZSIsInB1c2giXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/documentProcessor.ts\n");

/***/ }),

/***/ "(rsc)/./lib/gemini.ts":
/*!***********************!*\
  !*** ./lib/gemini.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   buildRagPrompt: () => (/* binding */ buildRagPrompt),\n/* harmony export */   generateWithGemini: () => (/* binding */ generateWithGemini),\n/* harmony export */   getMimeType: () => (/* binding */ getMimeType)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./settings */ \"(rsc)/./lib/settings.ts\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:fs/promises */ \"node:fs/promises\");\n/* harmony import */ var node_fs_promises__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_fs_promises__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nfunction buildRagPrompt(query, relevant, history) {\n    const contexts = relevant.map((c, i)=>`[Context ${i + 1}]:\\n${c.text || \"\"}\\n`).join(\"\\n\");\n    const hist = (history || []).slice(-5).map((m)=>`${capitalize(m.role)}: ${m.content}`).join(\"\\n\");\n    return `${_settings__WEBPACK_IMPORTED_MODULE_1__.SYSTEM_PROMPT}\r\n\r\nDOCUMENT CONTEXT:\r\n${contexts}\r\n\r\n${hist ? `CONVERSATION HISTORY:\\n${hist}\\n\\n` : \"\"}USER QUESTION:\r\n${query}\r\n\r\nANSWER:`;\n}\nasync function generateWithGemini(prompt, mediaFiles) {\n    if (!_settings__WEBPACK_IMPORTED_MODULE_1__.settings.GEMINI_API_KEY) {\n        throw new Error(\"GEMINI_API_KEY not set\");\n    }\n    const genai = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(_settings__WEBPACK_IMPORTED_MODULE_1__.settings.GEMINI_API_KEY);\n    const model = genai.getGenerativeModel({\n        model: _settings__WEBPACK_IMPORTED_MODULE_1__.settings.GEMINI_MODEL\n    });\n    // Build parts array: text + media files\n    const parts = [\n        {\n            text: prompt\n        }\n    ];\n    // Add media files (images/videos) to the prompt\n    if (mediaFiles && mediaFiles.length > 0) {\n        for (const media of mediaFiles){\n            try {\n                const fileData = await node_fs_promises__WEBPACK_IMPORTED_MODULE_2___default().readFile(media.filePath);\n                const base64Data = fileData.toString(\"base64\");\n                parts.push({\n                    inline_data: {\n                        mime_type: media.mimeType,\n                        data: base64Data\n                    }\n                });\n            } catch (e) {\n                console.warn(`Failed to read media file ${media.filePath}:`, e);\n            }\n        }\n    }\n    const result = await model.generateContent({\n        contents: [\n            {\n                role: \"user\",\n                parts\n            }\n        ]\n    });\n    const text = result.response.text();\n    return text;\n}\nfunction capitalize(s) {\n    return s ? s[0].toUpperCase() + s.slice(1) : s;\n}\nfunction getMimeType(filePath) {\n    const lower = filePath.toLowerCase();\n    if (lower.endsWith(\".png\")) return \"image/png\";\n    if (lower.endsWith(\".jpg\") || lower.endsWith(\".jpeg\")) return \"image/jpeg\";\n    if (lower.endsWith(\".gif\")) return \"image/gif\";\n    if (lower.endsWith(\".webp\")) return \"image/webp\";\n    if (lower.endsWith(\".mp4\")) return \"video/mp4\";\n    if (lower.endsWith(\".webm\")) return \"video/webm\";\n    if (lower.endsWith(\".mov\")) return \"video/quicktime\";\n    return \"application/octet-stream\";\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3BDLElBQUlGLE1BQU1FLFFBQVEsQ0FBQyxTQUFTLE9BQU87SUFDbkMsT0FBTztBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZG9jcy1jaGF0LW5leHQvLi9saWIvZ2VtaW5pLnRzP2I2MzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR29vZ2xlR2VuZXJhdGl2ZUFJIH0gZnJvbSBcIkBnb29nbGUvZ2VuZXJhdGl2ZS1haVwiO1xyXG5pbXBvcnQgeyBTWVNURU1fUFJPTVBULCBzZXR0aW5ncyB9IGZyb20gXCIuL3NldHRpbmdzXCI7XHJcbmltcG9ydCBmcyBmcm9tIFwibm9kZTpmcy9wcm9taXNlc1wiO1xyXG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRSYWdQcm9tcHQocXVlcnk6IHN0cmluZywgcmVsZXZhbnQ6IHsgdGV4dD86IHN0cmluZyB9W10sIGhpc3Rvcnk/OiB7IHJvbGU6IHN0cmluZzsgY29udGVudDogc3RyaW5nIH1bXSkge1xyXG4gIGNvbnN0IGNvbnRleHRzID0gcmVsZXZhbnQubWFwKChjLCBpKSA9PiBgW0NvbnRleHQgJHtpICsgMX1dOlxcbiR7Yy50ZXh0IHx8IFwiXCJ9XFxuYCkuam9pbihcIlxcblwiKTtcclxuICBjb25zdCBoaXN0ID0gKGhpc3RvcnkgfHwgW10pLnNsaWNlKC01KS5tYXAobSA9PiBgJHtjYXBpdGFsaXplKG0ucm9sZSl9OiAke20uY29udGVudH1gKS5qb2luKFwiXFxuXCIpO1xyXG4gIHJldHVybiBgJHtTWVNURU1fUFJPTVBUfVxyXG5cclxuRE9DVU1FTlQgQ09OVEVYVDpcclxuJHtjb250ZXh0c31cclxuXHJcbiR7aGlzdCA/IGBDT05WRVJTQVRJT04gSElTVE9SWTpcXG4ke2hpc3R9XFxuXFxuYCA6IFwiXCJ9VVNFUiBRVUVTVElPTjpcclxuJHtxdWVyeX1cclxuXHJcbkFOU1dFUjpgO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVXaXRoR2VtaW5pKFxyXG4gIHByb21wdDogc3RyaW5nLCBcclxuICBtZWRpYUZpbGVzPzogeyBmaWxlUGF0aDogc3RyaW5nOyBtaW1lVHlwZTogc3RyaW5nIH1bXVxyXG4pOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gIGlmICghc2V0dGluZ3MuR0VNSU5JX0FQSV9LRVkpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkdFTUlOSV9BUElfS0VZIG5vdCBzZXRcIik7XHJcbiAgfVxyXG4gIGNvbnN0IGdlbmFpID0gbmV3IEdvb2dsZUdlbmVyYXRpdmVBSShzZXR0aW5ncy5HRU1JTklfQVBJX0tFWSk7XHJcbiAgY29uc3QgbW9kZWwgPSBnZW5haS5nZXRHZW5lcmF0aXZlTW9kZWwoeyBtb2RlbDogc2V0dGluZ3MuR0VNSU5JX01PREVMIH0pO1xyXG4gIFxyXG4gIC8vIEJ1aWxkIHBhcnRzIGFycmF5OiB0ZXh0ICsgbWVkaWEgZmlsZXNcclxuICBjb25zdCBwYXJ0czogYW55W10gPSBbeyB0ZXh0OiBwcm9tcHQgfV07XHJcbiAgXHJcbiAgLy8gQWRkIG1lZGlhIGZpbGVzIChpbWFnZXMvdmlkZW9zKSB0byB0aGUgcHJvbXB0XHJcbiAgaWYgKG1lZGlhRmlsZXMgJiYgbWVkaWFGaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICBmb3IgKGNvbnN0IG1lZGlhIG9mIG1lZGlhRmlsZXMpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBmaWxlRGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKG1lZGlhLmZpbGVQYXRoKTtcclxuICAgICAgICBjb25zdCBiYXNlNjREYXRhID0gZmlsZURhdGEudG9TdHJpbmcoJ2Jhc2U2NCcpO1xyXG4gICAgICAgIHBhcnRzLnB1c2goe1xyXG4gICAgICAgICAgaW5saW5lX2RhdGE6IHtcclxuICAgICAgICAgICAgbWltZV90eXBlOiBtZWRpYS5taW1lVHlwZSxcclxuICAgICAgICAgICAgZGF0YTogYmFzZTY0RGF0YVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gcmVhZCBtZWRpYSBmaWxlICR7bWVkaWEuZmlsZVBhdGh9OmAsIGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vZGVsLmdlbmVyYXRlQ29udGVudCh7IFxyXG4gICAgY29udGVudHM6IFt7IHJvbGU6IFwidXNlclwiLCBwYXJ0cyB9XSBcclxuICB9KTtcclxuICBjb25zdCB0ZXh0ID0gcmVzdWx0LnJlc3BvbnNlLnRleHQoKTtcclxuICByZXR1cm4gdGV4dDtcclxufVxyXG5cclxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzOiBzdHJpbmcpIHtcclxuICByZXR1cm4gcyA/IHNbMF0udG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSkgOiBzO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWltZVR5cGUoZmlsZVBhdGg6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgbG93ZXIgPSBmaWxlUGF0aC50b0xvd2VyQ2FzZSgpO1xyXG4gIGlmIChsb3dlci5lbmRzV2l0aCgnLnBuZycpKSByZXR1cm4gJ2ltYWdlL3BuZyc7XHJcbiAgaWYgKGxvd2VyLmVuZHNXaXRoKCcuanBnJykgfHwgbG93ZXIuZW5kc1dpdGgoJy5qcGVnJykpIHJldHVybiAnaW1hZ2UvanBlZyc7XHJcbiAgaWYgKGxvd2VyLmVuZHNXaXRoKCcuZ2lmJykpIHJldHVybiAnaW1hZ2UvZ2lmJztcclxuICBpZiAobG93ZXIuZW5kc1dpdGgoJy53ZWJwJykpIHJldHVybiAnaW1hZ2Uvd2VicCc7XHJcbiAgaWYgKGxvd2VyLmVuZHNXaXRoKCcubXA0JykpIHJldHVybiAndmlkZW8vbXA0JztcclxuICBpZiAobG93ZXIuZW5kc1dpdGgoJy53ZWJtJykpIHJldHVybiAndmlkZW8vd2VibSc7XHJcbiAgaWYgKGxvd2VyLmVuZHNXaXRoKCcubW92JykpIHJldHVybiAndmlkZW8vcXVpY2t0aW1lJztcclxuICByZXR1cm4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJHb29nbGVHZW5lcmF0aXZlQUkiLCJTWVNURU1fUFJPTVBUIiwic2V0dGluZ3MiLCJmcyIsImJ1aWxkUmFnUHJvbXB0IiwicXVlcnkiLCJyZWxldmFudCIsImhpc3RvcnkiLCJjb250ZXh0cyIsIm1hcCIsImMiLCJpIiwidGV4dCIsImpvaW4iLCJoaXN0Iiwic2xpY2UiLCJtIiwiY2FwaXRhbGl6ZSIsInJvbGUiLCJjb250ZW50IiwiZ2VuZXJhdGVXaXRoR2VtaW5pIiwicHJvbXB0IiwibWVkaWFGaWxlcyIsIkdFTUlOSV9BUElfS0VZIiwiRXJyb3IiLCJnZW5haSIsIm1vZGVsIiwiZ2V0R2VuZXJhdGl2ZU1vZGVsIiwiR0VNSU5JX01PREVMIiwicGFydHMiLCJsZW5ndGgiLCJtZWRpYSIsImZpbGVEYXRhIiwicmVhZEZpbGUiLCJmaWxlUGF0aCIsImJhc2U2NERhdGEiLCJ0b1N0cmluZyIsInB1c2giLCJpbmxpbmVfZGF0YSIsIm1pbWVfdHlwZSIsIm1pbWVUeXBlIiwiZGF0YSIsImUiLCJjb25zb2xlIiwid2FybiIsInJlc3VsdCIsImdlbmVyYXRlQ29udGVudCIsImNvbnRlbnRzIiwicmVzcG9uc2UiLCJzIiwidG9VcHBlckNhc2UiLCJnZXRNaW1lVHlwZSIsImxvd2VyIiwidG9Mb3dlckNhc2UiLCJlbmRzV2l0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/gemini.ts\n");

/***/ }),

/***/ "(rsc)/./lib/settings.ts":
/*!*************************!*\
  !*** ./lib/settings.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SYSTEM_PROMPT: () => (/* binding */ SYSTEM_PROMPT),\n/* harmony export */   settings: () => (/* binding */ settings)\n/* harmony export */ });\nconst settings = {\n    GEMINI_API_KEY: process.env.GEMINI_API_KEY || \"\",\n    MAX_CHUNK_SIZE: Number(process.env.MAX_CHUNK_SIZE || 1000),\n    CHUNK_OVERLAP: Number(process.env.CHUNK_OVERLAP || 200),\n    MAX_FILE_SIZE_MB: Number(process.env.MAX_FILE_SIZE_MB || 50),\n    EMBEDDING_MODEL: process.env.EMBEDDING_MODEL || \"Xenova/all-MiniLM-L6-v2\",\n    GEMINI_MODEL: process.env.GEMINI_MODEL || \"gemini-2.0-flash-exp\",\n    TEMPERATURE: Number(process.env.TEMPERATURE || 0.7),\n    MAX_OUTPUT_TOKENS: Number(process.env.MAX_OUTPUT_TOKENS || 2048),\n    ENABLE_OCR: String(process.env.ENABLE_OCR || \"true\") === \"true\",\n    ENABLE_YOUTUBE: String(process.env.ENABLE_YOUTUBE || \"true\") === \"true\",\n    MONGODB_URI: process.env.MONGODB_URI || \"mongodb://localhost:27017\",\n    MONGODB_DB_NAME: process.env.MONGODB_DB_NAME || \"docs-chat\"\n};\nconst SYSTEM_PROMPT = `You are a helpful assistant that answers questions based on the provided document context and any images provided.\r\nWhen answering:\r\n1. Use the document context provided to answer the question as accurately as possible\r\n2. If images are provided, analyze them carefully and describe what you see\r\n3. If the information is partially available in the context, provide what you can find and mention what might be missing\r\n4. If the answer cannot be found in the provided context or images, clearly state that the specific information is not available\r\n5. Be helpful and provide relevant information even if it's not an exact match to the question\r\n6. Always cite which part of the document or image you're referencing when possible`;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2V0dGluZ3MudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFlTyxNQUFNQSxXQUFxQjtJQUNoQ0MsZ0JBQWdCQyxRQUFRQyxHQUFHLENBQUNGLGNBQWMsSUFBSTtJQUM5Q0csZ0JBQWdCQyxPQUFPSCxRQUFRQyxHQUFHLENBQUNDLGNBQWMsSUFBSTtJQUNyREUsZUFBZUQsT0FBT0gsUUFBUUMsR0FBRyxDQUFDRyxhQUFhLElBQUk7SUFDbkRDLGtCQUFrQkYsT0FBT0gsUUFBUUMsR0FBRyxDQUFDSSxnQkFBZ0IsSUFBSTtJQUN6REMsaUJBQWlCTixRQUFRQyxHQUFHLENBQUNLLGVBQWUsSUFBSTtJQUNoREMsY0FBY1AsUUFBUUMsR0FBRyxDQUFDTSxZQUFZLElBQUk7SUFDMUNDLGFBQWFMLE9BQU9ILFFBQVFDLEdBQUcsQ0FBQ08sV0FBVyxJQUFJO0lBQy9DQyxtQkFBbUJOLE9BQU9ILFFBQVFDLEdBQUcsQ0FBQ1EsaUJBQWlCLElBQUk7SUFDM0RDLFlBQVlDLE9BQU9YLFFBQVFDLEdBQUcsQ0FBQ1MsVUFBVSxJQUFJLFlBQVk7SUFDekRFLGdCQUFnQkQsT0FBT1gsUUFBUUMsR0FBRyxDQUFDVyxjQUFjLElBQUksWUFBWTtJQUNqRUMsYUFBYWIsUUFBUUMsR0FBRyxDQUFDWSxXQUFXLElBQUk7SUFDeENDLGlCQUFpQmQsUUFBUUMsR0FBRyxDQUFDYSxlQUFlLElBQUk7QUFDbEQsRUFBRTtBQUVLLE1BQU1DLGdCQUFnQixDQUFDOzs7Ozs7O21GQU9xRCxDQUFDLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kb2NzLWNoYXQtbmV4dC8uL2xpYi9zZXR0aW5ncy50cz8xZDcyIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB0eXBlIFNldHRpbmdzID0ge1xyXG4gIEdFTUlOSV9BUElfS0VZOiBzdHJpbmc7XHJcbiAgTUFYX0NIVU5LX1NJWkU6IG51bWJlcjtcclxuICBDSFVOS19PVkVSTEFQOiBudW1iZXI7XHJcbiAgTUFYX0ZJTEVfU0laRV9NQjogbnVtYmVyO1xyXG4gIEVNQkVERElOR19NT0RFTDogc3RyaW5nO1xyXG4gIEdFTUlOSV9NT0RFTDogc3RyaW5nO1xyXG4gIFRFTVBFUkFUVVJFOiBudW1iZXI7XHJcbiAgTUFYX09VVFBVVF9UT0tFTlM6IG51bWJlcjtcclxuICBFTkFCTEVfT0NSOiBib29sZWFuO1xyXG4gIEVOQUJMRV9ZT1VUVUJFOiBib29sZWFuO1xyXG4gIE1PTkdPREJfVVJJOiBzdHJpbmc7XHJcbiAgTU9OR09EQl9EQl9OQU1FOiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc2V0dGluZ3M6IFNldHRpbmdzID0ge1xyXG4gIEdFTUlOSV9BUElfS0VZOiBwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWSB8fCBcIlwiLFxyXG4gIE1BWF9DSFVOS19TSVpFOiBOdW1iZXIocHJvY2Vzcy5lbnYuTUFYX0NIVU5LX1NJWkUgfHwgMTAwMCksXHJcbiAgQ0hVTktfT1ZFUkxBUDogTnVtYmVyKHByb2Nlc3MuZW52LkNIVU5LX09WRVJMQVAgfHwgMjAwKSxcclxuICBNQVhfRklMRV9TSVpFX01COiBOdW1iZXIocHJvY2Vzcy5lbnYuTUFYX0ZJTEVfU0laRV9NQiB8fCA1MCksXHJcbiAgRU1CRURESU5HX01PREVMOiBwcm9jZXNzLmVudi5FTUJFRERJTkdfTU9ERUwgfHwgXCJYZW5vdmEvYWxsLU1pbmlMTS1MNi12MlwiLFxyXG4gIEdFTUlOSV9NT0RFTDogcHJvY2Vzcy5lbnYuR0VNSU5JX01PREVMIHx8IFwiZ2VtaW5pLTIuMC1mbGFzaC1leHBcIixcclxuICBURU1QRVJBVFVSRTogTnVtYmVyKHByb2Nlc3MuZW52LlRFTVBFUkFUVVJFIHx8IDAuNyksXHJcbiAgTUFYX09VVFBVVF9UT0tFTlM6IE51bWJlcihwcm9jZXNzLmVudi5NQVhfT1VUUFVUX1RPS0VOUyB8fCAyMDQ4KSxcclxuICBFTkFCTEVfT0NSOiBTdHJpbmcocHJvY2Vzcy5lbnYuRU5BQkxFX09DUiB8fCBcInRydWVcIikgPT09IFwidHJ1ZVwiLFxyXG4gIEVOQUJMRV9ZT1VUVUJFOiBTdHJpbmcocHJvY2Vzcy5lbnYuRU5BQkxFX1lPVVRVQkUgfHwgXCJ0cnVlXCIpID09PSBcInRydWVcIixcclxuICBNT05HT0RCX1VSSTogcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkkgfHwgXCJtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3XCIsXHJcbiAgTU9OR09EQl9EQl9OQU1FOiBwcm9jZXNzLmVudi5NT05HT0RCX0RCX05BTUUgfHwgXCJkb2NzLWNoYXRcIixcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBTWVNURU1fUFJPTVBUID0gYFlvdSBhcmUgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IGFuc3dlcnMgcXVlc3Rpb25zIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBkb2N1bWVudCBjb250ZXh0IGFuZCBhbnkgaW1hZ2VzIHByb3ZpZGVkLlxyXG5XaGVuIGFuc3dlcmluZzpcclxuMS4gVXNlIHRoZSBkb2N1bWVudCBjb250ZXh0IHByb3ZpZGVkIHRvIGFuc3dlciB0aGUgcXVlc3Rpb24gYXMgYWNjdXJhdGVseSBhcyBwb3NzaWJsZVxyXG4yLiBJZiBpbWFnZXMgYXJlIHByb3ZpZGVkLCBhbmFseXplIHRoZW0gY2FyZWZ1bGx5IGFuZCBkZXNjcmliZSB3aGF0IHlvdSBzZWVcclxuMy4gSWYgdGhlIGluZm9ybWF0aW9uIGlzIHBhcnRpYWxseSBhdmFpbGFibGUgaW4gdGhlIGNvbnRleHQsIHByb3ZpZGUgd2hhdCB5b3UgY2FuIGZpbmQgYW5kIG1lbnRpb24gd2hhdCBtaWdodCBiZSBtaXNzaW5nXHJcbjQuIElmIHRoZSBhbnN3ZXIgY2Fubm90IGJlIGZvdW5kIGluIHRoZSBwcm92aWRlZCBjb250ZXh0IG9yIGltYWdlcywgY2xlYXJseSBzdGF0ZSB0aGF0IHRoZSBzcGVjaWZpYyBpbmZvcm1hdGlvbiBpcyBub3QgYXZhaWxhYmxlXHJcbjUuIEJlIGhlbHBmdWwgYW5kIHByb3ZpZGUgcmVsZXZhbnQgaW5mb3JtYXRpb24gZXZlbiBpZiBpdCdzIG5vdCBhbiBleGFjdCBtYXRjaCB0byB0aGUgcXVlc3Rpb25cclxuNi4gQWx3YXlzIGNpdGUgd2hpY2ggcGFydCBvZiB0aGUgZG9jdW1lbnQgb3IgaW1hZ2UgeW91J3JlIHJlZmVyZW5jaW5nIHdoZW4gcG9zc2libGVgO1xyXG5cclxuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiR0VNSU5JX0FQSV9LRVkiLCJwcm9jZXNzIiwiZW52IiwiTUFYX0NIVU5LX1NJWkUiLCJOdW1iZXIiLCJDSFVOS19PVkVSTEFQIiwiTUFYX0ZJTEVfU0laRV9NQiIsIkVNQkVERElOR19NT0RFTCIsIkdFTUlOSV9NT0RFTCIsIlRFTVBFUkFUVVJFIiwiTUFYX09VVFBVVF9UT0tFTlMiLCJFTkFCTEVfT0NSIiwiU3RyaW5nIiwiRU5BQkxFX1lPVVRVQkUiLCJNT05HT0RCX1VSSSIsIk1PTkdPREJfREJfTkFNRSIsIlNZU1RFTV9QUk9NUFQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/settings.ts\n");

/***/ }),

/***/ "(rsc)/./lib/textChunker.ts":
/*!****************************!*\
  !*** ./lib/textChunker.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TextChunker: () => (/* binding */ TextChunker)\n/* harmony export */ });\nclass TextChunker {\n    constructor(chunkSize = 1000, overlap = 200){\n        this.chunkSize = chunkSize;\n        this.overlap = overlap;\n    }\n    chunkBySentences(text, maxChunkSize) {\n        const limit = maxChunkSize ?? this.chunkSize;\n        const sentences = text.replace(/!/g, \".\").replace(/\\?/g, \".\").split(\".\").map((s)=>s.trim()).filter(Boolean);\n        const chunks = [];\n        let current = [];\n        let size = 0;\n        let id = 0;\n        for (const sentence of sentences){\n            const sentSize = sentence.split(/\\s+/).length;\n            if (size + sentSize > limit && current.length) {\n                chunks.push({\n                    id,\n                    text: current.join(\". \") + \".\",\n                    sentence_count: current.length,\n                    token_count: size\n                });\n                id += 1;\n                if (this.overlap > 0 && current.length > 1) {\n                    current = current.slice(-1);\n                    size = current[0].split(/\\s+/).length;\n                } else {\n                    current = [];\n                    size = 0;\n                }\n            }\n            current.push(sentence);\n            size += sentSize;\n        }\n        if (current.length) {\n            chunks.push({\n                id,\n                text: current.join(\". \") + \".\",\n                sentence_count: current.length,\n                token_count: size\n            });\n        }\n        return chunks;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdGV4dENodW5rZXIudHMiLCJtYXBwaW5ncyI6Ijs7OztBQVNPLE1BQU1BO0lBSVhDLFlBQVlDLFlBQW9CLElBQUksRUFBRUMsVUFBa0IsR0FBRyxDQUFFO1FBQzNELElBQUksQ0FBQ0QsU0FBUyxHQUFHQTtRQUNqQixJQUFJLENBQUNDLE9BQU8sR0FBR0E7SUFDakI7SUFFQUMsaUJBQWlCQyxJQUFZLEVBQUVDLFlBQXFCLEVBQVc7UUFDN0QsTUFBTUMsUUFBUUQsZ0JBQWdCLElBQUksQ0FBQ0osU0FBUztRQUM1QyxNQUFNTSxZQUFZSCxLQUFLSSxPQUFPLENBQUMsTUFBTSxLQUFLQSxPQUFPLENBQUMsT0FBTyxLQUFLQyxLQUFLLENBQUMsS0FBS0MsR0FBRyxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFQyxJQUFJLElBQUlDLE1BQU0sQ0FBQ0M7UUFDbkcsTUFBTUMsU0FBa0IsRUFBRTtRQUMxQixJQUFJQyxVQUFvQixFQUFFO1FBQzFCLElBQUlDLE9BQU87UUFDWCxJQUFJQyxLQUFLO1FBRVQsS0FBSyxNQUFNQyxZQUFZWixVQUFXO1lBQ2hDLE1BQU1hLFdBQVdELFNBQVNWLEtBQUssQ0FBQyxPQUFPWSxNQUFNO1lBQzdDLElBQUlKLE9BQU9HLFdBQVdkLFNBQVNVLFFBQVFLLE1BQU0sRUFBRTtnQkFDN0NOLE9BQU9PLElBQUksQ0FBQztvQkFBRUo7b0JBQUlkLE1BQU1ZLFFBQVFPLElBQUksQ0FBQyxRQUFRO29CQUFLQyxnQkFBZ0JSLFFBQVFLLE1BQU07b0JBQUVJLGFBQWFSO2dCQUFLO2dCQUNwR0MsTUFBTTtnQkFDTixJQUFJLElBQUksQ0FBQ2hCLE9BQU8sR0FBRyxLQUFLYyxRQUFRSyxNQUFNLEdBQUcsR0FBRztvQkFDMUNMLFVBQVVBLFFBQVFVLEtBQUssQ0FBQyxDQUFDO29CQUN6QlQsT0FBT0QsT0FBTyxDQUFDLEVBQUUsQ0FBQ1AsS0FBSyxDQUFDLE9BQU9ZLE1BQU07Z0JBQ3ZDLE9BQU87b0JBQ0xMLFVBQVUsRUFBRTtvQkFDWkMsT0FBTztnQkFDVDtZQUNGO1lBQ0FELFFBQVFNLElBQUksQ0FBQ0g7WUFDYkYsUUFBUUc7UUFDVjtRQUNBLElBQUlKLFFBQVFLLE1BQU0sRUFBRTtZQUNsQk4sT0FBT08sSUFBSSxDQUFDO2dCQUFFSjtnQkFBSWQsTUFBTVksUUFBUU8sSUFBSSxDQUFDLFFBQVE7Z0JBQUtDLGdCQUFnQlIsUUFBUUssTUFBTTtnQkFBRUksYUFBYVI7WUFBSztRQUN0RztRQUNBLE9BQU9GO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2RvY3MtY2hhdC1uZXh0Ly4vbGliL3RleHRDaHVua2VyLnRzPzc4NDAiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgQ2h1bmsgPSB7XHJcbiAgaWQ6IG51bWJlcjtcclxuICB0ZXh0OiBzdHJpbmc7XHJcbiAgdG9rZW5fY291bnQ/OiBudW1iZXI7XHJcbiAgc2VudGVuY2VfY291bnQ/OiBudW1iZXI7XHJcbiAgc3RhcnRfcG9zPzogbnVtYmVyO1xyXG4gIGVuZF9wb3M/OiBudW1iZXI7XHJcbn07XHJcblxyXG5leHBvcnQgY2xhc3MgVGV4dENodW5rZXIge1xyXG4gIHByaXZhdGUgY2h1bmtTaXplOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBvdmVybGFwOiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGNodW5rU2l6ZTogbnVtYmVyID0gMTAwMCwgb3ZlcmxhcDogbnVtYmVyID0gMjAwKSB7XHJcbiAgICB0aGlzLmNodW5rU2l6ZSA9IGNodW5rU2l6ZTtcclxuICAgIHRoaXMub3ZlcmxhcCA9IG92ZXJsYXA7XHJcbiAgfVxyXG5cclxuICBjaHVua0J5U2VudGVuY2VzKHRleHQ6IHN0cmluZywgbWF4Q2h1bmtTaXplPzogbnVtYmVyKTogQ2h1bmtbXSB7XHJcbiAgICBjb25zdCBsaW1pdCA9IG1heENodW5rU2l6ZSA/PyB0aGlzLmNodW5rU2l6ZTtcclxuICAgIGNvbnN0IHNlbnRlbmNlcyA9IHRleHQucmVwbGFjZSgvIS9nLCBcIi5cIikucmVwbGFjZSgvXFw/L2csIFwiLlwiKS5zcGxpdChcIi5cIikubWFwKHMgPT4gcy50cmltKCkpLmZpbHRlcihCb29sZWFuKTtcclxuICAgIGNvbnN0IGNodW5rczogQ2h1bmtbXSA9IFtdO1xyXG4gICAgbGV0IGN1cnJlbnQ6IHN0cmluZ1tdID0gW107XHJcbiAgICBsZXQgc2l6ZSA9IDA7XHJcbiAgICBsZXQgaWQgPSAwO1xyXG5cclxuICAgIGZvciAoY29uc3Qgc2VudGVuY2Ugb2Ygc2VudGVuY2VzKSB7XHJcbiAgICAgIGNvbnN0IHNlbnRTaXplID0gc2VudGVuY2Uuc3BsaXQoL1xccysvKS5sZW5ndGg7XHJcbiAgICAgIGlmIChzaXplICsgc2VudFNpemUgPiBsaW1pdCAmJiBjdXJyZW50Lmxlbmd0aCkge1xyXG4gICAgICAgIGNodW5rcy5wdXNoKHsgaWQsIHRleHQ6IGN1cnJlbnQuam9pbignLiAnKSArICcuJywgc2VudGVuY2VfY291bnQ6IGN1cnJlbnQubGVuZ3RoLCB0b2tlbl9jb3VudDogc2l6ZSB9KTtcclxuICAgICAgICBpZCArPSAxO1xyXG4gICAgICAgIGlmICh0aGlzLm92ZXJsYXAgPiAwICYmIGN1cnJlbnQubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQuc2xpY2UoLTEpO1xyXG4gICAgICAgICAgc2l6ZSA9IGN1cnJlbnRbMF0uc3BsaXQoL1xccysvKS5sZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGN1cnJlbnQgPSBbXTtcclxuICAgICAgICAgIHNpemUgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBjdXJyZW50LnB1c2goc2VudGVuY2UpO1xyXG4gICAgICBzaXplICs9IHNlbnRTaXplO1xyXG4gICAgfVxyXG4gICAgaWYgKGN1cnJlbnQubGVuZ3RoKSB7XHJcbiAgICAgIGNodW5rcy5wdXNoKHsgaWQsIHRleHQ6IGN1cnJlbnQuam9pbignLiAnKSArICcuJywgc2VudGVuY2VfY291bnQ6IGN1cnJlbnQubGVuZ3RoLCB0b2tlbl9jb3VudDogc2l6ZSB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBjaHVua3M7XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibmFtZXMiOlsiVGV4dENodW5rZXIiLCJjb25zdHJ1Y3RvciIsImNodW5rU2l6ZSIsIm92ZXJsYXAiLCJjaHVua0J5U2VudGVuY2VzIiwidGV4dCIsIm1heENodW5rU2l6ZSIsImxpbWl0Iiwic2VudGVuY2VzIiwicmVwbGFjZSIsInNwbGl0IiwibWFwIiwicyIsInRyaW0iLCJmaWx0ZXIiLCJCb29sZWFuIiwiY2h1bmtzIiwiY3VycmVudCIsInNpemUiLCJpZCIsInNlbnRlbmNlIiwic2VudFNpemUiLCJsZW5ndGgiLCJwdXNoIiwiam9pbiIsInNlbnRlbmNlX2NvdW50IiwidG9rZW5fY291bnQiLCJzbGljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/textChunker.ts\n");

/***/ }),

/***/ "(rsc)/./lib/vectorStore.ts":
/*!****************************!*\
  !*** ./lib/vectorStore.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   VectorStore: () => (/* binding */ VectorStore)\n/* harmony export */ });\n/* harmony import */ var _xenova_transformers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @xenova/transformers */ \"(rsc)/./node_modules/@xenova/transformers/src/transformers.js\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_1__);\n\n\nclass VectorStore {\n    constructor(modelName, mongoUri, dbName){\n        this.chunks = [];\n        this.embeddings = [];\n        this.embedderPromise = null;\n        this.client = null;\n        this.db = null;\n        this.collection = null;\n        this.isConnected = false;\n        this.modelName = modelName;\n        this.useMongo = Boolean(mongoUri);\n        if (mongoUri) {\n            this.client = new mongodb__WEBPACK_IMPORTED_MODULE_1__.MongoClient(mongoUri);\n            this.initMongo(dbName || \"docs-chat\").catch((err)=>{\n                console.error(\"Failed to initialize MongoDB:\", err);\n            });\n        }\n    }\n    async initMongo(dbName) {\n        try {\n            if (!this.client) {\n                console.warn(\"MongoDB client not initialized\");\n                this.isConnected = false;\n                return;\n            }\n            await this.client.connect();\n            this.db = this.client.db(dbName);\n            this.collection = this.db.collection(\"chunks\");\n            // Create index on id for faster lookups\n            try {\n                await this.collection.createIndex({\n                    id: 1\n                });\n            } catch (idxErr) {\n                // Index might already exist, that's okay\n                console.log(\"Index creation note:\", idxErr);\n            }\n            this.isConnected = true;\n            console.log(`Connected to MongoDB database: ${dbName}`);\n            await this.loadFromMongo();\n        } catch (err) {\n            console.error(\"MongoDB connection error:\", err.message || err);\n            console.warn(\"Falling back to in-memory storage. Data will not persist.\");\n            this.isConnected = false;\n        // Continue with in-memory mode - the app will still work\n        }\n    }\n    async loadFromMongo() {\n        if (!this.collection || !this.isConnected) {\n            console.log(\"Skipping MongoDB load - not connected\");\n            return;\n        }\n        try {\n            const documents = await this.collection.find({}).sort({\n                id: 1\n            }).toArray();\n            // Only load if we don't already have chunks in memory (to avoid overwriting)\n            if (this.chunks.length === 0 && documents.length > 0) {\n                this.chunks = documents.map((doc)=>({\n                        id: doc.id,\n                        text: doc.text\n                    }));\n                this.embeddings = documents.map((doc)=>new Float32Array(doc.embedding));\n                console.log(`Loaded ${this.chunks.length} chunks from MongoDB`);\n            } else if (this.chunks.length > 0) {\n                console.log(`Skipping MongoDB load - already have ${this.chunks.length} chunks in memory`);\n            } else {\n                console.log(\"No chunks in MongoDB to load\");\n            }\n        } catch (err) {\n            console.error(\"Failed to load from MongoDB:\", err);\n        }\n    }\n    async getEmbedder() {\n        if (!this.embedderPromise) {\n            const model = this.modelName.includes(\"/\") ? this.modelName : `Xenova/${this.modelName}`;\n            this.embedderPromise = (0,_xenova_transformers__WEBPACK_IMPORTED_MODULE_0__.pipeline)(\"feature-extraction\", model);\n        }\n        return this.embedderPromise;\n    }\n    async addDocuments(chunks) {\n        if (!chunks.length) {\n            console.warn(\"addDocuments called with empty chunks array\");\n            return;\n        }\n        console.log(`Adding ${chunks.length} chunks to vector store. Current chunks: ${this.chunks.length}`);\n        const embedder = await this.getEmbedder();\n        const texts = chunks.map((c)=>c.text);\n        const outputs = await embedder(texts, {\n            pooling: \"mean\",\n            normalize: true\n        });\n        const vectors = outputs.tolist().map((row)=>new Float32Array(row));\n        // Determine starting ID\n        const startId = this.chunks.length > 0 ? Math.max(...this.chunks.map((c)=>c.id)) + 1 : 0;\n        const chunksWithIds = chunks.map((chunk, i)=>({\n                ...chunk,\n                id: startId + i\n            }));\n        // Add to memory FIRST (this ensures in-memory mode works even if MongoDB fails)\n        this.chunks.push(...chunksWithIds);\n        this.embeddings.push(...vectors);\n        console.log(`Added ${chunksWithIds.length} chunks to memory. Total chunks now: ${this.chunks.length}`);\n        // Save to MongoDB if connected (this is optional - memory storage is primary)\n        if (this.collection && this.isConnected) {\n            try {\n                const documents = chunksWithIds.map((chunk, i)=>({\n                        id: chunk.id,\n                        text: chunk.text,\n                        embedding: Array.from(vectors[i]),\n                        createdAt: new Date()\n                    }));\n                await this.collection.insertMany(documents);\n                console.log(`Saved ${documents.length} chunks to MongoDB`);\n            } catch (err) {\n                console.error(\"Failed to save to MongoDB (continuing with in-memory storage):\", err);\n            // Continue even if MongoDB save fails - memory storage is already done\n            }\n        } else {\n            console.log(`MongoDB not connected (isConnected: ${this.isConnected}), using in-memory storage only`);\n        }\n    }\n    async search(query, topK = 5) {\n        if (this.chunks.length === 0) return [];\n        const embedder = await this.getEmbedder();\n        const out = await embedder(query, {\n            pooling: \"mean\",\n            normalize: true\n        });\n        const q = new Float32Array(out.tolist()[0]);\n        // Calculate cosine similarity for all embeddings\n        const scores = this.embeddings.map((v)=>cosineSimilarity(q, v));\n        // Sort by score and get top K\n        const indices = scores.map((s, i)=>[\n                s,\n                i\n            ]).sort((a, b)=>b[0] - a[0]).slice(0, Math.min(topK, scores.length));\n        return indices.map(([score, i])=>({\n                chunk: this.chunks[i],\n                score\n            }));\n    }\n    async clear() {\n        this.chunks = [];\n        this.embeddings = [];\n        if (this.collection && this.isConnected) {\n            try {\n                const result = await this.collection.deleteMany({});\n                console.log(`Cleared ${result.deletedCount} chunks from MongoDB`);\n            } catch (err) {\n                console.error(\"Failed to clear MongoDB:\", err);\n            // Continue even if MongoDB clear fails - memory is already cleared\n            }\n        }\n    }\n    getStats() {\n        return {\n            total_chunks: this.chunks.length,\n            dimension: this.embeddings[0]?.length || 0,\n            model_name: this.modelName,\n            index_size: this.embeddings.length\n        };\n    }\n    async close() {\n        if (this.client && this.isConnected) {\n            await this.client.close();\n            this.isConnected = false;\n        }\n    }\n}\nfunction cosineSimilarity(a, b) {\n    let dot = 0;\n    let na = 0;\n    let nb = 0;\n    for(let i = 0; i < a.length && i < b.length; i++){\n        dot += a[i] * b[i];\n        na += a[i] * a[i];\n        nb += b[i] * b[i];\n    }\n    if (na === 0 || nb === 0) return 0;\n    return dot / (Math.sqrt(na) * Math.sqrt(nb));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxNQUFNaEIsQ0FBQyxDQUFDbEIsRUFBRSxHQUFHa0IsQ0FBQyxDQUFDbEIsRUFBRTtJQUNuQjtJQUNBLElBQUlpQyxPQUFPLEtBQUtDLE9BQU8sR0FBRyxPQUFPO0lBQ2pDLE9BQU9GLE1BQU9wQyxDQUFBQSxLQUFLdUMsSUFBSSxDQUFDRixNQUFNckMsS0FBS3VDLElBQUksQ0FBQ0QsR0FBRTtBQUM1QyIsInNvdXJjZXMiOlsid2VicGFjazovL2RvY3MtY2hhdC1uZXh0Ly4vbGliL3ZlY3RvclN0b3JlLnRzPzQzMzgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGlwZWxpbmUgfSBmcm9tIFwiQHhlbm92YS90cmFuc2Zvcm1lcnNcIjtcclxuaW1wb3J0IHR5cGUgeyBDaHVuayB9IGZyb20gXCIuL3RleHRDaHVua2VyXCI7XHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50LCBEYiwgQ29sbGVjdGlvbiB9IGZyb20gXCJtb25nb2RiXCI7XHJcbmltcG9ydCB7IHNldHRpbmdzIH0gZnJvbSBcIi4vc2V0dGluZ3NcIjtcclxuXHJcbnR5cGUgRW1iZWRkaW5nID0gRmxvYXQzMkFycmF5O1xyXG5cclxuaW50ZXJmYWNlIENodW5rRG9jdW1lbnQge1xyXG4gIGlkOiBudW1iZXI7XHJcbiAgdGV4dDogc3RyaW5nO1xyXG4gIGVtYmVkZGluZzogbnVtYmVyW107XHJcbiAgY3JlYXRlZEF0OiBEYXRlO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVmVjdG9yU3RvcmUge1xyXG4gIHByaXZhdGUgY2h1bmtzOiBDaHVua1tdID0gW107XHJcbiAgcHJpdmF0ZSBlbWJlZGRpbmdzOiBFbWJlZGRpbmdbXSA9IFtdO1xyXG4gIHByaXZhdGUgZW1iZWRkZXJQcm9taXNlOiBQcm9taXNlPGFueT4gfCBudWxsID0gbnVsbDtcclxuICBwcml2YXRlIG1vZGVsTmFtZTogc3RyaW5nO1xyXG4gIHByaXZhdGUgY2xpZW50OiBNb25nb0NsaWVudCB8IG51bGwgPSBudWxsO1xyXG4gIHByaXZhdGUgZGI6IERiIHwgbnVsbCA9IG51bGw7XHJcbiAgcHJpdmF0ZSBjb2xsZWN0aW9uOiBDb2xsZWN0aW9uPENodW5rRG9jdW1lbnQ+IHwgbnVsbCA9IG51bGw7XHJcbiAgcHJpdmF0ZSB1c2VNb25nbzogYm9vbGVhbjtcclxuICBwcml2YXRlIGlzQ29ubmVjdGVkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKG1vZGVsTmFtZTogc3RyaW5nLCBtb25nb1VyaT86IHN0cmluZywgZGJOYW1lPzogc3RyaW5nKSB7XHJcbiAgICB0aGlzLm1vZGVsTmFtZSA9IG1vZGVsTmFtZTtcclxuICAgIHRoaXMudXNlTW9uZ28gPSBCb29sZWFuKG1vbmdvVXJpKTtcclxuICAgIFxyXG4gICAgaWYgKG1vbmdvVXJpKSB7XHJcbiAgICAgIHRoaXMuY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KG1vbmdvVXJpKTtcclxuICAgICAgdGhpcy5pbml0TW9uZ28oZGJOYW1lIHx8IFwiZG9jcy1jaGF0XCIpLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGluaXRpYWxpemUgTW9uZ29EQjpcIiwgZXJyKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGluaXRNb25nbyhkYk5hbWU6IHN0cmluZykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCF0aGlzLmNsaWVudCkge1xyXG4gICAgICAgIGNvbnNvbGUud2FybihcIk1vbmdvREIgY2xpZW50IG5vdCBpbml0aWFsaXplZFwiKTtcclxuICAgICAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5jb25uZWN0KCk7XHJcbiAgICAgIHRoaXMuZGIgPSB0aGlzLmNsaWVudC5kYihkYk5hbWUpO1xyXG4gICAgICB0aGlzLmNvbGxlY3Rpb24gPSB0aGlzLmRiLmNvbGxlY3Rpb248Q2h1bmtEb2N1bWVudD4oXCJjaHVua3NcIik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDcmVhdGUgaW5kZXggb24gaWQgZm9yIGZhc3RlciBsb29rdXBzXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmNyZWF0ZUluZGV4KHsgaWQ6IDEgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGlkeEVycikge1xyXG4gICAgICAgIC8vIEluZGV4IG1pZ2h0IGFscmVhZHkgZXhpc3QsIHRoYXQncyBva2F5XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJJbmRleCBjcmVhdGlvbiBub3RlOlwiLCBpZHhFcnIpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLmlzQ29ubmVjdGVkID0gdHJ1ZTtcclxuICAgICAgY29uc29sZS5sb2coYENvbm5lY3RlZCB0byBNb25nb0RCIGRhdGFiYXNlOiAke2RiTmFtZX1gKTtcclxuICAgICAgYXdhaXQgdGhpcy5sb2FkRnJvbU1vbmdvKCk7XHJcbiAgICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiTW9uZ29EQiBjb25uZWN0aW9uIGVycm9yOlwiLCBlcnIubWVzc2FnZSB8fCBlcnIpO1xyXG4gICAgICBjb25zb2xlLndhcm4oXCJGYWxsaW5nIGJhY2sgdG8gaW4tbWVtb3J5IHN0b3JhZ2UuIERhdGEgd2lsbCBub3QgcGVyc2lzdC5cIik7XHJcbiAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgLy8gQ29udGludWUgd2l0aCBpbi1tZW1vcnkgbW9kZSAtIHRoZSBhcHAgd2lsbCBzdGlsbCB3b3JrXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGxvYWRGcm9tTW9uZ28oKSB7XHJcbiAgICBpZiAoIXRoaXMuY29sbGVjdGlvbiB8fCAhdGhpcy5pc0Nvbm5lY3RlZCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcIlNraXBwaW5nIE1vbmdvREIgbG9hZCAtIG5vdCBjb25uZWN0ZWRcIik7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZG9jdW1lbnRzID0gYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmZpbmQoe30pLnNvcnQoeyBpZDogMSB9KS50b0FycmF5KCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBPbmx5IGxvYWQgaWYgd2UgZG9uJ3QgYWxyZWFkeSBoYXZlIGNodW5rcyBpbiBtZW1vcnkgKHRvIGF2b2lkIG92ZXJ3cml0aW5nKVxyXG4gICAgICBpZiAodGhpcy5jaHVua3MubGVuZ3RoID09PSAwICYmIGRvY3VtZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5jaHVua3MgPSBkb2N1bWVudHMubWFwKChkb2MpID0+ICh7IFxyXG4gICAgICAgICAgaWQ6IGRvYy5pZCwgXHJcbiAgICAgICAgICB0ZXh0OiBkb2MudGV4dCBcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgdGhpcy5lbWJlZGRpbmdzID0gZG9jdW1lbnRzLm1hcCgoZG9jKSA9PiBcclxuICAgICAgICAgIG5ldyBGbG9hdDMyQXJyYXkoZG9jLmVtYmVkZGluZylcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBMb2FkZWQgJHt0aGlzLmNodW5rcy5sZW5ndGh9IGNodW5rcyBmcm9tIE1vbmdvREJgKTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmNodW5rcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYFNraXBwaW5nIE1vbmdvREIgbG9hZCAtIGFscmVhZHkgaGF2ZSAke3RoaXMuY2h1bmtzLmxlbmd0aH0gY2h1bmtzIGluIG1lbW9yeWApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiTm8gY2h1bmtzIGluIE1vbmdvREIgdG8gbG9hZFwiKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBmcm9tIE1vbmdvREI6XCIsIGVycik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGdldEVtYmVkZGVyKCkge1xyXG4gICAgaWYgKCF0aGlzLmVtYmVkZGVyUHJvbWlzZSkge1xyXG4gICAgICBjb25zdCBtb2RlbCA9IHRoaXMubW9kZWxOYW1lLmluY2x1ZGVzKCcvJykgPyB0aGlzLm1vZGVsTmFtZSA6IGBYZW5vdmEvJHt0aGlzLm1vZGVsTmFtZX1gO1xyXG4gICAgICB0aGlzLmVtYmVkZGVyUHJvbWlzZSA9IHBpcGVsaW5lKFwiZmVhdHVyZS1leHRyYWN0aW9uXCIsIG1vZGVsKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmVtYmVkZGVyUHJvbWlzZTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGFkZERvY3VtZW50cyhjaHVua3M6IENodW5rW10pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICghY2h1bmtzLmxlbmd0aCkge1xyXG4gICAgICBjb25zb2xlLndhcm4oXCJhZGREb2N1bWVudHMgY2FsbGVkIHdpdGggZW1wdHkgY2h1bmtzIGFycmF5XCIpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKGBBZGRpbmcgJHtjaHVua3MubGVuZ3RofSBjaHVua3MgdG8gdmVjdG9yIHN0b3JlLiBDdXJyZW50IGNodW5rczogJHt0aGlzLmNodW5rcy5sZW5ndGh9YCk7XHJcbiAgICBcclxuICAgIGNvbnN0IGVtYmVkZGVyID0gYXdhaXQgdGhpcy5nZXRFbWJlZGRlcigpO1xyXG4gICAgY29uc3QgdGV4dHMgPSBjaHVua3MubWFwKGMgPT4gYy50ZXh0KTtcclxuICAgIGNvbnN0IG91dHB1dHMgPSBhd2FpdCBlbWJlZGRlcih0ZXh0cywgeyBwb29saW5nOiBcIm1lYW5cIiwgbm9ybWFsaXplOiB0cnVlIH0pO1xyXG4gICAgY29uc3QgdmVjdG9yczogRW1iZWRkaW5nW10gPSBvdXRwdXRzLnRvbGlzdCgpLm1hcCgocm93OiBudW1iZXJbXSkgPT4gbmV3IEZsb2F0MzJBcnJheShyb3cpKTtcclxuICAgIFxyXG4gICAgLy8gRGV0ZXJtaW5lIHN0YXJ0aW5nIElEXHJcbiAgICBjb25zdCBzdGFydElkID0gdGhpcy5jaHVua3MubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLnRoaXMuY2h1bmtzLm1hcChjID0+IGMuaWQpKSArIDEgOiAwO1xyXG4gICAgY29uc3QgY2h1bmtzV2l0aElkcyA9IGNodW5rcy5tYXAoKGNodW5rLCBpKSA9PiAoeyAuLi5jaHVuaywgaWQ6IHN0YXJ0SWQgKyBpIH0pKTtcclxuICAgIFxyXG4gICAgLy8gQWRkIHRvIG1lbW9yeSBGSVJTVCAodGhpcyBlbnN1cmVzIGluLW1lbW9yeSBtb2RlIHdvcmtzIGV2ZW4gaWYgTW9uZ29EQiBmYWlscylcclxuICAgIHRoaXMuY2h1bmtzLnB1c2goLi4uY2h1bmtzV2l0aElkcyk7XHJcbiAgICB0aGlzLmVtYmVkZGluZ3MucHVzaCguLi52ZWN0b3JzKTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coYEFkZGVkICR7Y2h1bmtzV2l0aElkcy5sZW5ndGh9IGNodW5rcyB0byBtZW1vcnkuIFRvdGFsIGNodW5rcyBub3c6ICR7dGhpcy5jaHVua3MubGVuZ3RofWApO1xyXG4gICAgXHJcbiAgICAvLyBTYXZlIHRvIE1vbmdvREIgaWYgY29ubmVjdGVkICh0aGlzIGlzIG9wdGlvbmFsIC0gbWVtb3J5IHN0b3JhZ2UgaXMgcHJpbWFyeSlcclxuICAgIGlmICh0aGlzLmNvbGxlY3Rpb24gJiYgdGhpcy5pc0Nvbm5lY3RlZCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGRvY3VtZW50czogQ2h1bmtEb2N1bWVudFtdID0gY2h1bmtzV2l0aElkcy5tYXAoKGNodW5rLCBpKSA9PiAoe1xyXG4gICAgICAgICAgaWQ6IGNodW5rLmlkLFxyXG4gICAgICAgICAgdGV4dDogY2h1bmsudGV4dCxcclxuICAgICAgICAgIGVtYmVkZGluZzogQXJyYXkuZnJvbSh2ZWN0b3JzW2ldKSxcclxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmluc2VydE1hbnkoZG9jdW1lbnRzKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhgU2F2ZWQgJHtkb2N1bWVudHMubGVuZ3RofSBjaHVua3MgdG8gTW9uZ29EQmApO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNhdmUgdG8gTW9uZ29EQiAoY29udGludWluZyB3aXRoIGluLW1lbW9yeSBzdG9yYWdlKTpcIiwgZXJyKTtcclxuICAgICAgICAvLyBDb250aW51ZSBldmVuIGlmIE1vbmdvREIgc2F2ZSBmYWlscyAtIG1lbW9yeSBzdG9yYWdlIGlzIGFscmVhZHkgZG9uZVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmxvZyhgTW9uZ29EQiBub3QgY29ubmVjdGVkIChpc0Nvbm5lY3RlZDogJHt0aGlzLmlzQ29ubmVjdGVkfSksIHVzaW5nIGluLW1lbW9yeSBzdG9yYWdlIG9ubHlgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHNlYXJjaChxdWVyeTogc3RyaW5nLCB0b3BLOiBudW1iZXIgPSA1KTogUHJvbWlzZTx7IGNodW5rOiBDaHVuazsgc2NvcmU6IG51bWJlciB9W10+IHtcclxuICAgIGlmICh0aGlzLmNodW5rcy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcclxuICAgIFxyXG4gICAgY29uc3QgZW1iZWRkZXIgPSBhd2FpdCB0aGlzLmdldEVtYmVkZGVyKCk7XHJcbiAgICBjb25zdCBvdXQgPSBhd2FpdCBlbWJlZGRlcihxdWVyeSwgeyBwb29saW5nOiBcIm1lYW5cIiwgbm9ybWFsaXplOiB0cnVlIH0pO1xyXG4gICAgY29uc3QgcSA9IG5ldyBGbG9hdDMyQXJyYXkob3V0LnRvbGlzdCgpWzBdKTtcclxuICAgIFxyXG4gICAgLy8gQ2FsY3VsYXRlIGNvc2luZSBzaW1pbGFyaXR5IGZvciBhbGwgZW1iZWRkaW5nc1xyXG4gICAgY29uc3Qgc2NvcmVzID0gdGhpcy5lbWJlZGRpbmdzLm1hcCgodikgPT4gY29zaW5lU2ltaWxhcml0eShxLCB2KSk7XHJcbiAgICBcclxuICAgIC8vIFNvcnQgYnkgc2NvcmUgYW5kIGdldCB0b3AgS1xyXG4gICAgY29uc3QgaW5kaWNlcyA9IHNjb3Jlc1xyXG4gICAgICAubWFwKChzLCBpKSA9PiBbcywgaV0gYXMgY29uc3QpXHJcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiWzBdIC0gYVswXSlcclxuICAgICAgLnNsaWNlKDAsIE1hdGgubWluKHRvcEssIHNjb3Jlcy5sZW5ndGgpKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIGluZGljZXMubWFwKChbc2NvcmUsIGldKSA9PiAoeyBcclxuICAgICAgY2h1bms6IHRoaXMuY2h1bmtzW2ldLCBcclxuICAgICAgc2NvcmUgXHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBjbGVhcigpIHtcclxuICAgIHRoaXMuY2h1bmtzID0gW107XHJcbiAgICB0aGlzLmVtYmVkZGluZ3MgPSBbXTtcclxuICAgIFxyXG4gICAgaWYgKHRoaXMuY29sbGVjdGlvbiAmJiB0aGlzLmlzQ29ubmVjdGVkKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmRlbGV0ZU1hbnkoe30pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBDbGVhcmVkICR7cmVzdWx0LmRlbGV0ZWRDb3VudH0gY2h1bmtzIGZyb20gTW9uZ29EQmApO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNsZWFyIE1vbmdvREI6XCIsIGVycik7XHJcbiAgICAgICAgLy8gQ29udGludWUgZXZlbiBpZiBNb25nb0RCIGNsZWFyIGZhaWxzIC0gbWVtb3J5IGlzIGFscmVhZHkgY2xlYXJlZFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRTdGF0cygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRvdGFsX2NodW5rczogdGhpcy5jaHVua3MubGVuZ3RoLFxyXG4gICAgICBkaW1lbnNpb246IHRoaXMuZW1iZWRkaW5nc1swXT8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgIG1vZGVsX25hbWU6IHRoaXMubW9kZWxOYW1lLFxyXG4gICAgICBpbmRleF9zaXplOiB0aGlzLmVtYmVkZGluZ3MubGVuZ3RoLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGNsb3NlKCkge1xyXG4gICAgaWYgKHRoaXMuY2xpZW50ICYmIHRoaXMuaXNDb25uZWN0ZWQpIHtcclxuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuY2xvc2UoKTtcclxuICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY29zaW5lU2ltaWxhcml0eShhOiBGbG9hdDMyQXJyYXksIGI6IEZsb2F0MzJBcnJheSk6IG51bWJlciB7XHJcbiAgbGV0IGRvdCA9IDA7XHJcbiAgbGV0IG5hID0gMDtcclxuICBsZXQgbmIgPSAwO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYS5sZW5ndGggJiYgaSA8IGIubGVuZ3RoOyBpKyspIHtcclxuICAgIGRvdCArPSBhW2ldICogYltpXTtcclxuICAgIG5hICs9IGFbaV0gKiBhW2ldO1xyXG4gICAgbmIgKz0gYltpXSAqIGJbaV07XHJcbiAgfVxyXG4gIGlmIChuYSA9PT0gMCB8fCBuYiA9PT0gMCkgcmV0dXJuIDA7XHJcbiAgcmV0dXJuIGRvdCAvIChNYXRoLnNxcnQobmEpICogTWF0aC5zcXJ0KG5iKSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbInBpcGVsaW5lIiwiTW9uZ29DbGllbnQiLCJWZWN0b3JTdG9yZSIsImNvbnN0cnVjdG9yIiwibW9kZWxOYW1lIiwibW9uZ29VcmkiLCJkYk5hbWUiLCJjaHVua3MiLCJlbWJlZGRpbmdzIiwiZW1iZWRkZXJQcm9taXNlIiwiY2xpZW50IiwiZGIiLCJjb2xsZWN0aW9uIiwiaXNDb25uZWN0ZWQiLCJ1c2VNb25nbyIsIkJvb2xlYW4iLCJpbml0TW9uZ28iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsIndhcm4iLCJjb25uZWN0IiwiY3JlYXRlSW5kZXgiLCJpZCIsImlkeEVyciIsImxvZyIsImxvYWRGcm9tTW9uZ28iLCJtZXNzYWdlIiwiZG9jdW1lbnRzIiwiZmluZCIsInNvcnQiLCJ0b0FycmF5IiwibGVuZ3RoIiwibWFwIiwiZG9jIiwidGV4dCIsIkZsb2F0MzJBcnJheSIsImVtYmVkZGluZyIsImdldEVtYmVkZGVyIiwibW9kZWwiLCJpbmNsdWRlcyIsImFkZERvY3VtZW50cyIsImVtYmVkZGVyIiwidGV4dHMiLCJjIiwib3V0cHV0cyIsInBvb2xpbmciLCJub3JtYWxpemUiLCJ2ZWN0b3JzIiwidG9saXN0Iiwicm93Iiwic3RhcnRJZCIsIk1hdGgiLCJtYXgiLCJjaHVua3NXaXRoSWRzIiwiY2h1bmsiLCJpIiwicHVzaCIsIkFycmF5IiwiZnJvbSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJpbnNlcnRNYW55Iiwic2VhcmNoIiwicXVlcnkiLCJ0b3BLIiwib3V0IiwicSIsInNjb3JlcyIsInYiLCJjb3NpbmVTaW1pbGFyaXR5IiwiaW5kaWNlcyIsInMiLCJhIiwiYiIsInNsaWNlIiwibWluIiwic2NvcmUiLCJjbGVhciIsInJlc3VsdCIsImRlbGV0ZU1hbnkiLCJkZWxldGVkQ291bnQiLCJnZXRTdGF0cyIsInRvdGFsX2NodW5rcyIsImRpbWVuc2lvbiIsIm1vZGVsX25hbWUiLCJpbmRleF9zaXplIiwiY2xvc2UiLCJkb3QiLCJuYSIsIm5iIiwic3FydCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/vectorStore.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@xenova","vendor-chunks/onnxruntime-web","vendor-chunks/@huggingface","vendor-chunks/onnxruntime-common","vendor-chunks/@google","vendor-chunks/remove-markdown"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ckomar%5CDesktop%5Cdocs-chat-master%5Cdocs-chat-master&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();